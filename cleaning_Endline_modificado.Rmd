---
title:  "Cleaning code"
author: "Laudine Carbuccia"
date: "2024-01-30"
output:
  word_document:
    toc: yes
    toc_depth: '4'
  bookdown::pdf_book:
    latex_engine: pdflatex
    fig_height: 6
    fontsize: 12
    fig_caption: yes
    toc: yes
    toc_depth: 4
    keep_tex: yes
    always_allow_html: yes
    highlight: pygments
    number_sections: yes
  output: null
  bookdown::word_document2:
    reference_docx: ../StyleReliance.docx
    fig_caption: yes
    toc: yes
    toc_depth: 2
    always_allow_html: yesdata
documentclass: report
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      fig.align ='center'
)

```


```{r EndlineRCTcleaning, include=FALSE}

#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%##
##### Clean the datasets %%%%%%%%%%%##
#####%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%##
library(tidyverse)
library(here)

# Baseline
Baseline_augmented <- readr::read_csv(
  here("Data", "Baseline_augmented.csv")
)

# Endline main
Endline_data <- readr::read_csv(
  here("Data", "Endline.csv")
)

# Endline extra
Endline_extra <- readr::read_csv(
  here("Data", "Endline_extra.csv")
)

## Both Endline_data and Endline_extra contain observations from the RCT sample. We want to merge them into 1 dataset

#############################################################
######################## RCT CLEANING ######################
#############################################################

#Get the data ready for merging
##create a df with the first two rows that contains the full questions, in case it is needed
details_values <- Endline_data[1:2,]


##remove these rows from the main df
Endline_data<- Endline_data[-c(1:2),]
Endline_extra <- Endline_extra[-c(1:2),]


# 1) Helper to parse datetimes robustly
parse_dt <- function(x) {
  # Accepts POSIXct/character; returns POSIXct (UTC)
  if (inherits(x, "POSIXt")) return(x)
  x <- as.character(x)
  suppressWarnings(
    parse_date_time(
      x,
      orders = c(
        "Y-m-d H:M:S", "Y-m-d",
        "d/m/Y H:M:S", "d/m/Y",
        "m/d/Y H:M:S", "m/d/Y"
      ),
      tz = "UTC",
      exact = FALSE
    )
  )
}

# 2) Make key the same type on BOTH
Endline_data  <- Endline_data  %>% mutate(ExternalReference = as.character(ExternalReference))
Endline_extra <- Endline_extra %>% mutate(ExternalReference = as.character(ExternalReference))

# 3) Normalize datetime columns on BOTH
date_cols <- c("StartDate", "EndDate", "RecordedDate")
Endline_data  <- Endline_data  %>% mutate(across(all_of(date_cols), parse_dt))
Endline_extra <- Endline_extra %>% mutate(across(all_of(date_cols), parse_dt))

# (Optional) If character vs factor mismatches elsewhere bite later, you can
# normalize all factors to character before bind:
# Endline_data  <- Endline_data  %>% mutate(across(where(is.factor), as.character))
# Endline_extra <- Endline_extra %>% mutate(across(where(is.factor), as.character))

# 4) Bind, then dedupe: keep the later StartDate per ExternalReference
Endline_data <- bind_rows(
  Endline_data  %>% mutate(.source = "main"),
  Endline_extra %>% mutate(.source = "extra")
) %>%
  group_by(ExternalReference) %>%
  arrange(is.na(StartDate), StartDate, RecordedDate, .by_group = TRUE) %>%
  slice_tail(n = 1) %>%
  ungroup()

# Sanity check: one row per person
stopifnot(!anyDuplicated(Endline_data$ExternalReference))



# TO DO: put all missing values as NA



################ Variables FORMATTING #############


# convert relevant VARIABLES INTO numerical ones


names_numerical <- c("NormsOpposed_1_TEXT",
                     "AffordCost_1_TEXT", "Duration (in seconds)", "MovedZipcode_1_TEXT", 
                     "BirthDate#2_1", "BirthDate#3_1", "BirthDate2#2_1", "BirthDate2#3_1", 
                     "ECSStartDate#2_1", "ECSStartDate#3_1", "ECSIntensity_1_TEXT", 
                     "Prematured_2_TEXT", "BirthWeight1_1_TEXT", "HealthHospA1_1_TEXT", "HealthHospB1_4_TEXT",
                     "HealthHospA2_1_TEXT", "HealthHospB2_4_TEXT", "HealthHospMomA_1_TEXT", "HealthHospMomB_4_TEXT",
                     "Breastfeed1_1_TEXT", "Breastfeed2_1_TEXT", "AffordCostCertainty_1", 
                     "ControlECS_1", "ControlCreche_1", "PsyStress_1", "PsyComplicated_1",
                     "PsySatisfaction_1", "Satisfaction_1", "Usefulness_1"
                     )

Endline_data[, names_numerical] <- lapply(Endline_data[, names_numerical], as.numeric)


# convert relevant VARIABLES INTO date ones

## Define the first date format
date_formats_1 <- c("%Y-%m-%d %H:%M:%S")


### Specify the date-time columns
date_columns <- c("RecordedDate", "EndDate", "StartDate")


### Loop through the date columns and convert them
for (col in date_columns) {
  Endline_data[[col]] <- as.POSIXct(Endline_data[[col]], format = date_formats_1, tz = "UTC")
  # Handle NA values
  Endline_data[[col]][is.na(Endline_data[[col]])] <- as.POSIXct(NA, tz = "UTC")
}

# Create variable with only time (T) and days (D)
Endline_data$StartDate_T <-strftime(Endline_data$StartDate, format="%H:%M:%S")
Endline_data$EndDate_T <-strftime(Endline_data$StartDate, format="%H:%M:%S")
Endline_data$StartDate_D <- as.Date(Endline_data$StartDate)
Endline_data$EndDate_D <- as.Date(Endline_data$EndDate)



## Define the second date format

date_formats_2 <- c( "%d/%m/%Y")

### Specify the date-time columns
date_columns <- c("ECSAppDateWanted_1_TEXT", "ECSAppTiming_1_TEXT", "ECSRensWhen_1_TEXT", "WorkMotherWantWhen_1_TEXT", 
                  "WorkMFaherWantWhen_1_TEXT")


### Loop through the date columns and convert them
for (col in date_columns) {
  Endline_data[[col]] <- as.POSIXct(Endline_data[[col]], format = date_formats_2, tz = "UTC")
  # Handle NA values
  Endline_data[[col]][is.na(Endline_data[[col]])] <- as.POSIXct(NA, tz = "UTC")
}





# compute the splitted dates

## Baby Birth Date
Sys.setlocale("LC_TIME", "en_GB.UTF-8")

Endline_data$BabyBirthDate <- paste(Endline_data$`BirthDate#2_1`,Endline_data$`BirthDate#1_1`, Endline_data$`BirthDate#3_1`, sep="-")
Endline_data$BabyBirthDate <-  as.Date(Endline_data$BabyBirthDate, format = '%d-%B-%Y')



## ECS Start Date

Endline_data$ECSStartDate <- paste(Endline_data$`ECSStartDate#2_1`,Endline_data$`ECSStartDate#1_1`, Endline_data$`ECSStartDate#3_1`, sep="-")
Endline_data$ECSStartDate <-  as.Date(Endline_data$ECSStartDate, format = '%d-%B-%Y')



## ECS for Brother and Sister Timing
Endline_data$ECSBrosisTiming <- ifelse(is.na(Endline_data$`ECSBrosisTiming#1_1`) | is.na(Endline_data$`ECSBrosisTiming#2_1`), 
                                       NA, 
                                       paste("01", Endline_data$`ECSBrosisTiming#1_1`, Endline_data$`ECSBrosisTiming#2_1`, sep="-"))
Endline_data$ECSBrosisTiming <-  as.Date(Endline_data$ECSBrosisTiming, format = '%d-%B-%Y')



## ECS Want To: STart Date wanted
Endline_data$ECSPlanToStartDate <- paste(Endline_data$`ECSStartDate#2_1`,Endline_data$`ECSStartDate#1_1`, Endline_data$`ECSStartDate#3_1`, sep="-")
Endline_data$ECSPlanToStartDate <-  as.Date(Endline_data$ECSPlanToStartDate, format = '%d-%B-%Y')


## Work Mother When: When did the mother go back to work

Endline_data$WorkMotherWhen <- paste(Endline_data$`WorkMotherWhen#2_1`, Endline_data$`WorkMotherWhen#1_1`, Endline_data$`WorkMotherWhen#3_1`,  sep="-")
Endline_data$WorkMotherWhen <-  as.Date(Endline_data$ECSStartDate, format = '%d-%B-%Y')




#convert relevant VARIABLES INTO FACTORS
##NB: pour ajouter les stats sur les heures, prendre le RCTset du 24/10 et ajouter "'HOUR_1','HOUR_2','HOUR_3','HOUR_4',"
#names <- c("ResponseId", "SurveyorName", "MaternityWard", 
#            "FmlyIncome", "Income", "ECSNeed", "ECSIdealAgeEntry", "AffordSubsidies", "AffordNMCostWB", "AffordOppCost", 
#           "AffordNMCostCareer",  "AccessEasy", "AccessHours", "AccessInformalCare", "Norms",  "LikertAccessInfo", "LikertReturnHK", #
#             "Depriv_1","Depriv_2",
#           "LevelExpression", "LevelComprehension",  "SubjectiveInfoLevel", "PartnerInvolvement", "Voucher", "Distress", "Language",
#            "WorkMother", "WorkFather", "Start"
#           
#)
#
#Endline_data[,names] <- lapply(Endline_data[,names] , factor)

# Note: the best practice should be to keep all the variables in the character format as much as possible
Endline_data[sapply(Endline_data, is.character)] <- lapply(Endline_data[sapply(Endline_data, is.character)], as.factor)

###### CREATION OF THE RCT database ####

# We want to join the Endline and Baseline datasets to have the most information about participants

#RCT_tot <- Baseline_augmented %>% 
#  left_join(Endline_data, by = c("ResponseId" = "ExternalReference"), suffix = c("Baseline", "Endline"))

RCT_tot <- Baseline_augmented %>% 
  left_join(Endline_data, by = c("ResponseId" = "ExternalReference"), suffix = c("Baseline", "Endline"))


###### Cleaning the dataset RCT_tot

# First we order factors and recode labels
RCT_tot <- RCT_tot %>% mutate(
  AffordNMCostCareerEndline=ifelse(as.character(AffordNMCostCareerEndline)=="Je ne souhaite pas répondre","Je ne sais pas",as.character(AffordNMCostCareerEndline)),
  AffordOppCostEndline=ifelse(as.character(AffordOppCostEndline)=="Je ne souhaite pas répondre","Je ne sais pas",as.character(AffordOppCostEndline)),
  AffordNMCostWBEndline=ifelse(as.character(AffordNMCostWBEndline)=="Je ne souhaite pas répondre","Je ne sais pas",as.character(AffordNMCostWBEndline)),
  OrderedEduc=factor(OrderedEduc, levels = # Level of education of the mother
                       c("No school", "9-11", "Brevet", "CAP", "Bac", "Bac +2", "Bac + 3", "Bac + 4/5", "+ Bac+5"), ordered = TRUE),
  IncomeBaseline = factor(IncomeBaseline, # Mother's income at Baseline
                  levels = c("NSP","- 500","500-700", "1000-1500", 
                             "1500-2000", "2000-2500", "2500-3000", "3000-4500", "4500-5000",  "5000-6000", "Ne veut pas répondre" ), ordered = TRUE),
    IncomeEndline = factor(IncomeEndline, #  Mother's income at Endline
                  levels = c("Je ne sais pas","Moins de 500 euros","De 500 à moins de 700 euros", "De 700 à moins de 1 000 euros", "De 1 000 à moins de 1 500 euros", "De 1 500 à moins de 2 000 euros", "De 2 000 à moins de 2 500 euros", "De 2 500 à moins de 3 000 euros", "De 3 000 à moins de 4 000 euros", "De 4 000 à moins de 5 000 euros", "De 5 000 à moins de 6 000 euros",  "Plus de 6000 euros", "Je ne souhaite pas répondre" ), ordered = TRUE),
  FmlyIncomeBaseline = factor(FmlyIncomeBaseline,  # Family income at Baseline (to be deleted because of line 288?)
                      levels =c("NSP", "- 500", "500-700", "700-1000", "1000-1500", 
                                "1500-2000", "2000-2500", "2500-3000", "3000-4500", "4500-5000",
                                "5000-6000", "6000-7000", "7000-8000", "+8000", "Ne veut pas répondre"), ordered = TRUE),
    FmlyIncomeBaseline = ifelse(is.na(FmlyIncomeBaseline), as.character(IncomeBaseline),  as.character(FmlyIncomeBaseline)), # for single parents, we want Family income to be the same as mother's income (by definition)
    FmlyIncomeBaseline = factor(FmlyIncomeBaseline, # Family income at Baseline, with single parents included
                      levels =c("NSP", "- 500", "500-700", "700-1000", "1000-1500", 
                                "1500-2000", "2000-2500", "2500-3000", "3000-4500", "4500-5000",
                                "5000-6000", "6000-7000", "7000-8000", "+8000", "Ne veut pas répondre"), ordered = TRUE),
  FmlyIncomeEndline = factor(FmlyIncomeEndline, # Do the same for Family income at Endline
                      levels =c("Je ne sais pas","Moins de 500 euros","De 500 à moins de 700 euros", "De 700 à moins de 1 000 euros", "De 1 000 à moins de 1 500 euros", "De 1 500 à moins de 2 000 euros", "De 2 000 à moins de 2 500 euros", "De 2 500 à moins de 3 000 euros", "De 3 000 à moins de 4 000 euros", "De 4 000 à moins de 5 000 euros", "De 5 000 à moins de 6 000 euros", "De 6 000 à moins de 10 000 euros","10 000 euros ou plus", "Je ne souhaite pas répondre" ), ordered = TRUE), 
  FmlyIncomeEndline = ifelse(is.na(FmlyIncomeEndline), as.character(IncomeEndline), as.character(FmlyIncomeEndline)), # Single parents
 FmlyIncomeEndline = factor(FmlyIncomeEndline, 
                      levels =c("Je ne sais pas","Moins de 500 euros","De 500 à moins de 700 euros", "De 700 à moins de 1 000 euros", "De 1 000 à moins de 1 500 euros", "De 1 500 à moins de 2 000 euros", "De 2 000 à moins de 2 500 euros", "De 2 500 à moins de 3 000 euros", "De 3 000 à moins de 4 000 euros", "De 4 000 à moins de 5 000 euros", "De 5 000 à moins de 6 000 euros", "De 6 000 à moins de 10 000 euros","10 000 euros ou plus", "Je ne souhaite pas répondre" ), ordered = TRUE), 
  AffordNMCostWBOrderedBaseline =factor(AffordNMCostWBBaseline, # Reorder Cost of staying at ome on WB
                               levels=c("Négatif",  "Je ne sais pas encore","Pas d'impact","Positif"), ordered = TRUE # would staying at home have a positive, 
  ),  
 AffordNMCostWBOrderedEndline =factor(AffordNMCostWBEndline,  # Reorder Cost of staying at home on Well Being at BASELINE
                               levels=c("Négatif",  "Je ne sais pas","Pas d'impact","Positif"), ordered = TRUE # would staying at home have a positive, 
  ),                                                                   # negative or null impact on mother's well being
  AffordOppCostBaseline =factor(AffordOppCostBaseline, # Reorder opportunity costs (effect on family budget)
                       levels=c("Négatif",  "Je ne sais pas encore", "Pas d'impact", "Positif"), ordered = TRUE # would staying at home have a positive, 
  ),  
  AffordOppCostEndline =factor(AffordOppCostEndline, # Do the same for Endline: Opp Costs
                       levels=c("Négatif",  "Je ne sais pas", "Pas d'impact", "Positif"), ordered = TRUE # would staying at home have a positive, 
  ),  # negative or null impact on household's income
  AffordNMCostCareerBaseline =factor(AffordNMCostCareerBaseline, # Career Baseline: would staying at home have a positive, 
                            levels=c("Négatif", "Pas d'impact", "Je ne sais pas encore","Positif"), ordered = TRUE # negative or null impact on mother's career
  ), AffordNMCostCareerEndline =factor(AffordNMCostCareerEndline, # Career Endline: would staying at home have a positive, 
                            levels=c("Négatif", "Pas d'impact", "Je ne sais pas","Positif"), ordered = TRUE # negative or null impact on mother's career
  ),
  AccessEasyBaseline = factor(AccessEasyBaseline,levels =c("impossible","quasiment impossible", # Whether accessing a slot in ECS is seen as easy (Baseline)
                                         "très difficile","assez difficile",
                                         "je ne sais pas","assez facile",
                                         "très facile"),ordered = TRUE), 
  AccessEasyEndline = ifelse(AccessEasyEndline == "je ne souhaite pas répondre", "je ne sais pas", as.character(AccessEasyEndline)), 
   AccessEasyEndline = factor(AccessEasyEndline ,levels =c("impossible","quasiment impossible", # Whether accessing a slot in ECS is seen as easy (Endline)
                                         "très difficile","assez difficile",
                                         "je ne sais pas","assez facile",
                                         "très facile"),ordered = TRUE), 
  AccessHoursBaseline = factor(AccessHoursBaseline,levels =c("Oui", # Whether ECS opening hours fit parents working hours (Baseline)
                                           "Non, mais on prendra un autre mode de garde en plus","Je ne sais pas encore",
                                           "Non"),ordered = TRUE),
 AccessHoursEndline = ifelse(AccessHoursEndline == "Je ne souhaite pas répondre", "Je ne sais pas encore", as.character(AccessHoursEndline)), 
  AccessHoursEndline =factor(AccessHoursEndline, levels =c("Oui", # Whether ECS opening hours fit parents working hours (Endline)
                                           "Non, mais on prendra un autre mode de garde en plus","Je ne sais pas encore",
                                           "Non"),ordered = TRUE),
  AccessInformalCareBaseline = factor(AccessInformalCareBaseline,levels =c("Non", "Je ne sais pas encore", # Whether accessing informal care is feasible (Baseline)
                                                         "Oui, pour dépanner / très ponctuellement", "Oui, de temps en temps", "Oui, autant que nécessaire"),ordered = TRUE),
 AccessInformalCareEndline = ifelse(AccessInformalCareEndline == "Je ne souhaite pas répondre", "Je ne sais pas encore", as.character(AccessInformalCareEndline)),
    AccessInformalCareEndline = factor(AccessInformalCareEndline,levels =c("Non", "Je ne sais pas encore", "Oui, pour dépanner / très ponctuellement", "Oui, de temps en temps", "Oui, autant que nécessaire"),ordered = TRUE), #  # Whether accessing informal care is feasible (Endline)
  NormsBaseline = factor(NormsBaseline,
               levels=c("Ne sait pas","Aucune","Une minorité","Moitié moitié","La plupart","Toutes"), ordered = TRUE # how many mothers in their surroundings use childcare  (Baseline)
  ), NormsEndline = ifelse(NormsEndline == "Ne souhaite pas répondre", "Ne sait pas", as.character(NormsEndline)),
 NormsEndline = factor(NormsEndline,
               levels=c("Ne sait pas","Aucune","Une minorité","Moitié moitié","La plupart","Toutes"), ordered = TRUE # how many mothers in their surroundings use childcare (Baseline)
  ),
  LikertAccessInfoBaseline=factor(LikertAccessInfoBaseline, # Is it feasible to access information about childcare (Baseline)
                          levels=c("Très en désaccord","Assez en désaccord","Je ne sais pas","Assez d’accord","Très d’accord"), ordered = TRUE), # strongly disagree, disagree, don't know, agree, strongly agree
    LikertAccessInfoEndline = ifelse(LikertAccessInfoEndline == "Je ne souhaite pas répondre", "Je ne sais pas", as.character(LikertAccessInfoEndline)),
  LikertAccessInfoEndline = factor(LikertAccessInfoEndline, # Is it feasible to access information about childcare (Endline)
                          levels=c("En désaccord","Assez en désaccord","Je ne sais pas","Assez d’accord","D’accord"), ordered = TRUE), 
  LikertReturnHKBaseline=factor(LikertReturnHKBaseline, # believe in childcare returns on investment: is a child that attended childcare better developed in preschool? (Baseline)
                        levels=c("Très en désaccord","Assez en désaccord","Je ne sais pas","Assez d’accord","Très d’accord") , ordered = TRUE), # strongly disagree, disagree, don't know, agree, strongly agree
    LikertReturnHKEndline = ifelse(LikertReturnHKEndline == "Je ne souhaite pas répondre", "Je ne sais pas", as.character(LikertReturnHKEndline)),
  LikertReturnHKEndline=factor(LikertReturnHKEndline, # believe in childcare returns on investment: is a child that attended childcare better developed in preschool? (Endline)
                        levels=c("En désaccord","Assez en désaccord","Je ne sais pas","Assez d’accord","D’accord") , ordered = TRUE), # strongly disagree, disagree, don't know, agree, strongly agree
  LikertAccessSoc=factor(LikertAccessSoc, # Does the mother have someone that can help with paperwork if needed
                         levels=c("Très en désaccord","Assez en désaccord","Je ne sais pas","Assez d’accord","Très d’accord"), ordered = TRUE), # strongly disagree, disagree, don't know, agree, strongly agree
  TrustFam=factor(TrustFam, # TRUST: Do the parents trust their close family (parents, brother, sister, etc.) to take care of the baby
                  levels=c("Très en désaccord","Assez en désaccord","Je ne sais pas","Assez d’accord","Très d’accord"),  ordered = TRUE
  ),
  TrustFriend=factor(TrustFriend, # TRUST: Do the parents trust their friends to take care of the baby
                     levels=c("Très en désaccord","Assez en désaccord","Je ne sais pas","Assez d’accord","Très d’accord"), ordered = TRUE
  ),
  TrustAssMat=factor(TrustAssMat, # TRUST: Do the parents trust a private childminder to take care of the baby
                     levels=c("Très en désaccord","Assez en désaccord","Je ne sais pas","Assez d’accord","Très d’accord"), ordered = TRUE
  ),
  TrustCreche=factor(TrustCreche, # TRUST: Do the parents trust daycares to take care of the baby
                     levels=c("Très en désaccord","Assez en désaccord","Je ne sais pas","Assez d’accord","Très d’accord"), ordered = TRUE
  ),
  DeprivClothes =factor(DeprivClothes,levels=c("Pas du tout","Un peu","Beaucoup","Je ne souhaite pas répondre"), ordered = TRUE), # DEPRIVATION: do parents struggle to buy clothes?
  DeprivFood    =factor(DeprivFood,levels=c("Pas du tout","Un peu","Beaucoup","Je ne souhaite pas répondre"), ordered = TRUE), # DEPRIVATION: do parents struggle to buy food?
  DeprivBills   =factor(DeprivBills,levels=c("Pas du tout","Un peu","Beaucoup","Je ne souhaite pas répondre"), ordered = TRUE), # DEPRIVATION: do parents struggle to pay for the bills?
  DeprivHolidays=factor(DeprivHolidays,levels=c("Pas du tout","Un peu","Beaucoup","Je ne souhaite pas répondre"), ordered = TRUE), # DEPRIVATION: do parents struggle to go in holidays?
  DeprivHousing =factor(DeprivHousing,levels=c("Pas du tout","Un peu","Beaucoup","Je ne souhaite pas répondre"), ordered = TRUE), # DEPRIVATION: do parents struggle to pay for housing?
  DeprivEndlineHolidays=factor(Depriv_1,levels=c("Pas du tout","Un peu","Beaucoup","Je ne souhaite pas répondre"), ordered = TRUE), # DEPRIVATION: do parents struggle to go in holidays?
  DeprivEndlineHousing =factor(Depriv_2,levels=c("Pas du tout","Un peu","Beaucoup","Je ne souhaite pas répondre"), ordered = TRUE), # DEPRIVATION: do parents struggle to pay for housing?
  InformalReciprocity = factor(InformalReciprocity, # Do the parents already take care of the children of others
                               levels = c( "Non", " Je ne souhaite pas répondre", "Oui, pour dépanner / très ponctuellement",
                                           "Oui, de temps en temps", " Oui, très souvent"), ordered = TRUE), # 
  OrderedEduc2=factor(OrderedEduc2, levels  = c(
    "No school", "9-11", "Brevet", "CAP", "Bac", "Bac +2", "Bac + 3", "Bac + 4/5", "+ Bac+5","Missing","No Partner"), ordered = TRUE), # Education level of the partner 
  ActiveBaseline = ifelse(as.character(Act3) == "NSP", "Inactive", as.character(Act3)),  # Dummy for mother active at Baseline
  ActiveBaseline = relevel(as.factor(ActiveBaseline), ref = "Inactive"), # put inactive as the reference category
  Active1or0Baseline = ifelse(as.character(ActiveBaseline) == "Inactive", 0, 1), # Create a [0, 1] variable
  Educ3 = fct_collapse(OrderedEduc, "Bac or Less" = c("No school", "9-11", "Brevet", "CAP", "Bac"), 
                       "Undergrad" = c("Bac + 3", "Bac +2"), 
                       "Graduate" = c("Bac + 4/5", "+ Bac+5") ), # Education level with only 3 levels
  Educ3Dad = fct_collapse(OrderedEduc2, "Bac or Less" = c("No school", "9-11", "Brevet", "CAP", "Bac"), 
                          "Undergrad" = c("Bac + 3", "Bac +2"), # Education level of the partner with only 3 levels
                          "Graduate" = c("Bac + 4/5", "+ Bac+5"), "Missing" = c("Missing", "No Partner" )), 
  Intention1or0Baseline = ifelse(as.character(Intention.x) == "No", 0, 1),  # Whether they intended to use early childcare at Baseline
  BirthNotAsiaMENA = ifelse((as.character(BirthPlaceBaseline) == "Asie (hors MENA)" |  as.character(BirthPlaceBaseline) == "MENA (Maghreb +Arabie saoudite, etc.)"), "AsiaOrMENA", "NotAsiaNorMENA"),
  BirthNotAsiaMENA = as.factor(BirthNotAsiaMENA),  # Dummy: the mothers is not born in Asia nor in MENA
  BirthNotAsiaMENA1or0 = as.factor(BirthNotAsiaMENA1or0), # Turn it into 0, 1
  BirthPlace3 = as.factor(BirthPlace3), # Turn the 3 level variabble into a factor
  ECSIdealAgeEntry6Baseline = as.factor(ECSIdealAgeEntry6),  # Do the same for the ideal entry age in early childcare
  ECSIdealAgeEntryBaseline = factor(ECSIdealAgeEntryBaseline, 
                            levels = c(  "Jamais", "Pendant ses trois premiers mois", "Pendant ses six premiers mois", "Pendant ses neuf premiers mois", "Pendant la première année", "Ne sait pas", "Jusqu’à l’entrée à la maternelle" ) , ordered = TRUE),  # Relevel the full variable: ideal entry age in early childcare
  ECSIdealAgeEntryEndline = factor(ECSIdealAgeEntryEndline, 
                            levels = c(  "Jamais", "Pendant ses trois premiers mois", "Pendant ses six premiers mois", "Pendant ses neuf premiers mois", "Pendant la première année", "Ne sait pas", "Jusqu’à l’entrée à la maternelle" ) , ordered = TRUE), # Relevel the full variable: ideal entry age in early childcare
  AccessInformalFullTimeBaseline = as.factor(AccessInformalFullTime), # The mother can access informal care as much as needed at Basline
  AccessInformalCareFulltime1or0Baseline = ifelse(as.character(AccessInformalFullTime) == "Yes", 1, 0), # Into 1 and 0
  AccessInformalCareYNBaseline = as.factor(AccessInformalCareYN), # Dummy: the mother can access informal care (regardless of the intensity)
  SmokePreg = factor(SmokePreg, levels = c("Continued Smoking","Reduced Smoking", "Stopped Smoking" , "Did Not Smoke"), ordered = TRUE),  # Smoking behavior during pregnancy 
  OccupationEndline = ifelse( WorkMother %in% c("Autre", # Recode occupation  of the mother: merge small categories 
                  "Retraité, préretraite, en pension d’invalidité etc."),"Autre",as.character(WorkMother)),
OccupationEndline = case_when( 
    (WorkMother_10_TEXT =="Rupture conventionnelle/en formation" | WorkMother_10_TEXT =="Congé maladie" | WorkMother_10_TEXT =="Arrêt longue maladie" | WorkMother_10_TEXT =="Arrêt maladie"|  WorkMother_10_TEXT =="Indépendente (il ont rompu le contrat sans raison sans justification : elle pense que c'est lié à sa situation de jeune maman)  En préavis elle cherche un nouveau travail"| WorkMother_10_TEXT =="arrêt maladie"| WorkMother_10_TEXT =="Arrêt maladie longue durée"| WorkMother_10_TEXT =="Congé maternité pour un second enfant"| WorkMother_10_TEXT =="Arrêt maladie après congé mat"| WorkMother_10_TEXT =="congés longue durée lié à pathologie"| WorkMother_10_TEXT =="Congé payé" | WorkMother_10_TEXT =="En arrêt maladie"| WorkMother_10_TEXT =="congé maternité"| WorkMother_10_TEXT =="Congé maternité + 90 jours congé demi payé + 30jours congé payé"| WorkMother_10_TEXT =="Aurait du travailler mais part à l'étranger"| WorkMother_10_TEXT =="en congé maladie, ne peut pas travailler pour des raisons de santé"| WorkMother_10_TEXT =="congé parce qu'enfant malade"| WorkMother_10_TEXT =="Arrêt maladie mais reprend le 30/10/2023"| WorkMother_10_TEXT =="congés mais pas parental"| WorkMother_10_TEXT =="Congé payé"| WorkMother_10_TEXT =="Aurait du travailler mais part à l'étranger"| WorkMother_10_TEXT =="Congé à cause de la pathologie de son fils"| WorkMother_10_TEXT =="ARRËT MALADIE"| WorkMother_10_TEXT =="maladie depuis la fin de son congé maternité"| WorkMother_10_TEXT =="En vacances, le contrat se termine 08/12/2023"| WorkMother_10_TEXT =="Occupe un emploi un emploi mais en congé d'allaitement, reprend en novembre"| WorkMother_10_TEXT =="Salarié en arrêt maladie, à la recherche d'un autre emploi") ~"Occupe un emploi / travaille",
                           (WorkMother_10_TEXT=="En attente de régularisation" | WorkMother_10_TEXT == "papiers"| WorkMother_10_TEXT == "En rupture conventionnelle, n'a pas repris depuis la naissance de l'enfant"| WorkMother_10_TEXT == "En attente de régularisation"| WorkMother_10_TEXT == "papiers") ~"Sans activité professionnelle / femme au foyer",
                           (WorkMother_10_TEXT=="En train de faire sa thèse mais sans contrat de travail" | WorkMother == "Apprenti(e) sous contrat ou en stage rémunéré")~"Etudiant, stagiaire non rémunéré, formation", # 2. and missing values
    .default = as.character(OccupationEndline)), 
ECSUseYes = as.numeric(ECSUse == "Oui"),  # Variable that takes the value 1 if the family had already use  early childcare at Baseline
  ECSNoECSAppYes = as.numeric(ECSNoECSApp == "Oui"), # Value that takes the value 1 if parents don't have an ECS (early childcare) place but have applied for it at Endline
  ECSApp = ifelse((ECSUseYes == 1 | ECSNoECSAppYes == 1), 1, 0), # Create ECSApp, a variable that takes the value 1 if parents have applied to ECS FOR Endline (which include both those who have a place and those who don't but applied)
  ActiveMotherEndline = ifelse( (WorkMother == "Etudiant, stagiaire non rémunéré, formation" | WorkMother == "Occupe un emploi / travaille" | WorkMother == "Apprenti(e) sous contrat ou en stage rémunéré" ), 1, 0),  # Dummy that takes a 1 if the mother is active at Endline
  ActiveMotherEndline = as.numeric(ActiveMotherEndline), # Turns this dummy into numerics
  ActiveMotherEndlineYesNo = as.factor(ifelse( (WorkMother == "Etudiant, stagiaire non rémunéré, formation" | WorkMother == "Occupe un emploi / travaille" | WorkMother == "Apprenti(e) sous contrat ou en stage rémunéré" ), "Yes", "No")), # Dummy that takes the value Yes if the mother is active at Endline, and No otherwise
  WorkMotherFullTime = as.numeric(WorkMotherIntensity == "Temps plein (> 85% soit 30h/semaine)")
) %>% # Dummy that takes the value 1 if the mother works full time at Endline
 # mutate_at(vars(ECS_Type, ECS_Known_Y, ECS_Known_N),~ifelse(.=="Aucun autre"|.=="Aucun",NA,.)) %>% 
  mutate_at(vars(ECSType, ECSIdealType, ECSKnown, ECS2Type, ECSAppType, ECSPlanToType, ECSBroSisAppType, ECSBrosisType),~str_replace_all(.,"Je ne souhaite pas répondre","Je ne sais pas encore")) %>% # merge "je ne souhaite pas répondre" with "je ne sais pas encore" for these variables (too few ppl didn't answer) 
    mutate_at(vars(ECSTwinsType),~str_replace_all(.,"Click to write Choice 19","Crèche hospitalière")) %>% # Qualtrics miscoded some variables: in the next few lines we fix this bug
      mutate_at(vars(ECSTwinsType),~str_replace_all(.,"Click to write Choice 21","Crèche parentale")) %>%
        mutate_at(vars(ECSTwinsType),~str_replace_all(.,"Click to write Choice 20","Crèche familiale")) %>%
          mutate_at(vars(ECSTwinsType),~str_replace_all(.,"Click to write Choice 22","Micro-crèche privée")) %>%
      mutate_at(vars(ECSType, ECS2Type, ECSAppType),~str_replace_all(.,"Click to write Choice 15","Crèche hospitalière")) %>%
      mutate_at(vars(ECSType, ECS2Type, ECSAppType),~str_replace_all(.,"Click to write Choice 17","Crèche parentale")) %>%
        mutate_at(vars(ECSType, ECS2Type, ECSAppType),~str_replace_all(.,"Click to write Choice 16","Crèche familiale")) %>%
          mutate_at(vars(ECSType, ECS2Type, ECSAppType),~str_replace_all(.,"Click to write Choice 18","Micro-crèche privée")) %>%
        mutate_at(vars(ECSBrosisType),~str_replace_all(.,"Click to write Choice 17","Le même que celui utilisé pour l'autre enfant")) %>%
      mutate_at(vars(ECSBrosisType),~str_replace_all(.,"Click to write Choice 19","Crèche parentale")) %>%
        mutate_at(vars(ECSBrosisType),~str_replace_all(.,"Click to write Choice 18","Crèche familiale")) %>%
          mutate_at(vars(ECSBrosisType),~str_replace_all(.,"Click to write Choice 20","Micro-crèche privée")) %>%
            mutate_at(vars(ECSBrosisType),~str_replace_all(.,"Click to write Choice 16","Toute petite section")) %>%
          mutate_at(vars(ECSPlanToType),~str_replace_all(.,"Click to write Choice 17","Crèche hospitalière")) %>%
      mutate_at(vars(ECSPlanToType),~str_replace_all(.,"Click to write Choice 18","Crèche parentale")) %>%
        mutate_at(vars(ECSPlanToType),~str_replace_all(.,"Click to write Choice 19","Crèche familiale")) %>%
          mutate_at(vars(ECSPlanToType),~str_replace_all(.,"Click to write Choice 20","Micro-crèche privée")) %>%
            mutate_at(vars(ECSPlanToType),~str_replace_all(.,"Click to write Choice 21","Toute petite section")) %>%
          mutate_at(vars(ECSIdealType),~str_replace_all(.,"Click to write Choice 17","Crèche hospitalière")) %>%
      mutate_at(vars(ECSIdealType),~str_replace_all(.,"Click to write Choice 19","Crèche parentale")) %>%
        mutate_at(vars(ECSIdealType),~str_replace_all(.,"Click to write Choice 18","Crèche familiale")) %>%
          mutate_at(vars(ECSIdealType),~str_replace_all(.,"Click to write Choice 20","Micro-crèche privée")) %>%
            mutate_at(vars(ECSBroSisAppType),~str_replace_all(.,"Click to write Choice 17","Le même que celui utilisé pour l'autre enfant")) %>%
      mutate_at(vars(ECSBroSisAppType),~str_replace_all(.,"Click to write Choice 18","Crèche parentale")) %>%
        mutate_at(vars(ECSBroSisAppType),~str_replace_all(.,"Click to write Choice 20","Crèche familiale")) %>%
          mutate_at(vars(ECSBroSisAppType),~str_replace_all(.,"Click to write Choice 19","Micro-crèche privée")) %>%
            mutate_at(vars(ECSBroSisAppType),~str_replace_all(.,"Click to write Choice 16","Toute petite section")) %>%
          mutate_at(vars(ECSKnown),~str_replace_all(.,"Click to write Choice 18","Crèche hospitalière")) %>%
      mutate_at(vars(ECSKnown),~str_replace_all(.,"Click to write Choice 17","Crèche parentale")) %>%
        mutate_at(vars(ECSKnown),~str_replace_all(.,"Click to write Choice 16","Crèche familiale")) %>%
          mutate_at(vars(ECSKnown),~str_replace_all(.,"Click to write Choice 15","Micro-crèche privée")) %>% # Now that this painful task is over, we recode the ECS type used at Endline in fewer categories
  mutate( ECSType6Endline=fct_collapse(as.factor(ECSType), 
                                "Crèches Publiques" = c("Crèche départementale",      
                                                         "Crèches municipales (ou juste «crèches »)", 
                                                         "Crèche familiale", 
                                                         "Crèche hospitalière" ), 
                                "Crèches Privées" = c("Crèche privée", "Micro-crèche privée"), 
                                "Crèches Asso" = c("Crèches associatives", "Crèche parentale", "Autres types de crèches"), 
                                "Haltes garderies" = "Haltes garderies", 
                                             Nounou = c("Nounou à domicile", "Garde partagée"), 
                                "Assistantes maternelles" = c("Assistantes maternelles", "MAM (Maison d'Assistantes Maternelles)"), 
                                "Autre" = "Autre"), 
          ECSIdeal7Endline=fct_collapse(as.factor(ECSIdealType), # Do the same for the ideal type of ECS parents would have like to use if they are not satisfied
                                "Crèches Publiques" = c("Crèche départementale",      
                                                         "Crèches municipales (ou juste «crèches »)", 
                                                         "Crèche familiale", 
                                                         "Crèche hospitalière" ), 
                                "Crèches Privées" = c("Crèche privée", "Micro-crèche privée"), 
                                "Crèches Asso" = c("Crèches associatives", "Crèche parentale"), 
                                "Haltes garderies" = "Haltes garderies", 
                                             Nounou = "Nounou à domicile", 
                                "Assistantes maternelles" = c("Assistantes maternelles", "MAM (Maison d'Assistantes Maternelles)"), 
                                "Autre" = "Autre", 
                                "Garde informelle" = c("Grands-parents ou autre membre de la famille", 
                                                       NSP = "Je ne sais pas encore")), 
            ECSIdealYes = ifelse( ECSIdeal == "Non, c’était mon mode de garde préféré.", 1, 0),
           ECSIdealNo = ifelse( ECSIdeal == "Non, c’était mon mode de garde préféré.", 0, 1),
          BabyFemale = as.factor(SEX1 == "Fille"), 
          ECSAppType_3_TEXT = ifelse(ECSAppType_3_TEXT == "Plusieurs", "10", ECSAppType_3_TEXT), 
          ECSAppType_17_TEXT = ifelse(ECSAppType_17_TEXT  == "Plusieurs", "3", ECSAppType_17_TEXT ),
          ECSAppType_16_TEXT = ifelse(ECSAppType_16_TEXT  == "Plusieurs", "3", ECSAppType_16_TEXT ), 
          ECSAppType_4_TEXT = case_when(ECSAppType_4_TEXT   == "Plusieurs"~ "10", ECSAppType_4_TEXT   == "2/3"~ "3", TRUE ~ ECSAppType_4_TEXT), 
          ECSAppType_5_TEXT = case_when(ECSAppType_5_TEXT   == "Crèche militaire"~ "1", ECSAppType_5_TEXT   == "Crèche pour enfant de fonctionnaire"~ "1", TRUE ~ ECSAppType_5_TEXT), 
          ECSAppType_6_TEXT = case_when(ECSAppType_6_TEXT   == "'+ de 10"~ "15", ECSAppType_6_TEXT   == "+10"~ "15", ECSAppType_6_TEXT   == "3/4"~ "4", ECSAppType_6_TEXT   == "Plusieurs"~ "10", TRUE ~ ECSAppType_6_TEXT),
          ECSAppType_7_TEXT = ifelse(ECSAppType_7_TEXT  == "Plusieurs", "3", ECSAppType_7_TEXT ), 
          ECSPlanToType = case_when(ECSPlanToType_14_TEXT  == "Halte-jeu"~"Haltes garderies", 
                                    ECSPlanToType_14_TEXT  == "pas forcément un temps plein"~"Haltes garderies", 
                                    ECSPlanToType_14_TEXT  == "là où bébé se sentira bien"~"Je ne sais pas encore", 
                                    ECSPlanToType_14_TEXT  == "s'adapte au MdG disponible pour un temps plein"~"Je ne sais pas encore", .default = as.character(ECSPlanToType))
          
          )

## Manipulate the number and types of ECS Known in order to do stats on the information level
# Recode ECS related variables
#  mutate_at(vars(ECS_Type, ECS_Known_Y, ECS_Known_N),~str_replace_all(.,"Autres types de crèches","Autre")) %>%
#mutate(ECSKnown=paste(ECS_Known_Y, ECS_Known_N,sep=",")) %>% 
# separate_longer_delim(ECSIdealType, delim = ",") %>%               ## ATTEMPT TO Split ECS: Weird results for ECSIdealType, ECSKnown, ECS2Type, ECSAppType, ECSPlanToType, ECSBroSisAppType, ECSBrosisType
# separate_longer_delim(ECSKnown, delim = ",") %>%
# separate_longer_delim(ECSAppType, delim = ",") %>%
# separate_longer_delim(ECSPlanToType, delim = ",") %>%
# separate_longer_delim(ECSBroSisAppType, delim = ",") %>%
# separate_longer_delim(ECSBrosisType, delim = ",") %>% #  separate the elements in long format?????
# mutate(ECSKnown=str_remove_all(ECSKnown,"NA,|,NA|NA")) %>% 
#  filter(ECSKnown!="") %>%  #remove NA and if the known element is the one they intend to use.

# ---------- Tolerant patterns using  ----------
pat_creche   <- regex("cr[eè]che(s)?", ignore_case = TRUE)
pat_pub      <- regex("municipale(s)|d[ée]partementale(s)", ignore_case = TRUE)
pat_muni     <- regex("municipale", ignore_case = TRUE)
pat_dept     <- regex("d[ée]partementale", ignore_case = TRUE)
pat_asso     <- regex("associative(s)", ignore_case = TRUE)
pat_assmat   <- regex("assistante(s)?\\s+maternelle(s)?", ignore_case = TRUE)
pat_je       <- regex("jardin\\s+d[’']?enfant", ignore_case = TRUE)        # ’ or '
pat_autre    <- regex("\\bautre\\b", ignore_case = TRUE)
pat_partage  <- regex("partag[ée]e?", ignore_case = TRUE)                   # partagée/partagee
pat_hg       <- regex("halte(s)?\\s+garderie(s)?", ignore_case = TRUE)      # Halte(s) garderie(s)
pat_nounou   <- regex("\\bnounou\\b", ignore_case = TRUE)
pat_hosp     <- regex("hospitali[èe]re", ignore_case = TRUE)
pat_fam      <- regex("familiale", ignore_case = TRUE)
pat_parent   <- regex("parentale", ignore_case = TRUE)
pat_privee   <- regex("priv[ée]e", ignore_case = TRUE)
pat_micro    <- regex("micro[- ]?cr[eè]che", ignore_case = TRUE)
pat_mam      <- regex("\\bMAM\\b|maison d'?assistante(s)? maternelle(s)?", ignore_case = TRUE)
pat_tpe      <- regex("\\bsection\\b", ignore_case = TRUE)
pat_dk       <- regex("^\\s*je ne sais pas encore\\s*$", ignore_case = TRUE)

# ---------- Fonctions ----------
det    <- function(x, pat) str_detect(coalesce(x, ""), pat) # detect pattenrs in a single column          
det_any <- function(cols, pat) purrr::reduce(cols, ~ .x | det(.y, pat), .init = FALSE) # we will use only for KNOWLEDGE (because matches across more than one column)

# All multi-text columns to scan 
cols <- c("ECSType","ECSKnown","ECSIdealType","ECS2Type",
          "ECSAppType","ECSPlanToType","ECSBroSisAppType","ECSBrosisType")

ECS_df <- RCT_tot %>%
  mutate(
    # --- KNOWLEDGE: any crèche (match on any field)
    KnowsCrecheEndline    = det_any(across(all_of(cols)), pat_creche),
    KnowsCrechePubEndline =
      rowSums(across(
        all_of(cols),
        ~ det(.x, pat_creche) & det(.x, pat_pub)   # both in the SAME field
      )) > 0,
    KnowsCrecheAEndline   = det_any(across(all_of(cols)), pat_asso),
    KnowsAssMatEndline    = det_any(across(all_of(cols)), pat_assmat),
    KnowsJEEndline        = det_any(across(all_of(cols)), pat_je),
    KnowsAutreEndline     = det_any(across(all_of(cols)), pat_autre),
    KnowsPartageEndline   = det_any(across(all_of(cols)), pat_partage),
    KnowsHGEndline        = det_any(across(all_of(cols)), pat_hg),
    KnowsNounouEndline    = det_any(across(all_of(cols)), pat_nounou),
    KnowsHospEndline      = det_any(across(all_of(cols)), pat_hosp),
    KnowsFamilialeEndline = det_any(across(all_of(cols)), pat_fam),
    KnowsParentaleEndline = det_any(across(all_of(cols)), pat_parent),
    KnowsPrivéeEndline    = det_any(across(all_of(cols)), pat_privee),
    KnowsMicroCrecheEndline = det_any(across(all_of(cols)), pat_micro),
    KnowsMAMEndline       = det_any(across(all_of(cols)), pat_mam),
    KnowsTPEEndline       = det_any(across(all_of(cols)), pat_tpe),

    # --- KNOWS NOTHING: every scanned field is NA or "Je ne sais pas encore"
    KnowsNothingEndline = if_all(
      all_of(cols),
      ~ is.na(.) | det(., pat_dk)
    ),

    # --- USE (endline realized use): only ECSType & ECS2Type by design
    UseCreche        = det(ECSType, pat_creche)      | det(ECS2Type, pat_creche),
    UseCrecheA       = det(ECSType, pat_asso)        | det(ECS2Type, pat_asso),
    UseAssMat        = det(ECSType, pat_assmat)      | det(ECS2Type, pat_assmat),
    UseJE            = det(ECSType, pat_je)          | det(ECS2Type, pat_je),
    UseAutre         = det(ECSType, pat_autre)       | det(ECS2Type, pat_autre),
    UsePartage       = det(ECSType, pat_partage)     | det(ECS2Type, pat_partage),
    UseHG            = det(ECSType, pat_hg)          | det(ECS2Type, pat_hg),
    UseNounou        = det(ECSType, pat_nounou)      | det(ECS2Type, pat_nounou),
    UseHosp          = det(ECSType, pat_hosp)        | det(ECS2Type, pat_hosp),
    UseFamiliale     = det(ECSType, pat_fam)         | det(ECS2Type, pat_fam),
    UseParentale     = det(ECSType, pat_parent)      | det(ECS2Type, pat_parent),
    UsePrivée        = det(ECSType, pat_privee)      | det(ECS2Type, pat_privee),
    UseMicroCreche   = det(ECSType, pat_micro)       | det(ECS2Type, pat_micro),
    UseMAM           = det(ECSType, pat_mam)         | det(ECS2Type, pat_mam),

    # Public breakdowns (robust to accents/case)
    UseCrecheMuni    = det(ECSType, pat_muni)         | det(ECS2Type, pat_muni),
    UseCrecheDept    = det(ECSType, pat_dept) | det(ECS2Type, pat_dept),
    UseCrechePub     = UseCrecheMuni | UseCrecheDept,

    # --- SIBLINGS (same patterns, single field)
    UseCrecheBrosis      = det(ECSBrosisType, pat_creche),
    UseCrecheMuniBrosis  = det(ECSBrosisType, pat_muni),
    UseCrecheDeptBrosis  = det(ECSBrosisType, pat_dept),
    UseCrecheABrosis     = det(ECSBrosisType, pat_asso),
    UseAssMatBrosis      = det(ECSBrosisType, pat_assmat),
    UseJEBrosis          = det(ECSBrosisType, pat_je),
    UseAutreBrosis       = det(ECSBrosisType, pat_autre),
    UsePartageBrosis     = det(ECSBrosisType, pat_partage),
    UseHGBrosis          = det(ECSBrosisType, pat_hg),
    UseNounouBrosis      = det(ECSBrosisType, pat_nounou),
    UseHospBrosis        = det(ECSBrosisType, pat_hosp),
    UseFamilialeBrosis   = det(ECSBrosisType, pat_fam),
    UseParentaleBrosis   = det(ECSBrosisType, pat_parent),
    UsePrivéeBrosis      = det(ECSBrosisType, pat_privee),
    UseMicroCrecheBrosis = det(ECSBrosisType, pat_micro),
    UseMAMBrosis         = det(ECSBrosisType, pat_mam),
    UseTPEBrosis         = det(ECSBrosisType, pat_tpe),

    # --- WANT / IDEAL
    WantCrecheEndline    = det(ECSPlanToType, pat_creche),
    
    WantCrecheAEndline   = det(ECSPlanToType, pat_asso),
    WantAssMatEndline    = det(ECSPlanToType, pat_assmat),
    WantJEEndline        = det(ECSPlanToType, pat_je),
    WantAutreEndline     = det(ECSPlanToType, pat_autre),
    WantTPSEndline       = det(ECSPlanToType, pat_tpe),
    WantPartageEndline   = det(ECSPlanToType, pat_partage),
    WantHGEndline        = det(ECSPlanToType, pat_hg),
    WantNounouEndline    = det(ECSPlanToType, pat_nounou),
    WantKnowNotYetEndline= det(ECSPlanToType, pat_dk),

    IdealCrecheEndline   = det(ECSIdealType, pat_creche),
    IdealCrecheAEndline  = det(ECSIdealType, pat_asso),
    IdealAssMatEndline   = det(ECSIdealType, pat_assmat),
    IdealJEEndline       = det(ECSIdealType, pat_je),
    IdealAutreEndline    = det(ECSIdealType, pat_autre) | det(ECSIdealType, pat_je),  # if JE included as "Autre" previously
    IdealPartageEndline  = det(ECSIdealType, pat_partage),
    IdealHGEndline       = det(ECSIdealType, pat_hg),
    IdealNounouEndline   = det(ECSIdealType, pat_nounou),
    IdealKnowNotYetEndline = det(ECSIdealType, pat_dk),
    
    # --- APPLICATION (only ECSAppType)
    
    AppCreche          = det(ECSAppType, pat_creche)    | det(ECSType, pat_creche)    | det(ECS2Type, pat_creche),
    AppCrecheA         = det(ECSAppType, pat_asso)      | det(ECSType, pat_asso)      | det(ECS2Type, pat_asso),
    AppAssMat          = det(ECSAppType, pat_assmat)    | det(ECSType, pat_assmat)    | det(ECS2Type, pat_assmat),
    AppJE              = det(ECSAppType, pat_je)        | det(ECSType, pat_je)        | det(ECS2Type, pat_je),
    AppAutre           = det(ECSAppType, pat_autre)     | det(ECSType, pat_autre)     | det(ECS2Type, pat_autre),
    AppPartage         = det(ECSAppType, pat_partage)   | det(ECSType, pat_partage)   | det(ECS2Type, pat_partage),
    AppHG              = det(ECSAppType, pat_hg)        | det(ECSType, pat_hg)        | det(ECS2Type, pat_hg),
    AppNounou          = det(ECSAppType, pat_nounou)    | det(ECSType, pat_nounou)    | det(ECS2Type, pat_nounou),
    AppHosp            = det(ECSAppType, pat_hosp)      | det(ECSType, pat_hosp)      | det(ECS2Type, pat_hosp),
    AppParentale       = det(ECSAppType, pat_parent)    | det(ECSType, pat_parent)    | det(ECS2Type, pat_parent),
    AppFamiliale       = det(ECSAppType, pat_fam)       | det(ECSType, pat_fam)       | det(ECS2Type, pat_fam),
    AppCrechePrivee    = det(ECSAppType, pat_privee)    | det(ECSType, pat_privee)    | det(ECS2Type, pat_privee),
    AppMicroCreche     = det(ECSAppType, pat_micro)     | det(ECSType, pat_micro)     | det(ECS2Type, pat_micro),
    AppMAM             = det(ECSAppType, pat_mam)       | det(ECSType, pat_mam)       | det(ECS2Type, pat_mam),
    AppCrecheMuni      = det(ECSAppType, pat_muni)      | det(ECSType, pat_muni)       | det(ECS2Type, pat_muni),
    AppCrecheDept      = det(ECSAppType, pat_dept)      | det(ECSType, pat_dept)       | det(ECS2Type, pat_dept),
    AppCrechePub       = AppCrecheMuni | AppCrecheDept,

    # --- Siblings (Brosis) — also robust patterns
    AppCrecheBrosis        = det(ECSBroSisAppType, pat_creche) | (ECSBroSisAppType == "Le même que celui utilisé pour   l'autre enfant" & det(ECSBrosisType, pat_creche)),
    AppCrecheABrosis       = det(ECSBroSisAppType, pat_asso)   | det(ECSBrosisType, pat_asso),
    AppAssMatBrosis        = det(ECSBroSisAppType, pat_assmat) | det(ECSBrosisType, pat_assmat),
    AppAutreCrecheBrosis   = det(ECSBroSisAppType, pat_autre)  | det(ECSBrosisType,  pat_autre),
    AppPartageBrosis       = det(ECSBroSisAppType, pat_partage)| det(ECSBrosisType,  pat_partage),
    AppHGBrosis            = det(ECSBroSisAppType, pat_hg)     | det(ECSBrosisType,  pat_hg),
    AppNounouBrosis        = det(ECSBroSisAppType, pat_nounou) | det(ECSBrosisType,  pat_nounou),
    AppHospBrosis          = det(ECSBroSisAppType, pat_hosp)   | det(ECSBrosisType,  pat_hosp),
    AppParentaleBrosis     = det(ECSBroSisAppType, pat_parent) | det(ECSBrosisType,  pat_parent),
    AppFamilialeBrosis     = det(ECSBroSisAppType, pat_fam)    | det(ECSBrosisType, pat_fam),
    AppCrechePriveeBrosis  = det(ECSBroSisAppType, pat_privee) | (ECSBroSisAppType == "Le même que celui utilisé pour l'autre enfant" & det(ECSBrosisType, pat_privee)) | det(ECSBrosisType, pat_privee),
    AppMicroCrecheBrosis   = det(ECSBroSisAppType, pat_micro)  | det(ECSBrosisType,  pat_micro),
    AppMAMBrosis           = det(ECSBroSisAppType, pat_mam)    | det(ECSBrosisType,  pat_mam),
    AppCrecheMuniBrosis = det(ECSBroSisAppType, pat_muni) |
                       (ECSBroSisAppType == "Le même que celui utilisé pour l'autre enfant" & det(ECSBrosisType, pat_muni)) |
                       det(ECSBrosisType, pat_muni),

    AppCrecheDeptBrosis = det(ECSBroSisAppType, pat_dept) |
                       (ECSBroSisAppType == "Le même que celui utilisé pour l'autre enfant" & det(ECSBrosisType, pat_dept)) |
                       det(ECSBrosisType, pat_dept),

    AppCrechePubBrosis  = AppCrecheMuniBrosis | AppCrecheDeptBrosis,
    AppSameECSBrosis         = str_detect(coalesce(ECSBroSisAppType, ""), "même")
  ) %>%
  # -------------------------
  # NA -> FALSE on all these logicals (no accidental NA propagation)
  # -------------------------
  mutate(
    across(KnowsCrechePubEndline:AppSameECSBrosis, ~ replace_na(., FALSE))
  ) %>%
  # -------------------------
  # Collapse to one row per ResponseId using ANY (logical OR),
  # then coerce to 0/1 for downstream sums.
  # -------------------------
  group_by(ResponseId) %>%
  summarise(
  across(KnowsCrecheEndline:AppSameECSBrosis, ~ as.integer(any(.))),
  .groups = "drop"
  ) %>%
  # -------------------------
  # Derived counts and composites (use rowSums on 0/1 columns)
  # -------------------------
  mutate(
    KnowsCrecheOnlyEndline =
      (KnowsCrecheEndline == 1) &
      rowSums(across(c(KnowsAssMatEndline, KnowsJEEndline, KnowsAutreEndline, KnowsPartageEndline,
                       KnowsHGEndline, KnowsNounouEndline, KnowsPrivéeEndline, KnowsMicroCrecheEndline,
                       KnowsMAMEndline, KnowsTPEEndline))) == 0, # = 1 si 

    KnownNbTypeECSEndline = rowSums(across(c(
      KnowsCrecheAEndline, KnowsCrechePubEndline, KnowsHospEndline, KnowsFamilialeEndline,
      KnowsParentaleEndline, KnowsPrivéeEndline, KnowsMicroCrecheEndline, KnowsAssMatEndline,
      KnowsJEEndline, KnowsAutreEndline, KnowsPartageEndline, KnowsHGEndline, KnowsMAMEndline,
      KnowsNounouEndline
    ))),

    Knows0r1ECSEndline = KnownNbTypeECSEndline <= 1,

    AppNbTypeECS = rowSums(across(c(
      AppCrecheA, AppAssMat, AppJE, AppAutre, AppPartage, AppHG, AppNounou, AppHosp,
      AppParentale, AppCrechePrivee, AppMicroCreche, AppMAM, AppCrecheMuni, AppCrecheDept
    ), .names = NULL), na.rm = TRUE),

    AppNbTypeECSBrosis = rowSums(across(c(
      AppCrecheABrosis, AppAssMatBrosis, AppPartageBrosis, AppHGBrosis, AppNounouBrosis,
      AppHospBrosis, AppParentaleBrosis, AppFamilialeBrosis, AppCrechePriveeBrosis, AppMicroCrecheBrosis, AppMAMBrosis,
      AppCrecheMuniBrosis, AppCrecheDeptBrosis,
      AppAutreCrecheBrosis
    )), na.rm = TRUE),

    AppNCreche = rowSums(across(c(
      AppCrecheA, AppHosp, AppParentale, AppFamiliale, AppCrechePrivee, AppMicroCreche, AppCrecheMuni,
      AppCrecheDept, AppAutre
    )), na.rm = TRUE)
  )


# Put all this data back into the main database
RCT_tot <- RCT_tot %>%
  left_join(
    ECS_df, 
    by = "ResponseId", 
    suffix = c("", ".ecs")  # so you can see if anything collided
  ) %>%
  mutate(
    ZipcodeEndline = dplyr::coalesce(
      dplyr::na_if(stringr::str_trim(as.character(MovedZipcode_1_TEXT)), ""),
      as.character(CodePostalBaseline)
    )
  ) # Create a variable Zipcode Endline that aggregate the initial Zipcode and the new Zipcode at endline if the family moved out
 

## We want to create a variable that counts the total number of ECS applied to. We will do this by creating a new dataframe with the number of types of ECS applied to and then joining it to the main dataframe

to_num <- function(x) suppressWarnings(as.numeric(x))

app <- RCT_tot %>%
  select(
    ResponseId,
    # keep only needed *_TEXT
    ECSAppType_15_TEXT, ECSAppType_3_TEXT,  ECSAppType_17_TEXT, ECSAppType_16_TEXT,
    ECSAppType_4_TEXT,  ECSAppType_18_TEXT, ECSAppType_5_TEXT,  ECSAppType_6_TEXT,
    ECSAppType_7_TEXT,  ECSAppType_8_TEXT,  ECSAppType_9_TEXT,  ECSAppType_10_TEXT,
    ECSAppType_11_TEXT,
    AppCrecheMuni, AppCrecheDept,
    ECSBroSisAppType_17_TEXT, ECSBroSisAppType_4_TEXT,  ECSBroSisAppType_18_TEXT,
    ECSBroSisAppType_20_TEXT, ECSBroSisAppType_19_TEXT, ECSBroSisAppType_5_TEXT,
    ECSBroSisAppType_6_TEXT,  ECSBroSisAppType_7_TEXT,  ECSBroSisAppType_8_TEXT,
    ECSBroSisAppType_9_TEXT,  ECSBroSisAppType_11_TEXT, ECSBroSisAppType_12_TEXT,
    AppCrecheMuniBrosis, AppCrecheDeptBrosis
  ) %>%
  mutate(

    # ---- Child
    AppNCrecheHops      = if_else(!is.na(ECSAppType_15_TEXT), to_num(ECSAppType_15_TEXT), 0),
    AppNCrecheAsso      = if_else(!is.na(ECSAppType_3_TEXT),  to_num(ECSAppType_3_TEXT),  0),
    AppNParentale       = if_else(!is.na(ECSAppType_17_TEXT), to_num(ECSAppType_17_TEXT), 0),
    AppNFamiliale       = if_else(!is.na(ECSAppType_16_TEXT), to_num(ECSAppType_16_TEXT), 0),
    AppNCrechePrivee    = if_else(!is.na(ECSAppType_4_TEXT),  to_num(ECSAppType_4_TEXT),  0),
    AppNMicroCreche     = if_else(!is.na(ECSAppType_18_TEXT), to_num(ECSAppType_18_TEXT), 0),
    AppNAutreCreche     = if_else(!is.na(ECSAppType_5_TEXT),  to_num(ECSAppType_5_TEXT),  0),
    AppNAssMat          = if_else(!is.na(ECSAppType_6_TEXT),  to_num(ECSAppType_6_TEXT),  0),
    AppNHG              = if_else(!is.na(ECSAppType_7_TEXT),  to_num(ECSAppType_7_TEXT),  0),
    AppNNounou          = if_else(!is.na(ECSAppType_8_TEXT),  to_num(ECSAppType_8_TEXT),  0),
    AppNJE              = if_else(!is.na(ECSAppType_9_TEXT),  to_num(ECSAppType_9_TEXT),  0),
    AppNPartage         = if_else(!is.na(ECSAppType_10_TEXT), to_num(ECSAppType_10_TEXT), 0),
    AppNMAM             = if_else(!is.na(ECSAppType_11_TEXT), to_num(ECSAppType_11_TEXT), 0),

    AppCrecheMuni   = coalesce(AppCrecheMuni,   FALSE),
    AppCrecheDept   = coalesce(AppCrecheDept,   FALSE),
    AppCrecheMuniBrosis = coalesce(AppCrecheMuniBrosis, FALSE),
    AppCrecheDeptBrosis = coalesce(AppCrecheDeptBrosis, FALSE),

    #Count how many of the two public options (municipal, departmental) the family applied to (0, 1, or 2)
    AppNCrechePub = case_when(
      AppCrecheMuni  & !AppCrecheDept  ~ 1L, # applied to municipal only TRUE FALSE
      !AppCrecheMuni &  AppCrecheDept  ~ 1L, # applied to departmental only FALSE TRUE
      AppCrecheMuni  &  AppCrecheDept  ~ 2L, # applied to both TRUE TRUE
      TRUE ~ 0L
    ),

    AppNTot_raw = AppNCrecheHops + AppNCrecheAsso + AppNParentale + AppNFamiliale +
                  AppNCrechePrivee + AppNMicroCreche + AppNAutreCreche + AppNAssMat + AppNHG +
                  AppNNounou + AppNJE + AppNPartage + AppNMAM + AppNCrechePub,

    AppNCreches  = AppNCrecheHops + AppNCrecheAsso + AppNParentale + AppNFamiliale +
                  AppNCrechePrivee + AppNMicroCreche + AppNAutreCreche + AppNCrechePub,

    AppNTot = if_else(AppNTot_raw == 302, 41L, AppNTot_raw),

    # ---- Siblings (verify the mapping for Micro-Crèche)
    AppNCrecheHopsBrosis      = if_else(!is.na(ECSBroSisAppType_17_TEXT), to_num(ECSBroSisAppType_17_TEXT), 0),
    AppNCrecheAssoBrosis      = if_else(!is.na(ECSBroSisAppType_4_TEXT),  to_num(ECSBroSisAppType_4_TEXT),  0),
    AppNParentaleBrosis       = if_else(!is.na(ECSBroSisAppType_18_TEXT), to_num(ECSBroSisAppType_18_TEXT), 0),
    AppNFamilialeBrosis       = if_else(!is.na(ECSBroSisAppType_20_TEXT), to_num(ECSBroSisAppType_20_TEXT), 0),
    AppNCrechePriveeBrosis    = if_else(!is.na(ECSBroSisAppType_19_TEXT), to_num(ECSBroSisAppType_19_TEXT), 0),

    AppNMicroCrecheBrosis     = if_else(!is.na(ECSBroSisAppType_5_TEXT),   to_num(ECSBroSisAppType_5_TEXT), 0), #here there was a mistake before, _19TEXT (same as Privée) was utilised. 
    #We replaced it with the correct one (_5_TEXT)
    AppNAutreCrecheBrosis     = if_else(!is.na(ECSBroSisAppType_6_TEXT),   to_num(ECSBroSisAppType_6_TEXT),   0),
    AppNAssMatBrosis          = if_else(!is.na(ECSBroSisAppType_7_TEXT),   to_num(ECSBroSisAppType_7_TEXT),   0),
    AppNHGBrosis              = if_else(!is.na(ECSBroSisAppType_8_TEXT),   to_num(ECSBroSisAppType_8_TEXT),   0),
    AppNNounouBrosis          = if_else(!is.na(ECSBroSisAppType_9_TEXT),   to_num(ECSBroSisAppType_9_TEXT),   0),
    AppNPartageBrosis         = if_else(!is.na(ECSBroSisAppType_11_TEXT),  to_num(ECSBroSisAppType_11_TEXT),  0),
    AppNMAMBrosis             = if_else(!is.na(ECSBroSisAppType_12_TEXT),  to_num(ECSBroSisAppType_12_TEXT),  0),

    AppNCrechePubBrosis = case_when(
      AppCrecheMuniBrosis & !AppCrecheDeptBrosis ~ 1L,
      !AppCrecheMuniBrosis & AppCrecheDeptBrosis ~ 1L,
      AppCrecheMuniBrosis &  AppCrecheDeptBrosis ~ 2L,
      TRUE ~ 0L
    ),

    AppNTotBrosis = AppNCrecheHopsBrosis + AppNCrecheAssoBrosis + AppNParentaleBrosis +
                    AppNFamilialeBrosis + AppNCrechePriveeBrosis + 
                    AppNAutreCrecheBrosis + AppNAssMatBrosis + AppNHGBrosis + AppNNounouBrosis +
                    AppNPartageBrosis + AppNMAMBrosis + AppNCrechePubBrosis,

    AppNTotALL = AppNTot + AppNTotBrosis
  )

# join back (explicit key)
RCT_tot <- RCT_tot %>% left_join(app, by = "ResponseId")

# Some birth dates were wrong at Baseline. We corrected them at Endline, so we want to replace them but only if they are wrong. 
# We have several variables called BirthDate in the survey because both babies bd and mothers' were called the same by mistake
# We will fist dealt with the mothers' birth dates and then the babies' birth dates

# BirthDate is the original variable, BirthDate_2_TEXT is the one with the "correct" birth dates when there was a typo. First we will recode the correct birth dates into the same format 
date_ref <-  ymd("2023-12-31") # We will use this date as a reference to turn birth date into age 
library(eeptools)
library(zoo)
RCT_tot <- RCT_tot %>% 
  mutate( BirthDateWrongRecoded = case_when(BirthDate_2_TEXT == "11.11.1991" ~ "11/11/1991", 
                                            BirthDate_2_TEXT == "14-03-1981" ~ "14/03/1981",
                                            BirthDate_2_TEXT == "15.10.2022" ~ "30/01/1996", # this one is obviously wrong: it is the baby's = we replace it by the mother's at Baseline, which is out best guess
                                            BirthDate_2_TEXT == "19-05-1994" ~ "19/05/1994",
                                            BirthDate_2_TEXT == "24-08-1987" ~ "24/08/1987",
                                            BirthDate_2_TEXT == "24-08-1992" ~ "24/08/1992",
                                            BirthDate_2_TEXT == "25-11-1985" ~ "25/11/1985",
                                            .default = as.character(BirthDate_2_TEXT)), 
          BirthDateWrongRecoded = as.Date(BirthDateWrongRecoded, format = "%d/%m/%Y"), 
          BirthDateWrongFormatted = format(BirthDateWrongRecoded, "%Y-%m-%d"),
          MotherBirthDateClean = ifelse(!is.na(BirthDateWrongFormatted) , as.character(BirthDateWrongFormatted) , 
                                  as.character(BirthDate)), 
          MotherAgeEndline = age_calc(as.Date(MotherBirthDateClean), date_ref, units = "years"), 
          
          FirstNameMother = case_when( !is.na(FirstName2) ~ as.character(FirstName2),  # Now, let's deal with Names and Surnames
                                       !is.na(PrenomEndline) ~ as.character(PrenomEndline), # first, names are all over the place -- merge the different columns of First Name Mother
                                      .default = as.character(PrenomBaseline)), 
          FirstNameMother = case_when((FirstNameMother == "-" | FirstNameMother == "NVP")~ NA,  # clean FirstNameMother to avoid info loss
                                      FirstNameMother == "Djeddi Cherifa" ~ "Cherifa",
                                      FirstNameMother == "Rotari Tatiana" ~ "Tatiana",
                                      FirstNameMother == "Phan" ~ "Hortense",
                                      FirstNameMother ==  "Cisse awa" ~ "Awa",
                                      FirstNameMother == "Gammoudi" ~ "Khaled", 
                                      Surname == "CHANE FANE Joelle" ~ "Joelle",
                                      .default =  as.character(FirstNameMother)), 
          SurnameMother = case_when((Surname == "-" | Surname == "/" | Surname == "2"| Surname == ";")~ NA,  # TO FINISH: now the Surnames
                                     PrenomBaseline == "Bintou" ~ "Dama", # we have a NA but that's the first name we had at Baseline, it's our best guess
                                    TRUE ~ as.character(Surname)), # Some First Names are also here, they should be cleaned in the future
          BabyLastNameSame = (BabyLastName == "Oui" | BabyLastName_3_TEXT == "Tradition encore trop encrée pour le nom paternel"), # TRUE if the baby has the same last name as the mother
          BabyLastNameDifferent= BabyLastName == "Non, C'est quoi ?",  # TRUE if we know the baby has a different last name as the mother
          BabyLastNameNVP =  BabyLastName == "Je ne souhaite pas répondre", # TRUE if we don't know
          BabyFirstName = case_when((NameFirst1 == "Ne veut pas" | NameFirst1 == "NVP" | NameFirst1 == "´´´"| NameFirst1 == "NE VEUX PAS donner le sexe ni le prénom de son bébé" | NameFirst1 == "NE VEUX PAS" |  NameFirst1 == "Ne veux pas répondre" |  NameFirst1 =="Ne veut pas répondre" |  NameFirst1 == "….")~ NA,  # clean first name first baby
                                      NameFirst1 == "Manda Savane" ~ "Manda",
                                      NameFirst1 == "Fofan Abdoulaye" ~ "Abdoulaye",
                                      NameFirst1 == "Ibrahima Gagny" ~ "Ibrahima",
                                      NameFirst1 == "Fofana" ~ "Fatim Keyla Fofana",
                                      NameFirst1 == "Elise et Alexandre" ~ "Elise",
                                    NameFirst1 == "Isaac Lonny Koné" ~ "Isaac Lonny",
                                    NameFirst1 == "Orélien et Erwan" ~ "Orélien",
                                  .default = as.character(NameFirst1)), 
          Baby2FirstName = NameFirst2 , # first name second baby, they seem all clean (we don't have more than Twins)
          BabyLastNameIfDiff = case_when((BabyLastName_3_TEXT == "NVP" | BabyLastName_3_TEXT == "Ne souhaite pas dire" | BabyLastName_3_TEXT == "/" | BabyLastName_3_TEXT == "2"| BabyLastName_3_TEXT == "…."  ) ~ NA,  # contains the last name baby if different from mother
                                     .default = as.character(BabyLastName_3_TEXT)), 
          TwinsYes = Twins =="Jumeaux", # TRUE if it was a twin pregnacy (we don't have more than that)
          TwinsNo = Twins == "Non", # TRUE if it was not a twin pregnancy
          BabyMale = SEX1 == "Garçon", # TRUE if the baby is a boy
          BabySexNVP = SEX1 == "Autre", # TRUE if we don't know the sex b/c the parent did not answer
          Baby2Girl = SEX2 == "Fille", # TRUE if the Second baby is a girl
          Baby2Boy = SEX2 == "Garçon", # TRUE if the Second baby is a boy, 
          BabyPrematuredYes = Prematured == "Oui, semaines (ex. 4)",
          BabyPrematuredNo = Prematured != "Oui, semaines (ex. 4)",
          BabyPrematuredNWeeks = ifelse(is.na(Prematured_2_TEXT), 0, Prematured_2_TEXT), # Number of weeks the baby was prematured
          BabyBirthWeight = case_when(BirthWeight1_1_TEXT == "3200"~ "3.2", # Birth weight of the first baby
                                      Health1_1_TEXT == "2.780" ~ "2.78",
                                      Health1_1_TEXT == "3.60" ~ "3.60",
                                      Health1_1_TEXT == "3,8" ~ "3.8",
                                      Health1_1_TEXT == "3,2" ~ "3.2",
                                      .default= as.character(BirthWeight1_1_TEXT)),
          BabyBirthWeightDK = is.na(BabyBirthWeight), # TRUE if we don't know the birth weight of the first baby
          BabyLowBirthWeight = as.numeric(BabyBirthWeight) < 2.5, # TRUE if the baby was born with a low birth weight
          BabyLowBirthWeight = ifelse(is.na(BabyLowBirthWeight), FALSE, BabyLowBirthWeight), # TRUE if the baby was born with a low birth weight
          Baby2BirthWeightDK = BirthWeight2 == "Je ne sais plus", # TRUE if we don't know the birth weight of the second baby
          Baby2BirthWeight = gsub(",", ".", BirthWeight2_1_TEXT), # Birth weight of the second baby
          Baby2BirthWeight = ifelse(Baby2BirthWeight == "1.2kg", 1.2, Baby2BirthWeight), # Birth weight of the second baby   
          Baby2LowBirthWeight = as.numeric(Baby2BirthWeight) < 2.5, # Careful, one is very low BW but it does not seem to be a typo
          BabyChronicDisease = case_when(Health1 == "Non" ~ "No", #  if the baby has a chronic disease
                                         Health1_1_TEXT == "0" ~ "No",
                                         Health1_1_TEXT == "2.780" ~ "No",
                                         Health1_1_TEXT == "3.2" ~ "No",
                                         Health1_1_TEXT == "3,8" ~ "No",
                                         Health1_1_TEXT == "3.60" ~ "No",
                                         Health1_1_TEXT == "4" ~ "No",
                                         Health1_1_TEXT == "3,2" ~ "No",
                                         Health1_1_TEXT == "Je ne souhaite pas répondre" ~ "No",
                                         Health1_1_TEXT == "Je ne souhaite pas répondre" ~ "No",
                                         str_detect(Health1_1_TEXT, "sthm") ~ "No", # Some diseases like GOR are not really chronic: here is asthma
                                        str_detect(Health1_1_TEXT, "chiolite") ~ "No", #bronchiolitis
                                        Health1_1_TEXT == "fente labiale" ~ "No", # cleft lip
                                         Health1_1_TEXT == "Eczéma" ~ "No",
                                        str_detect(Health1_1_TEXT, "croissance") ~ "No", # growth problems
                                        str_detect(Health1_1_TEXT, "jaunisse") ~ "No", # growth problems
                                         Health1_1_TEXT == "khyste ovaire droit" ~ "No", # cyst right ovary
                                         Health1_1_TEXT == "Malformation à l'oreille = surdité moyenne sur un côté uniquement" ~ "No", # ear problem
                                         Health1_1_TEXT == "Malformation cardiaque asymptomatique" ~ "No", # assymptomatic heart problem
                                         Health1_1_TEXT == "Née avec un angiome plan sur le visage" ~ "No", # heart problem
                                         str_detect(Health1_1_TEXT, "oids") ~ "No", # growth problems
                                         Health1_1_TEXT == "RGO " ~ "No", # GOR
                                         Health1_1_TEXT == "Sous traitement contre le reflux" ~ "No",
                                        is.na(Health1) ~ NA, # missing
                                         .default =  "Yes"), 
          BabyChronicDiseaseYes = BabyChronicDisease == "Yes", # TRUE if the baby has a chronic disease
          Baby2ChronicDiseaseYes = Health2 == "Oui, c'est :", # TRUE if the second baby has a chronic disease
          BabyNDaysMaternityDK = HealthHospA1 == "Je ne sais plus" , # TRUE if we don't know the number of days the baby stayed at the maternity
          BabyNDaysMaternity = HealthHospA1_1_TEXT, # Number of days the baby stayed at the maternity
          Baby2NDaysMaternity = HealthHospA2_1_TEXT, # Number of days the second baby stayed at the maternity
          BabyNDaysHospDK = (HealthHospB1 == "Je ne sais plus" | HealthHospB1 == "Je ne souhaite pas répondre"), # TRUE if we don't know the number of days the baby stayed in an hospital since they returned home
          BabyNDaysHosp = HealthHospB1_4_TEXT, # Number of days the baby stayed in an hospital since they returned home
          Baby2NDaysHosp = HealthHospB2_4_TEXT, # Number of days the second baby stayed in an hospital since they returned home
          BabyNDaysMaternityMoreThanMedian = as.numeric(BabyNDaysMaternity) > median(BabyNDaysMaternity, na.rm = TRUE), # TRUE if the baby stayed more than the median number of days at the maternity
          BabyNDaysHospMoreThanMedian = as.numeric(BabyNDaysHosp) > median(BabyNDaysHosp, na.rm = TRUE), # TRUE if the baby stayed more than the median number of days in an hospital since they returned home
          BabySujectiveHealth = HealthSubj1, # Subjective health of the baby. 
          BabySujectiveHealthNotGood = BabySujectiveHealth != "En bonne santé", # TRUE if the subjective health of the baby is not "good"
          Baby2SujectiveHealth = HealthSubj2, # Subjective health of the second baby. TO DISCUSS: do we want to dummyfy?
          MotherNDaysMaternityDK = HealthHospMomA != "Nombre", # TRUE if we don't know the number of days the mother stayed at the maternity
          MotherNDaysMaternity = HealthHospMomA_1_TEXT, # Number of days the mother stayed at the maternity
          MotherNDaysHospDK = HealthHospMomB != "Nombre", # TRUE if we don't know the number of days the mother stayed in an hospital since she returned home
          MotherNDaysHosp = HealthHospMomB_4_TEXT, # Number of days the mother stayed in an hospital since she returned home
          MotherNDaysMaternityMoreThanMedian = as.numeric(MotherNDaysMaternity) > median(MotherNDaysMaternity, na.rm = TRUE), # TRUE if the mother stayed more than the median number of days at the maternity
          MotherNDaysHospMoreThanMedian = as.numeric(MotherNDaysHosp) > median(MotherNDaysHosp, na.rm = TRUE), # TRUE if the mother stayed more than the median number of days in an hospital since she returned home
          BabyBirthDate = case_when(BabyBirthDate == "2023-11-13" ~ "2022-11-13", # Some of the Birth Dates have typos, correct them
                                    BabyBirthDate == "2023-11-16" ~ "2022-11-16", 
                                    BabyBirthDate == "2023-11-23" ~ "2022-11-23", 
                                    BabyBirthDate == "2023-11-28" ~ "2022-11-28", 
                                    BabyBirthDate == "2023-12-02" ~ "2022-12-02",
                                    BabyBirthDate == "2023-12-13" ~ "2022-12-13",
                                    BabyBirthDate == "2024-01-31" ~ "2023-01-31", 
                                    BabyBirthDate == "2024-12-14" ~ "2022-12-14", 
                                    BabyBirthDate == "2024-12-01" ~ "2022-12-01", 
                                    BabyBirthDate == "2021-10-19" ~ "2022-10-19", 	
                                    BabyBirthDate == "2022-02-24" ~ "2023-02-24", 	
                                    BabyBirthDate == "2022-03-01" ~ "2023-03-01",
                                    BabyBirthDate == "2021-11-21" ~ "2022-11-21",
                                    BabyBirthDate == "2022-02-12" ~ "2023-02-12",
                                    BabyBirthDate == "2022-01-14" ~ "2023-01-14",
                                    BabyBirthDate == "2021-01-15" ~ "2023-01-15",
                                    BabyBirthDate == "2020-01-01" ~ "2023-01-01",
                                    BabyBirthDate == "2022-02-11" ~ "2023-02-11",
                                    BabyBirthDate == "2022-01-17" ~ "2023-01-17",
                                    BabyBirthDate == "2021-02-21" ~ "2023-02-21",
                                    BabyBirthDate == "2023-10-20" ~ "2022-10-20",
                                    BabyBirthDate == "2023-10-30" ~ "2022-10-30",
                                    BabyBirthDate == "2023-11-07" ~ "2022-11-07",
                                    BabyBirthDate == "2023-11-18" ~ "2022-11-18",
                                    BabyBirthDate == "2023-11-17" ~ "2022-11-17",
                                    BabyBirthDate == "2023-10-21" ~ "2022-10-21",
                                    BabyBirthDate == "2023-11-26" ~ "2022-11-26",
                                    BabyBirthDate == "2023-12-30" ~ "2022-12-30",
                                    BabyBirthDate == "2023-12-16" ~ "2022-12-16",
                                    BabyBirthDate == "2023-12-15" ~ "2022-12-15",
                                    BabyBirthDate == "2023-11-05" ~ "2022-11-05",
                                    BabyBirthDate == "2023-10-14" ~ "2022-10-14",
                                    BabyBirthDate == "2023-12-07" ~ "2022-12-07",
                                    BabyBirthDate == "2023-12-11" ~ "2022-12-11",
                                    BabyBirthDate == "2023-12-08" ~ "2022-12-08",
                                    BabyBirthDate == "2023-10-07" ~ "2022-10-07",
                                    BabyBirthDate == "2023-08-22" ~ "2023-05-22", # date of birth impossible, this is our best guess based on baseline interview date and month of pregnancy
                                    BabyBirthDate == "2023-07-17" ~ "2023-03-17", # same
                                    BabyBirthDate == "2023-06-21" ~ "2023-01-21", # same
                                     TRUE ~ as.character(BabyBirthDate)), # note that some are 6 month old, which is borderline weird based on the date of the interview
          BabyNotBreastfed = Breastfeed1 == "Non", # TRUE if the baby was not breastfed
          StillBreastfeedingLength = as.numeric(difftime(EndDate_D, BabyBirthDate, units = "weeks")),
          BreastfeedingWeeks = Breastfeed1_1_TEXT * 4.345,
          BabyNWeeksBreastfed = case_when(!is.na(BreastfeedingWeeks) ~ BreastfeedingWeeks,
                                           BabyNotBreastfed == TRUE ~ 0,
                                           TRUE ~ StillBreastfeedingLength), # Number of months the baby was breastfed
          Baby2NotBreastfed = Breastfeed2 == "Non", # TRUE if the baby was not breastfed
          StillBreastfeeding2Length = as.numeric(difftime(EndDate_D, BabyBirthDate, units = "weeks")),
          Baby2BreastfeedingMonths = Breastfeed2_1_TEXT * 4.345, 
          Baby2NWeeksBreastfed = case_when(!is.na(Baby2BreastfeedingMonths) ~ Baby2BreastfeedingMonths,
                                           Baby2NotBreastfed == TRUE ~ 0,
                                           TRUE ~ StillBreastfeeding2Length), # Number of months the second baby was breastfed
          TreatmentReceivedYes = TreatmentReceived == "Oui", # TRUE if the mother received texts
          TreatmentWatchedYes = Compliance == "Oui", # TRUE if the mother watched the videos
          TreatmentWatchedTUntilEndYes = ComplianceFull == "Oui", # TRUE if the mother watched the videos until the end
          TreatmentWatchedTUntilEndYesOrMost = (ComplianceFull == "Oui" | ComplianceFull == "Certaines oui, certaines non"), # TRUE if the mother watched the videos until the end or most of them
          TreatmentWatchedNumber = case_when(ComplianceN == "Oui" ~ "5",
                                             ComplianceN_2_TEXT == "34" ~ "3",
                                             ComplianceN_2_TEXT == "6" ~ "5",
                                             !is.na(ComplianceN_2_TEXT) ~ as.character(ComplianceN_2_TEXT),
                                             TRUE ~ NA), # Number of videos watched)
          ComplianceNonWhy = case_when(
            ComplianceNonWhy == "Ca ne m’intéressait pas" ~ "Not relevant", 
            ComplianceNonWhy == "Je n’ai pas eu le temps" ~ "No time/procrastinated",
            ComplianceNonWhy == "Le lien paraissait suspect" ~ "Weird link",
            ComplianceNonWhy == "Au début ça ne m’intéressait pas et ensuite j’ai perdu le lien" ~ "Not relevant",
            ComplianceNonWhy == "Je n’ai pas reçu ces SMS ou Aucun SMS n’avait de lien" ~ "No link",
            ComplianceNonWhy == "J’étais trop fatiguée" ~ "Too tired/health issues",
            ComplianceNonWhy_7_TEXT == "je n'ai pas vu les vidéos" ~ "No link",
            ComplianceNonWhy_7_TEXT == "A déjà deux enfants, donc pas très intéressant pour elle" ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "a regardé les thématiques mais se sentait déjà suffisamment informée" ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "a reporté la lecture" ~ "No time/procrastinated",
            ComplianceNonWhy_7_TEXT == "absence de temps et barrière de la langue" ~ "No time/procrastinated",
            ComplianceNonWhy_7_TEXT == "affaibli par les complications" ~ "Too tired/health issues",
            ComplianceNonWhy_7_TEXT == "arrivé sur le téléphone de son mari" ~ "Partner's phone",
            ComplianceNonWhy_7_TEXT == "a reporté la lecture" ~ "No time/procrastinated",
            ComplianceNonWhy_7_TEXT == "Au début ça m'intéressait mais j'ai complètement oublié" ~ "No time/procrastinated",
            ComplianceNonWhy_7_TEXT == "Avait déjà un mode de garde" ~ "Not relevant", 
            ComplianceNonWhy_7_TEXT == "c'est son mari qui a reçu les sms, elle n'en avait pas connaissance" ~ "Partner's phone",
            ComplianceNonWhy_7_TEXT == "ne les concernait pas forcément, le mode de garde et tout" ~ "Not relevant", 
            ComplianceNonWhy_7_TEXT == "Déjà fait les démarches de crèche car devait reprendre études" ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "Elle a pas fait attention aux vidéos" ~ "No time/procrastinated",
            ComplianceNonWhy_7_TEXT == "Difficulté pour accéder" ~ "No time/procrastinated",
            ComplianceNonWhy_7_TEXT == "Difficultés avec la santé de son bébé" ~ "Too tired/health issues",
            ComplianceNonWhy_7_TEXT == "Discussion sur WhatsApp sans lien vidéo" ~ "No link",
            ComplianceNonWhy_7_TEXT == "Elle a pas fait attention aux vidéos" ~ "No time/procrastinated",
            ComplianceNonWhy_7_TEXT == "Elle ne sait pas lire" ~ "Cannot read",
            ComplianceNonWhy_7_TEXT == "Elle regardait au début, mais à la fin ne sait pas si elle a tout regardé, mais est sure qu'elle pas regardé les vidéos" ~ "No time/procrastinated",
            ComplianceNonWhy_7_TEXT == "était en deuil" ~ "Too tired/health issues",
            ComplianceNonWhy_7_TEXT == "Il n'y avait pas de lien" ~ "No link",
            ComplianceNonWhy_7_TEXT == "j'ai oublié" ~ "No time/procrastinated",
            ComplianceNonWhy_7_TEXT == "j'ai pas compris le but des sms et qu'il fallait voir les liens" ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "J'estime que j'avais déjà toutes les informations" ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "Je me rappelle pas, mais j'ai pas regardé les sms" ~ "Don't use texts",
            ComplianceNonWhy_7_TEXT == "Je ne me souviens pas" ~ "Don't know",
            ComplianceNonWhy_7_TEXT == "Je ne regarde pas beaucoup mes sms." ~ "Don't use texts",
            ComplianceNonWhy_7_TEXT == "J'estime que j'avais déjà toutes les informations" ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "La maman n'a pas eu le temps, et n'était pas intéressée pas les infos, et elle n'avait pas le temps non plus." ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "La maman vien de voir les sms, vu qu'ils étaient dans le spam de son téléphone mais n'a pas regardé les vidéos" ~ "SPAM",
            ComplianceNonWhy_7_TEXT == "La première fois que j'ai regardé , ça m'a pas intéressé, mais je n'ai reçu que 1 ou 2 liens dont 1 qui ne marche pas" ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "Le lien ne fonctionnait pas" ~ "Broken link",
            ComplianceNonWhy_7_TEXT == "Le lien ne marchait pas" ~ "Broken link",
            ComplianceNonWhy_7_TEXT == "lecteur ne fonctionnait pas" ~ "Broken link",
            ComplianceNonWhy_7_TEXT == "Le premier était pas intéressant + polluant : n'a pas lu" ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "lecteur ne fonctionnait pas" ~ "Broken link",
            ComplianceNonWhy_7_TEXT == "les sms passaient du coq à l'âne, surprise de les recevoir de manière irrégulière avec des sujets qui arrivaient sans raison et lien avec le développement du bébé" ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "lien ne fonctionnait pas" ~ "Broken link",
            ComplianceNonWhy_7_TEXT == "Lien ne fonctionnait pas" ~ "Broken link",
            ComplianceNonWhy_7_TEXT == "lien non fonctionnel" ~ "Broken link",
            ComplianceNonWhy_7_TEXT == "Manque d'intérêt" ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "N'a pas fait attention" ~ "No time/procrastinated",
            ComplianceNonWhy_7_TEXT == "N'a pas fait attention, c'était qu'au début qu'elle regardait les sms" ~ "Don't use texts",
            ComplianceNonWhy_7_TEXT == "n'a pas ouvert car s'est faite pirater, était méfiante" ~ "Weird link",
            ComplianceNonWhy_7_TEXT == "N'a pas vu qu'il y avait des vidéos" ~ "No link",
            ComplianceNonWhy_7_TEXT == "n'a simplement pas lu les sms ni visionné les vidéos" ~ "Don't use texts",
            ComplianceNonWhy_7_TEXT == "N'arrivait pas à ouvrir les liens" ~ "Broken link",
            ComplianceNonWhy_7_TEXT == "N'avait pas de téléphone à elle" ~ "Partner's phone",
            ComplianceNonWhy_7_TEXT == "N'avait pas le besoin pour les information" ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "N'avait pas vu qu'il y avait des vidéos" ~ "No link",
            ComplianceNonWhy_7_TEXT == "Ne comprenait pas à quoi ça servait a eu l'impression de louper certaines infos." ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "NE FOCNTIONNAIT PAS" ~ "Broken link",
            ComplianceNonWhy_7_TEXT == "Ne se souvient pas" ~ "No link",
            ComplianceNonWhy_7_TEXT == "Ne se souvient pas qu'il y avait des vidéo" ~ "No link",
            ComplianceNonWhy_7_TEXT == "Ne se souvient plus" ~ "No link",
            ComplianceNonWhy_7_TEXT == "ne voulait simplement pas regarder les videos" ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "Oubli" ~ "No time/procrastinated",
            ComplianceNonWhy_7_TEXT == "Oubli" ~ "No time/procrastinated",
            ComplianceNonWhy_7_TEXT == "oublie " ~ "No time/procrastinated",
            ComplianceNonWhy_7_TEXT == "Pas accès à internet" ~ "No internet",
            ComplianceNonWhy_7_TEXT == "pas adapté" ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "Pas assez de connexion" ~ "No internet",
            ComplianceNonWhy_7_TEXT == "Pas besoin" ~  "Not relevant",
            ComplianceNonWhy_7_TEXT == "pas canal privilégié pour trouver info" ~ "Don't use texts",
            ComplianceNonWhy_7_TEXT == "pas de smartphone" ~ "No internet",
            ComplianceNonWhy_7_TEXT == "Pas de vidéos et pas la tête à ça" ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "pas le temps" ~ "No time/procrastinated",
            ComplianceNonWhy_7_TEXT == "pas eu le temps et pas intéressée" ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "pas le temps car s'occupe du bébé" ~ "No time/procrastinated",
            ComplianceNonWhy_7_TEXT == "Pas reçu les liens" ~ "No link",
            ComplianceNonWhy_7_TEXT == "Pas regardé" ~ "Don't use texts",
            ComplianceNonWhy_7_TEXT == "Pas réussi à ouvrir le lien" ~ "Broken link",
            ComplianceNonWhy_7_TEXT == "pas utile pour moi" ~ "Not relevant",
            ComplianceNonWhy_7_TEXT == "Problèmes familiaux" ~ "Too tired/health issues",
            ComplianceNonWhy_7_TEXT == "Son partenaire ne lui a pas montré" ~ "Partner's phone",
            ComplianceNonWhy_7_TEXT == "Téléphone cassé" ~ "No internet",
            ComplianceNonWhy_7_TEXT == "Téléphone sans internet." ~ "No internet",
            ComplianceNonWhy_7_TEXT == "trop de sms envoyés -> avait demandé qu'on arrête + pas de temps" ~ "No time/procrastinated",
            TRUE ~ NA), # Reason why the mother did not watch the videos
            TreatmentUsefulness = ifelse(Usefulness_1 == 101, 100, Usefulness_1), # Usefulness of the treatment
            TreatmentSatisfaction = Satisfaction_1 , # Satisfaction with the treatment
            TreatmentWhyUnsatisfied = case_when((SatisfactionNotWhy == "Ca m'a soulé" |SatisfactionNotWhy == "SMS trop fréquents" ) ~ "Too much",# Reason why the mother was not satisfied with the treatment
                                                str_detect(SatisfactionNotWhy,"SMS non pertinents") ~ "Not relevant", 
                                                SatisfactionNotWhy == "J'ai cru que c'était une pub" ~ "Mixed with adds",
                                                SatisfactionNotWhy_6_TEXT == "6 textos en 6 mois, c'est très peu et pas toujours pertinents" ~ "Too little",
                                                SatisfactionNotWhy_6_TEXT == "alerte de sécurité quand clic sur le lien" ~ "Weird link",
                                                SatisfactionNotWhy_6_TEXT == "Avait déjà les informations" ~ "Already knew",
                                                SatisfactionNotWhy_6_TEXT == "Avait déjà les infos, pas utile pour elle" ~ "Already knew",
                                                SatisfactionNotWhy_6_TEXT == "Avait déjà une crèche" ~ "Already knew",
                                                SatisfactionNotWhy_6_TEXT == "C'était pas très pertinent, n'est pas la cible prioritaire (elle est rodée)" ~ "Already knew",
                                                SatisfactionNotWhy_6_TEXT == "c'était vraiment pas clair" ~ "Not relevant",  
                                                SatisfactionNotWhy_6_TEXT == "C’était très axée sur les modes de garde,  Plus destinée à des mamans nouvelles et pas les mamans qui ont déjà un enfant  Elle s’attendait à Plus de choses pour éveiller bébé ou prendre soin du bébé" ~ "Not relevant",
                                                SatisfactionNotWhy_6_TEXT == "Ca aurait été mieux par une application mobile" ~ "Don't use texts",   
                                                SatisfactionNotWhy_6_TEXT == "ça n'a pas répondu répondu à un besoin particulier, c'était pas un vrai accompagnement, c'était abstrait// pas un vrai programme pour elle" ~ "Too little",
                                                SatisfactionNotWhy_6_TEXT == "ça ne l'a pas aidée, elle voit l'utilité mais pour elle pas utile du tout" ~ "Already knew",
                                                SatisfactionNotWhy_6_TEXT == "Car c'était mon deuxième enfant" ~ "Already knew",
                                                
                                                SatisfactionNotWhy_6_TEXT == "Déjà bien informé" ~ "Already knew",
                                                SatisfactionNotWhy_6_TEXT == "déjà des enfants" ~ "Already knew",
                                                SatisfactionNotWhy_6_TEXT == "Déjà renseignée" ~ "Already knew",
                                                SatisfactionNotWhy_6_TEXT == "expérience avec enfants précédents, avait déjà fait inscription crèche et concentré sur bébé et expatriation" ~ "Already knew",
                                                SatisfactionNotWhy_6_TEXT == "Grand écart entre questionnaire et rencontre avec le premier collègue, pas trop de rapport" ~ "Not relevant",
                                                SatisfactionNotWhy_6_TEXT == "Infos pas assez ciblées, incohérences dans les informations envoyées... Mais très bonne initiative !" ~ "Not relevant",
                                                SatisfactionNotWhy_6_TEXT == "J'avais déjà les infos" ~ "Already knew",
                                                SatisfactionNotWhy_6_TEXT == "J'avais déjà les infos nécessaires" ~ "Already knew",
                                                SatisfactionNotWhy_6_TEXT == "L'aide n'a pas servi" ~ "Not relevant",
                                                SatisfactionNotWhy_6_TEXT == "La dernier appel pour faire le questionnaire de fin de projet n'est pas adapté aux jeunes parents. Etre disponible 20min pour appeler quelqu'un, même nos proches, c'est très compliqué quand on a un travail et un bébé. Il faudrait mieux le proposer en ligne, on pourrait vraiment prendre le temps de le faire tranquillement, dans les transports par exemple." ~ "Not relevant",
                                                SatisfactionNotWhy_6_TEXT == "N'a pas fait grand usage du programme car était déjà très renseignée" ~ "Already knew",
                                                SatisfactionNotWhy_6_TEXT == "N'a probablement pas reçu tous les messages (est un peu deg...)" ~ "Too little",
                                                SatisfactionNotWhy_6_TEXT == "N'a reçu que 2 SMS avec très peu d'infos - pensait qu'elle n'appartenait plus au projet" ~ "Too little",
                                                SatisfactionNotWhy_6_TEXT == "Pas assez fréquent. Pas assez conséquent, pas assez d'info. Préférence pour l'écrit." ~"Too little",
                                                SatisfactionNotWhy_6_TEXT == "pas besoin" ~ "Already knew",
                                                SatisfactionNotWhy_6_TEXT == "Pas eu le temps + premier enfant" ~ "Already knew",
                                                
                                                SatisfactionNotWhy_6_TEXT == "Pas intéressée" ~ "Not relevant",
                                                SatisfactionNotWhy_6_TEXT == "Pas le temps" ~ "No time/procrastinated",
                                                SatisfactionNotWhy_6_TEXT == "Pas parce que ce n'était pas intéressant, mais c'était plutot pas adéquat à la situation de la maman et ses priorités, e pour elle c'était plutôt de la théorie pas des choses concrètes sur comment trouver un mode de garde ou gérer sa situation avec son enfant ( des informations médicales : bébé de petit poids)" ~ "Not relevant",
                                                SatisfactionNotWhy_6_TEXT == "PAS RECU" ~ "Too little",
                                                SatisfactionNotWhy_6_TEXT == "pas reçu d'informations utiles" ~ "Not relevant",
                                                SatisfactionNotWhy_6_TEXT == "Peine à me concentrer" ~ "Other",
                                                SatisfactionNotWhy_6_TEXT == "Très déçue car pas d'aide pour trouver une crèche..." ~ "Not relevant",
                                                SatisfactionNotWhy_6_TEXT == "Trop occupée avec les petites" ~ "No time/procrastinated",
                                                SatisfactionNotWhy_6_TEXT == "perdu le lien" ~ "Other",
                                               TRUE ~ NA), 
          SingleMumEndline = Partner == "Non, et je ne suis pas en couple", # TRUE if the mother is a single mum
          CoupleCohabitingEndline = Partner == "Oui",
          CoupleNotCohabitingEndline = Partner == "Non, mais je suis en couple avec cette personne",
          CoupleOther = (Partner == "Non, mais je suis en couple avec une autre personne avec qui je vis" | Partner == "Non, mais je suis en couple avec une autre personne qui vit ailleurs" | Partner == "Oui, mais je ne suis plus en couple avec cette personne"),
          CoupleDK = (Partner == "Je ne souhaite pas répondre" | Partner == "Je ne sais pas"), # TRUE if the mother does not want to answer or does not know if she is in a couple
          WorkMotherReduced = WorkMotherIntRelat == "Réduit votre activité professionnelle par rapport à avant votre grossesse",
          WorkMotherWantYes = WorkMotherWant == "Oui", # TRUE if the mother wants to work, 
          WorkMotherWantNo = WorkMotherWant == "Non", # TRUE if the mother does not want to work
          WorkMotherWantDK = WorkMotherWant == "Je ne sais pas encore", # TRUE if the mother does not know if she wants to work
          WorkMotherDKWhen = WorkMotherWantWhen == "Je ne sais pas encore", # TRUE if the mother does not know when she wants to work
          WorkMotherWhen = WorkMotherWantWhen_1_TEXT, # When would the mother like to find a job, there are some extreme values
          OccupationFatherEndline = case_when( 
                     (WorkFather_10_TEXT =="arrêt maladie" | WorkFather_10_TEXT =="Arrêt maladie" |WorkFather_10_TEXT =="Congé maladie" |WorkFather_10_TEXT =="En intérim" |WorkFather_10_TEXT =="en train de créer une entreprise" |WorkFather_10_TEXT =="Entrepreneur indépendant"|WorkFather_10_TEXT =="monte son entreprise" |WorkFather_10_TEXT == "monte son entreprise") ~"Occupe un emploi / travaille", 
                    (str_detect(WorkFather_10_TEXT,"régula") | str_detect(WorkFather_10_TEXT,"papiers")  | str_detect(WorkFather_10_TEXT,"séjour") | str_detect(WorkFather_10_TEXT,"black")) ~"Sans activité professionnelle / femme au foyer", 
                     .default = as.character(WorkFather)), 
          ActiveFatherEndline = ifelse( (WorkFather == "Etudiant, stagiaire non rémunéré, formation" | WorkFather == "Occupe un emploi / travaille" | WorkFather == "Apprenti(e) sous contrat ou en stage rémunéré" ), "Yes", "No"),  # Dummy that takes a 1 if the partner is active at Endline
          ActiveFatherEndline1or0 = ifelse( (WorkFather == "Etudiant, stagiaire non rémunéré, formation" | WorkFather == "Occupe un emploi / travaille" | WorkFather == "Apprenti(e) sous contrat ou en stage rémunéré" ), 1, 0),  # Dummy that takes a 1 if the partner is active at Endline
          ActiveFatherEndline = as.numeric(ActiveFatherEndline1or0), # Turns this dummy into numerics
          ParentalLeaves = (WorkFather == "Occupe un emploi, mais est en congé parental" | WorkFather == "Occupe un emploi, mais est en congé parental"), # TRUE if one parent is on parental leave
          WorkBothParentsNoWork = ((WorkFather == "Occupe un emploi, mais est en congé parental" | WorkFather == "Sans activité professionnelle / femme au foyer" | WorkFather == "Au chômage / en recherche active d’emploi (inscrit pôle emploi ou pas)" | WorkFather == "Retraité, préretraite, en pension d’invalidité etc." ) & (OccupationEndline == "Occupe un emploi, mais est en congé parental" | OccupationEndline == "Sans activité professionnelle / femme au foyer" | OccupationEndline == "Au chômage / en recherche active d’emploi (inscrit pôle emploi ou pas)")), # TRUE if  both parents don't work
          WorkOneParentNoWork = (WorkFather == "Occupe un emploi, mais est en congé parental" | WorkFather == "Sans activité professionnelle / femme au foyer" | WorkFather == "Au chômage / en recherche active d’emploi (inscrit pôle emploi ou pas)" | WorkFather == "Retraité, préretraite, en pension d’invalidité etc." | OccupationEndline == "Occupe un emploi, mais est en congé parental" | OccupationEndline == "Sans activité professionnelle / femme au foyer" | OccupationEndline == "Au chômage / en recherche active d’emploi (inscrit pôle emploi ou pas)"), # TRUE if at least one of the parents don't work
          WorkFatherFullTime = WorkFatherIntensity == "Temps plein (> 85% soit 30h/semaine)",
          WorkFatherReduced = WorkFatherIntRelat == "Réduit votre activité professionnelle par rapport à avant votre grossesse",
          WorkOneParentReduced = (WorkMotherIntRelat == "Réduit votre activité professionnelle par rapport à avant votre grossesse" | WorkFatherIntRelat == "Réduit votre activité professionnelle par rapport à avant votre grossesse"), # TRUE if at least one of the parents reduced their work
          WorkBothParentsReduced = (WorkMotherIntRelat == "Réduit votre activité professionnelle par rapport à avant votre grossesse" & WorkFatherIntRelat == "Réduit votre activité professionnelle par rapport à avant votre grossesse"), # TRUE if both parents reduced their work
          WorkFatherWantYes = WorkFatherWant == "Oui", # TRUE if the partner wants to work, 
          WorkFatherWantNo = WorkFatherWant == "Non", # TRUE if the partner does not want to work
          WorkFatherWantDK = WorkFatherWant == "Je ne sais pas encore", # TRUE if the partner does not know if she wants to work
          WorkFatherDKWhen = WorkMFaherWantWhen == "Je ne sais pas encore", # TRUE if the partner does not know when she wants to work
          WorkFatherWhen = WorkMFaherWantWhen_1_TEXT, # When would the partner like to find a job, there are some extreme values
          Depriv_1 = ifelse(Depriv_1 == "Je ne souhaite pas répondre", "Pas du tout", as.character(Depriv_1)),           # Construct the deprivation score
          Depriv_2 = ifelse(Depriv_2 == "Je ne souhaite pas répondre", "Pas du tout", as.character(Depriv_2)), 
          MovedOut = Moved == "Oui", # TRUE if the mother moved out
          MovedOutDate = case_when(
            MovedWhen_1_TEXT == "01 06 2023" ~ "01/06/2023",
            MovedWhen_1_TEXT == "01/01/2012" ~ NA, # it cannot be true -- they were surveyed in 2022
            MovedWhen_1_TEXT == "01/01/2014" ~ "01/01/2024",
            TRUE ~ as.character(MovedWhen_1_TEXT)), # Date when the mother moved out
          UseCareMother = str_detect(ECSNoChildcareType,"vous"),  # no childcare, mother care
          UseCareFather = (str_detect(ECSNoChildcareType,"conjoint") | str_detect(ECSNoChildcareType_5_TEXT, "papa")),  # no childcare, partner care
          UseCareGrandParent = (str_detect(ECSNoChildcareType,"grands-parents") |  str_detect(ECSNoChildcareType_5_TEXT, "cousine")),  # no childcare, grand-parent care
          UseCareInformal = (str_detect(ECSNoChildcareType,"voisin") | str_detect(ECSNoChildcareType_5_TEXT,"ami" )  | str_detect(ECSNoChildcareType_5_TEXT,"nou" )|  str_detect(ECSNoChildcareType_5_TEXT, "Technicienne" )|  str_detect(ECSNoChildcareType_5_TEXT, "Personne") | str_detect(ECSNoChildcareType_5_TEXT, "maternelle"))  ,  # no childcare, neighbor or other informal care
          ECSIntensityDK = (ECSIntensity == "Je ne sais pas" | ECSIntensity == "Je ne souhaite pas répondre"  ), # TRUE if the mother does not know the intensity of the ECS
          ECSIntensity = case_when(ECSIntensity_1_TEXT == 255 ~ 42, 
                                   ECSIntensity_1_TEXT == 385 ~ 96.25,
                                   ECSIntensity_1_TEXT == 475 ~ 118.75,
                                   ECSUseYes == 0 ~ 0,
                                   TRUE ~ ECSIntensity_1_TEXT), # Intensity of the ECS
          ECSCombine2ECS = ECS2 == "Oui", 
          ECSAppNoECSStillWaiting = ECSNoECSAppAnswer == "Non, on attend encore", # Applied but are still waiting for answer
          ECSAppAcceptedButCouldnt = ECSNoECSAppAnswer == "Oui,  on été acceptés dans au moins 1 mais il y a eu un problème", # Applied, were accepted but troubles
          ECSAppAcceptedButRefused = ECSNoECSAppAnswer == "Oui,  on été acceptés dans au moins 1 mais on a refusé (à cause d'un problème, etc.)",# Applied, were accepted but refused
          ECSAppAcceptedButDelayed = ECSNoECSAppAnswer ==  "Oui,  on été acceptés mais on a dû repousser à cause de problèmes (de santé)", # Applied, were accepted but delayed
          ECSAppNoECSwaitingList = ECSNoECSAppAnswer == "Oui, on est sur la liste d’attente",  # Applied, are on waiting list
          ECSAppAcceptedButMoved = ECSNoECSAppAnswer == "Oui, on été acceptés, mais on a déménagé",  # Applied, were accepted but moved out
          ECSNoECSWhyRefusal = case_when(
            (ECSNoECSWhyRefusal_5_TEXT == "A finalement pris un congé parental et a changé d'avis" |ECSNoECSWhyRefusal_5_TEXT == "A pris la décision de finalement prendre un congé parental plus long pour s'occuper d'elles" | ECSNoECSWhyRefusal_5_TEXT ==  "Changé d'avis" | ECSNoECSWhyRefusal_5_TEXT ==   "choix pour garder sa fille" |ECSNoECSWhyRefusal_5_TEXT ==  "Elle trouvait que son bébé était trop petite" |ECSNoECSWhyRefusal_5_TEXT ==  "Elle voulait la garder" |ECSNoECSWhyRefusal_5_TEXT ==  "Le congé parental a été accepté" |ECSNoECSWhyRefusal_5_TEXT ==  "Ne se sentait pas prête de laisser son enfant" |ECSNoECSWhyRefusal_5_TEXT ==  "Voulait garder bébé jusqu'à ce qu'il grandisse encore un peu et avait également besoin d'une place pour sa soeur qui est dans sa deuxième année" | ECSNoECSWhyRefusal_5_TEXT == "Pas possible de mettre l'autre enfant en même temps à cette creche" ) ~ "Wanted to keep the baby", (ECSNoECSWhyRefusal_5_TEXT == "ça n'allait pas avec ses horaires et c'était trop loin" |ECSNoECSWhyRefusal_5_TEXT ==  "crèche ouvrait trop tard") ~ "Ca n’allait pas avec mes horaires de travail" , 
          TRUE ~ as.character(ECSNoECSWhyRefusal)), # Reason why the mother refused the ECS
          ECSWhyRefusedTooExpensive = ECSNoECSWhyRefusal == "C’était trop cher", # Reason why the mother refused the ECS: too expensive
          ECSWhyRefusedTooFar = ECSNoECSWhyRefusal == "C'était trop loin", # Reason why the mother refused the ECS: too far away
          ECSWhyRefusedWantKeepBaby = ECSNoECSWhyRefusal == "Wanted to keep the baby", # Reason why the mother refused the ECS: too hard to leave the baby
          ECSWhyRefusedWorkHours = ECSNoECSWhyRefusal == "Ca n’allait pas avec mes horaires de travail", # Reason why the mother refused the ECS: incompatible with work hours
          ECSNoECSAppRenwNoWhy = case_when(
            ECSNoECSAppRenwNoWhy_5_TEXT == "A pris la décision de finalement prendre un congé parental plus long pour s'occuper d'elles" ~ "J’ai changé d’avis",
            (
              ECSNoECSAppRenwNoWhy_5_TEXT == "A candidaté la semaine dernière!" | ECSNoECSAppRenwNoWhy_5_TEXT ==  "Ils lui ont dit d'attendre"| ECSNoECSAppRenwNoWhy_5_TEXT ==  "Elle est entrain de la renouveler"| ECSNoECSAppRenwNoWhy_5_TEXT ==  "Ils ont dit d'attendre février"| ECSNoECSAppRenwNoWhy_5_TEXT ==  "on attend" | ECSNoECSAppRenwNoWhy_5_TEXT ==  "Ils ont dit d'attendre janvier avant de candidater" | ECSNoECSAppRenwNoWhy_5_TEXT ==  "Particularité de la municipalité, les renouvellements de demandes sont faits automatiquement" | ECSNoECSAppRenwNoWhy_5_TEXT ==  "Still waiting" | ECSNoECSAppRenwNoWhy_5_TEXT ==  "une seule insccription" | ECSNoECSAppRenwNoWhy_5_TEXT ==  "Vient récemment de faire la demande" | ECSNoECSAppRenwNoWhy_5_TEXT ==  "en attente" |  ECSNoECSAppRenwNoWhy_5_TEXT == "j'attends le courrier de réponse" |  ECSNoECSAppRenwNoWhy_5_TEXT ==  "La mairie l'a informée que ce n'était pas nécessaire"
             ) ~ NA,
            ECSNoECSAppRenwNoWhy_5_TEXT == "a décidé de garder Lila et renouvellera sa demande l'année prochaine en crèche municipale." ~ "Je ne savais pas qu’il fallait le faire",
            ECSNoECSAppRenwNoWhy_5_TEXT == "A été refusée car demandait temps partiel" ~ "Je ne savais pas qu’il fallait le faire",
            ECSNoECSAppRenwNoWhy_5_TEXT == "a pris un congé parental" ~ "Je me suis débrouillé autrement",
            ECSNoECSAppRenwNoWhy_5_TEXT == "ça ne convenait pas aux horaires de travail" ~ "Je me suis débrouillé autrement",
            ECSNoECSAppRenwNoWhy_5_TEXT == "déménagement" ~ "Déménagement",
            ECSNoECSAppRenwNoWhy_5_TEXT == "Déménagement" ~ "Déménagement",
            ECSNoECSAppRenwNoWhy_5_TEXT == "Elle attendait notre collègue pour la faire avec elle, elle a envoyé un sms à elle mais n'a pas eu de réponse (elle m'a dit que c'était la même personne qui a fait le questionnaire avec elle à l'hôpital) ." ~ "Je ne savais pas comment faire",
            ECSNoECSAppRenwNoWhy_5_TEXT ==  "La demande est toujours en cours sur le site" ~ "Je ne savais pas qu’il fallait le faire",
            ECSNoECSAppRenwNoWhy_5_TEXT == "Ils lui ont répondu négativement en juillet deux mois après sa demande" ~ "Je ne savais pas qu’il fallait le faire",
            ECSNoECSAppRenwNoWhy_5_TEXT == "Ils ont déménagé/ et ils avait bcp de problèmes ne savaient pas s'ils vont rester dans le nouveau département" ~ "Déménagement",
            ECSNoECSAppRenwNoWhy_5_TEXT == "J'ai déménagé" ~ "Déménagement",
            ECSNoECSAppRenwNoWhy_5_TEXT == "J'ai pas eu le temps" ~ "Pas eu le temps/procrastine",
            ECSNoECSAppRenwNoWhy_5_TEXT == "J'ai pas le temps" ~ "Pas eu le temps/procrastine",
            ECSNoECSAppRenwNoWhy_5_TEXT == "Je dois le faire" ~ "Pas eu le temps/procrastine",
            ECSNoECSAppRenwNoWhy_5_TEXT == "Je vais le faire pour le mois de mai" ~ "Pas eu le temps/procrastine",
            ECSNoECSAppRenwNoWhy_5_TEXT == "L'assistante sociale qui se chargeait de son dossier lui avait dit d'attendre jusqu'à septembre mais elle ne lui répond plus" ~ "Je ne savais pas comment faire",
            ECSNoECSAppRenwNoWhy_5_TEXT == "n'est pas sûre de renouveler" ~ "J’ai changé d’avis",
            ECSNoECSAppRenwNoWhy_5_TEXT == "Ne sait pas comment faire" ~ "Je ne savais pas comment faire",
            ECSNoECSAppRenwNoWhy_5_TEXT == "pas de place" ~ "Je ne savais pas qu’il fallait le faire",
            ECSNoECSAppRenwNoWhy_5_TEXT == "Pas vraiment l'intention de la mettre en crèche" ~"J’ai changé d’avis",
            ECSNoECSAppRenwNoWhy_5_TEXT == "Problèmes administratifs" ~  "Je ne savais pas comment faire",
            ECSNoECSAppRenwNoWhy_5_TEXT == "Projet de démission pour fonder une enseigne donc plus besoin" ~ "J’ai changé d’avis",
            ECSNoECSAppRenwNoWhy_5_TEXT == "refus des AM" ~ "Je ne savais pas qu’il fallait le faire",
            ECSNoECSAppRenwNoWhy_5_TEXT == "rejet" ~ "Je ne savais pas qu’il fallait le faire",
            TRUE~as.character(ECSNoECSAppRenwNoWhy)
          ), # Reason why the mother did not renew the ECS application
           ECSNoECSAppRenewed = case_when(
             ECSNoECSAppRenwNoWhy_5_TEXT == "A candidaté la semaine dernière!" ~ "Pas pertinent",
             ECSNoECSAppRenwNoWhy_5_TEXT == "Elle est entrain de la renouveler" ~ "Oui",
             ECSNoECSAppRenwNoWhy_5_TEXT == "Ils lui ont dit d'attendre" ~ "Pas pertinent",
             ECSNoECSAppRenwNoWhy_5_TEXT == "La demande est toujours en cours sur le site" ~ "Pas pertinent",
             ECSNoECSAppRenwNoWhy_5_TEXT == "on attend" ~ "Pas pertinent",
             ECSNoECSAppRenwNoWhy_5_TEXT == "On lui a dit d'attendre février" ~ "Pas pertinent",
             ECSNoECSAppRenwNoWhy_5_TEXT == "On lui a dit d'attendre janvier avant de candidater" ~ "Pas pertinent",
             ECSNoECSAppRenwNoWhy_5_TEXT == "Particularité de la municipalité, les renouvellements de demandes sont faits automatiquement" ~ "Pas pertinent",
             ECSNoECSAppRenwNoWhy_5_TEXT == "Still waiting" ~ "Pas pertinent",
             ECSNoECSAppRenwNoWhy_5_TEXT == "une seule insccription" ~ "Pas pertinent",
             ECSNoECSAppRenwNoWhy_5_TEXT == "Vient récemment de faire la demande" ~ "Oui",
             ECSNoECSAppRenwNoWhy_5_TEXT == "en attente" ~ "Pas pertient",
             ECSNoECSAppRenwNoWhy_5_TEXT == "j'attends le courrier de réponse" ~ "Pas pertinent",
             ECSNoECSAppRenwNoWhy_5_TEXT == "La mairie l'a informée que ce n'était pas nécessaire" ~ "Pas pertinent",
             TRUE ~ as.character(ECSNoECSAppRenewed)), #  if the mother renewed the ECS application
          ECSAppRenewedNo = ECSNoECSAppRenewed == "Non", # TRUE if the mother did not renew the ECS application
          ECSAppRenewedYes = ECSNoECSAppRenewed == "Oui", # TRUE if the mother renewed the ECS application
          ECSNoECSAppRenewedNotRelevant =  ECSNoECSAppRenewed == "Pas pertinent" | ECSNoECSAppRenewed == "Je ne sais pas", # TRUE if not relevant/does not know if the mother renewed the ECS application
          ECSAppNotRenwedWhyDidNotKnow = ECSNoECSAppRenwNoWhy == "Je ne savais pas qu’il fallait le faire", # Reason why the mother did not renew the ECS application: did not know how to do it
          ECSAppNotRenwedWhyChangedMind = ECSNoECSAppRenwNoWhy == "J’ai changé d’avis", # Reason why the mother did not renew the ECS application: changed her mind
          ECSAppNotRenwedWhyDidWithout = ECSNoECSAppRenwNoWhy == "Je me suis débrouillé autrement", # Reason why the mother did not renew the ECS application: found another solution
          ECSAppNotRenwedWhyGaveUp = ECSNoECSAppRenwNoWhy == "J'ai abandonné", # Reason why the mother did not renew the ECS application: no time
          ECSAppNotRenwedWhyMovedOut = ECSNoECSAppRenwNoWhy == "Déménagement", # Reason why the mother did not renew the ECS application: moved
          # preserve the original label and derive flags from it
          ECSAppTimingLabel = ECSAppTimingDK,  # was a 3-level string: Avant / Après / Je ne sais plus du tout
          ECSAppTimingDK    = ECSAppTimingLabel == "Je ne sais plus du tout",
          
          # derive Before/After preferring the label, falling back to dates
          ECSAppTimingBeforeBirth = dplyr::case_when(
            ECSAppTimingLabel == "Avant la naissance" ~ "Yes",
            ECSAppTimingLabel == "Après la naissance" ~ "No",
            !is.na(ECSAppTiming_1_TEXT) & !is.na(BabyBirthDate) & (ECSAppTiming_1_TEXT <  BabyBirthDate) ~ "Yes",
            !is.na(ECSAppTiming_1_TEXT) & !is.na(BabyBirthDate)                                         ~ "No",
            TRUE ~ NA_character_
          ),
          ECSAppTimingAfterBirth = dplyr::case_when(
            ECSAppTimingLabel == "Après la naissance" ~ "Yes",
            ECSAppTimingLabel == "Avant la naissance" ~ "No",
            !is.na(ECSAppTiming_1_TEXT) & !is.na(BabyBirthDate) & (ECSAppTiming_1_TEXT >= BabyBirthDate) ~ "Yes",  # same day = after
            !is.na(ECSAppTiming_1_TEXT) & !is.na(BabyBirthDate)                                          ~ "No",
            TRUE ~ NA_character_
          ),
          
          # keep the date column as-is
          ECSAppTiming = ECSAppTiming_1_TEXT,          
          ECSStartDateWanted = ECSAppDateWanted_1_TEXT, # Date when the mother wanted the ECS to start
          ApplicationWentOnSiteYes = ApplicationWentOnSit == "Oui", # Went on site to try to get a place
          ApplicationCalled = ECSAppCalled == "Oui", # Called the ECS to try to get a place
          ApplicationNetworked = ApplicationNetworked == "Oui", # Contacted a mayor/stakeholder to try to get a place
          ECSOpposedEndline = ECSPlanToEndline == "No", # Is opposed to ECS at Endline (is sure they do not plan to) 
          ECSNoAppRensYes = ECSRens == "Oui", # TRUE if the mother has already gathered information about ECS,
          ECSRensNo = ECSRens == "Non", # TRUE if the mother  has already gathered information about ECS,
          ECSRensYes = (ECSNoAppRensYes == TRUE | ECSApp == 1), # TRUE if the mother has already gathered information about ECS
          ECSRensWhen = ECSRensWhen_1_TEXT, # when did the mother start gathering information about ECS
          ECSGotIdealECS = ECSIdeal == "Non, c’était mon mode de garde préféré.", # TRUE if the mother got the ECS she wanted
          ECSGotIdealECSNo = ECSIdeal == "Oui", # TRUE if the mother did not get the ECS she wanted
          ECSGotIdealECSDK = (ECSIdeal == "Je ne sais pas" |ECSIdeal == "Je ne souhaite pas répondre"), # TRUE if the mother doesn't know if she got the ECS she wanted
          ECSIdealNotReasonSynth = case_when( 
            ECSIdealNotReason_5_TEXT == "19/20 des assistantes maternelles qu'ils ont contacté ne correspondaient pas du tout à leurs attentes. Il se demande comment on peut confier son enfant à des personnes aussi peu qualifiées." ~ "No spot",
            str_detect(ECSIdealNotReason_5_TEXT, "ménage") ~ "Moved out",
            ECSIdealNotReason_5_TEXT == "A eu une place mais trop tard, sa fille était déjà inscrite en micro-crèche et par ailleurs ils avaient déménagé donc ce n'était plus intéressant pour elle." ~ "Moved out",
            ECSIdealNotReason_5_TEXT == "A fait les démarches auprès d'une assistante sociale mais n'a pas pu déposer la candidature à la crèche à cause de problème de santé" ~ "Health issues",
            ECSIdealNotReason_5_TEXT == "A finalement eu une place dans une crèche municipale trop loin du domicile." ~ "No spot",
            ECSIdealNotReason_5_TEXT == "a pris la place qui lui a été donnée" ~ "No spot",
            ECSIdealNotReason_5_TEXT == "a profité de saisir l'opportunité de la place proposée par la  crèche privée où travaille par peur de ne rien trouver par aprè" ~ "No spot",
            ECSIdealNotReason_5_TEXT == "a vu que les inscriptions étaient passées quand elle s'est renseignée" ~ "No spot",
            ECSIdealNotReason_5_TEXT == "Administrativement compliqué" ~ "Aministrative burden too heavy/applied to late",
            ECSIdealNotReason_5_TEXT == "Attend les réponses" ~ "No spot",
            ECSIdealNotReason_5_TEXT == "attente"~ "No spot",
            ECSIdealNotReason_5_TEXT == "Aucun des modes de garde ne lui convenait pas a été obligé pour reprendre le travail" ~ "No spot",                             
            ECSIdealNotReason_5_TEXT == "bébé sur liste d'attente" ~ "No spot",
            ECSIdealNotReason_5_TEXT == "C'est ce que la mairie leur a donné." ~ "No spot",
            ECSIdealNotReason_5_TEXT == "ça ne m'a pas plu" ~ "No spot",   
            ECSIdealNotReason_5_TEXT == "ça se passe tellement bien avec l'ass mat que ne veut pas changer" ~ "got something else and is satisfied",
            ECSIdealNotReason_5_TEXT == "car a obtenu une place à la crèche beaucoup plus tôt le 27/01/2023"~"got something else and is satisfied",
            ECSIdealNotReason_5_TEXT == "Commission trop tard, s'est tournée vers autre solution"~"got something else and is satisfied",
            str_detect(ECSIdealNotReason_5_TEXT, "sa structure privée (dans laquelle elle travaillait) qui ne lui convenait pas comme prise en charge pour son enfant, en gros il pouvait le résilier quand il voulait")~ "No spot",
            ECSIdealNotReason_5_TEXT == "Crèche seulement a la marche acquise"~ "No spot",
            ECSIdealNotReason_5_TEXT == "date limite de naissance des enfants acceptés pour la commission de septembre"~ "No spot",
            ECSIdealNotReason_5_TEXT == "délai trop court"~ "Aministrative burden too heavy/applied to late", 
            ECSIdealNotReason_5_TEXT == "date limite de naissance des enfants acceptés pour la commission de septembre"~ "No spot",
            ECSIdealNotReason_5_TEXT == "Devait reprendre le travail"~  "No spot",
            ECSIdealNotReason_5_TEXT == "dossier non actualisé pour septembre doit passer dans commission de novembre"~ "Aministrative burden too heavy/applied to late", 
            ECSIdealNotReason_5_TEXT == "Dossier non traité par la mairie"~ "Aministrative burden too heavy/applied to late",
            ECSIdealNotReason_5_TEXT == "Elle a eu la place, mais qu'en septembre, mais ils étaient déjà chez une assmat, ils voulaient pas la perturber"~ "got something else and is satisfied",
            ECSIdealNotReason_5_TEXT == "Elle attend une place"~ "No spot",
            ECSIdealNotReason_5_TEXT == "Elle n'a pas encore fait les démarches."~ "Aministrative burden too heavy/applied to late",
            ECSIdealNotReason_5_TEXT == "Elle pensait pouvoir garder la petite un peu plus longtemps, mais elle changé d'avis"~ "No spot",
            ECSIdealNotReason_5_TEXT == "Elle rentre en septembre 2023 parce qu'elle ne marche pas encore"~ "No spot",
            ECSIdealNotReason_5_TEXT == "elle s'est renseignée à la mairie et ils ont dit qu'elle pas droit vu qu'elle ne travaille pas"~ "I thought I was not eligible",
            ECSIdealNotReason_5_TEXT == "Elle s'est trompée"~  "Aministrative burden too heavy/applied to late",
            ECSIdealNotReason_5_TEXT == "Elle vient de faire la demande n'a pas encore la réponse"~ "Aministrative burden too heavy/applied to late",
            ECSIdealNotReason_5_TEXT == "en attente que place se libère"~ "No spot",
            ECSIdealNotReason_5_TEXT == "ESt de confession juive et n'a pas trouvé de crèche adaopté qui puisse recevoir son enfant"~ "No spot",
            ECSIdealNotReason_5_TEXT == "est en liste d'attente"~ "No spot",
            ECSIdealNotReason_5_TEXT == "Grand-mère maternelle n'habite pas en France"~ "Other",
            ECSIdealNotReason_5_TEXT == "Hésitait"~ "No spot",
            ECSIdealNotReason_5_TEXT == "idée qu'elle considère"~ "Other",
            ECSIdealNotReason_5_TEXT == "Il était trop petit pour être accepté en Halte Garderie"~ "No spot",
            ECSIdealNotReason_5_TEXT == "Il n'y en pas près du lieu de résidence de la maman "~ "No spot",
            ECSIdealNotReason_5_TEXT == "Ils ont dit à la mairie qu'elle n'est pas éligible vu qu'elle ne travaille pas"~ "I thought I was not eligible",
            ECSIdealNotReason_5_TEXT == "Impossible de trouver une place surtout au cours de l'annéé, n'a pas fait la demande"~ "I thought I was not eligible",
            ECSIdealNotReason_5_TEXT == "inscriptions pour septembre était déjà terminée"~ "Aministrative burden too heavy/applied to late",
           ECSIdealNotReason_5_TEXT == "J'ai eu la place maiq que pour un de mes enfants, difficile d'avoir deux modes de garde différents pour mes deux enfants (Camille et un autre enfant de 2.5 ans )"~ "No spot",
           ECSIdealNotReason_5_TEXT == "J'ai eu une place mais trop loin"~ "No spot",
            ECSIdealNotReason_5_TEXT == "j'attends une réponse du mode de garde"~ "No spot",
            ECSIdealNotReason_5_TEXT == "j'avais d'autres plans (maman qui peut garder)" ~"got something else and is satisfied",
            ECSIdealNotReason_5_TEXT == "Je  pensais que la crèche serait trop chère" ~ "Too expensive", 
            ECSIdealNotReason_5_TEXT == "Je l'ai, mais pas à temps plein" ~ "No spot",
            ECSIdealNotReason_5_TEXT == "je n'ai pas encore fait les démarches" ~ "Aministrative burden too heavy/applied to late",
            ECSIdealNotReason_5_TEXT == "je n'ai pas fait les inscriptions" ~ "Aministrative burden too heavy/applied to late",
            ECSIdealNotReason_5_TEXT == "je n'ai pas terminé mes recherches et compte sur Papa" ~ "Aministrative burden too heavy/applied to late",
            ECSIdealNotReason_5_TEXT == "je ne me suis pas renseignée" ~ "Not enough information",
            ECSIdealNotReason_5_TEXT == "je ne n'avais pas le temps de m'informer"  ~ "Not enough information",
            ECSIdealNotReason_5_TEXT == "Je préférai la garder avec moi" ~ "Other",
           ECSIdealNotReason_5_TEXT == "Je préférais le garder auprès de moi au début" ~ "No spot",
           ECSIdealNotReason_5_TEXT == "je suis en attente pour pouvoir candidater, je suis à la PMI" ~ "Aministrative burden too heavy/applied to late",
           ECSIdealNotReason_5_TEXT == "Je viens de faire les démarches" ~ "Aministrative burden too heavy/applied to late",
           ECSIdealNotReason_5_TEXT == "Je voulais seulement 1 jour mais on lui donnait obligatoirement 2 jours" ~ "No spot",
           ECSIdealNotReason_5_TEXT == "L'assistante maternelle n'était dispo que pour qq mois" ~ "No spot",
           ECSIdealNotReason_5_TEXT == "la crèche ne leur convenait pas finalement" ~ "Other",
           ECSIdealNotReason_5_TEXT == "La maman a eu la place pour Avy, en crèche, mais n'a pas pu en bénéficier vu qu'elle est rentrée au Liban"  ~ "Moved out",
           ECSIdealNotReason_5_TEXT == " La maman a fait la demande avec l'assistant social, mais n'a pas eu de réponse à ce jour, et n'a pas d'idée sur comment ça se passe" ~ "Aministrative burden too heavy/applied to late",
           ECSIdealNotReason_5_TEXT == "La plupart des ASSmat qu'ils ont trouvé ne sont pas agrées" ~ "No spot",
           ECSIdealNotReason_5_TEXT == "Le père" ~ "Other",
           ECSIdealNotReason_5_TEXT == "Liste d'attente" ~ "No spot",
           ECSIdealNotReason_5_TEXT == "Maman en Algérie en attendant regroupement familial" ~ "Moved out",
           ECSIdealNotReason_5_TEXT == "Manque de puéricultrice. 2 refus" ~ "No spot",
           ECSIdealNotReason_5_TEXT == "Mauvais contact avec l'assistante maternelle." ~ "Other",
           ECSIdealNotReason_5_TEXT == "N'a pas 5 ans entre les deux enfants d'une même fratrie - A postulé dans même crèche municipale que son aîné" ~ "No spot",
           ECSIdealNotReason_5_TEXT == "N'a pas aimé la crèche dans laquelle a eu une place donc réessaiera bientôt" ~ "Other",
           ECSIdealNotReason_5_TEXT == "N'a pas candidaté." ~ "Aministrative burden too heavy/applied to late",
           ECSIdealNotReason_5_TEXT == "N'a pas encore fait les démarches. N'avait pas le temps de faire les réunions pour les inscriptions à la crèche municipale." ~ "Aministrative burden too heavy/applied to late",
           ECSIdealNotReason_5_TEXT == "N'avait pas connaissance de la crèche municipale"  ~ "Not enough information",
           ECSIdealNotReason_5_TEXT == "N'avait pas prévu de reprendre le travail, a du trouver un mode de garde (voisine) en dernière minute" ~ "No spot",
           ECSIdealNotReason_5_TEXT == "Ne s'est pas renseignée"  ~ "Not enough information",
           ECSIdealNotReason_5_TEXT == "ne sait pas" ~ "Other",
           ECSIdealNotReason_5_TEXT == "ne voulait pas séparer ses bébés" ~ "Other",
           ECSIdealNotReason_5_TEXT == "On lui a dit que c'était trop tard de faire les inscriptions"~ "Aministrative burden too heavy/applied to late", 
           ECSIdealNotReason_5_TEXT == "Ont eu la place en retard, ils ont donc refusé et resté avec l'Ass mat"~ "got something else and is satisfied",
           ECSIdealNotReason_5_TEXT == "Ont eu une place pour septembre donc ont eu besoin d'un mode de garde entre deux, puis finalement après l'adaptation à préférer rester dans la crèche hospitalière" ~ "got something else and is satisfied",
           ECSIdealNotReason_5_TEXT =="Pas beaucoup d'assmat agrées sur Pantin" ~ "No spot",
           ECSIdealNotReason_5_TEXT =="PAS DE NOUVELLES" ~ "No spot",
           ECSIdealNotReason_5_TEXT =="Pas de place" ~ "No spot",
           ECSIdealNotReason_5_TEXT =="Pas de réponse" ~ "No spot",
           ECSIdealNotReason_5_TEXT =="Pas de réponse encore" ~ "No spot",
           ECSIdealNotReason_5_TEXT == "Pas le temps pour se renseigner et difficulté à faire confiance"~ "Aministrative burden too heavy/applied to late", 
           ECSIdealNotReason_5_TEXT == "pas sûre de reprendre sa formation donc préfère rester avec bébé" ~ "Other",
           ECSIdealNotReason_5_TEXT == "pas trouvé proche du domicile" ~ "No spot",
           ECSIdealNotReason_5_TEXT == "personne voulait pour 3j/sem"  ~ "No spot",
           ECSIdealNotReason_5_TEXT == "Je  pensais que la crèche serait trop chère" ~ "Too expensive", 
           ECSIdealNotReason_5_TEXT == "Pour la crèche privée, elle a eu la place en retard, elle était déjà en contrat avec l'assmat" ~ "got something else and is satisfied",
           ECSIdealNotReason_5_TEXT == "Pour la nouvelle ville la maman a demandé sur place et ils ont dit qu'il n'y a pas de places" ~ "Moved out",
           ECSIdealNotReason_5_TEXT == "Problème d'inscription" ~"Aministrative burden too heavy/applied to late", 
           ECSIdealNotReason_5_TEXT == "Problème de confiance : tant qu'il ne parle pas, n'a pas envie de le laisser garder par quelqu'un d'autre" ~"Other", 
           ECSIdealNotReason_5_TEXT == "Problèmes de communication, n'arrive pas à joindre les crèches" ~"Aministrative burden too heavy/applied to late", 
           ECSIdealNotReason_5_TEXT == "Rdv fixé à la mairie" ~"Other",
           ECSIdealNotReason_5_TEXT == "rdv qui a été annulé" ~"Aministrative burden too heavy/applied to late", 
           ECSIdealNotReason_5_TEXT == "situation irrégulière" ~"Other",
           ECSIdealNotReason_5_TEXT == "Son partenaire" ~"Other",
           ECSIdealNotReason_5_TEXT == "temporalité/fréquence des commissions durant période ou a besoin de un MdG ne correspondait pas à son besoin" ~"No spot",
           ECSIdealNotReason_5_TEXT == "Trop tot" ~"Other",
           str_detect(ECSIdealNotReason,"Le mode de garde que je préférais coûtait trop cher.")~ "Too expensive", 
           ECSIdealNotReason == "Je n’ai pas eu de place dans le mode de garde que je préférais."~ "No spot",
           str_detect(ECSIdealNotReason , "Je me suis découragée")~ "Gave up",
           str_detect(ECSIdealNotReason,"Je pensais que je n'étais pas éligible.")~ "I thought I was not eligible",
           str_detect(ECSIdealNotReason,"horaires de travail")~ "Uncompatible working hours", 
           str_detect(ECSIdealNotReason,"Mon bébé n’allait pas bien / les médecins m’ont déconseillés")~ "Health issues",
          TRUE ~ NA), # Reason why the mother did not get the ECS she wanted, syntetic version but allows only one reason per row
          ECSIdealNotReasonTooExpensive = ( # TRUE if the mother did not get the ECS she wanted because she tought it was too expensive
    str_detect(ECSIdealNotReason, "trop cher") | str_detect(ECSIdealNotReason_5_TEXT,"Le mode de garde que je préférais coûtait trop cher.") |    ECSIdealNotReason_5_TEXT == "Je  pensais que la crèche serait trop chère"), 
    ECSIdealNotReasonMovedOut = (str_detect(ECSIdealNotReason_5_TEXT, "ménag") | ECSIdealNotReason_5_TEXT == "A eu une place mais trop tard, sa fille était déjà inscrite en micro-crèche et par ailleurs ils avaient déménagé donc ce n'était plus intéressant pour elle."  | ECSIdealNotReason_5_TEXT == "La maman a eu la place pour Avy, en crèche, mais n'a pas pu en bénéficier vu qu'elle est rentrée au Liban" |  ECSIdealNotReason_5_TEXT == "Maman en Algérie en attendant regroupement familial") , # TRUE if the mother did not get the ECS she wanted because she moved out
    ECSIdealNotReasonHealthIssues = (ECSIdealNotReason_5_TEXT == "A fait les démarches auprès d'une assistante sociale mais n'a pas pu déposer la candidature à la crèche à cause de problème de santé" | str_detect(ECSIdealNotReason,"Mon bébé n’allait pas bien / les médecins m’ont déconseillés")),# TRUE if the mother did not get the ECS she wanted because of health issues
    ECSIdealNotReasonNoSpot = ( ECSIdealNotReason_5_TEXT ==  "19/20 des assistantes maternelles qu'ils ont contacté ne correspondaient pas du tout à leurs attentes. Il se demande comment on peut confier son enfant à des personnes aussi peu qualifiées." | ECSIdealNotReason_5_TEXT ==  "A finalement eu une place dans une crèche municipale trop loin du domicile." | ECSIdealNotReason_5_TEXT == "a pris la place qui lui a été donnée" | ECSIdealNotReason_5_TEXT == "a profité de saisir l'opportunité de la place proposée par la  crèche privée où travaille par peur de ne rien trouver par aprè" | ECSIdealNotReason_5_TEXT == "a vu que les inscriptions étaient passées quand elle s'est renseignée" | ECSIdealNotReason_5_TEXT == "Attend les réponses" | ECSIdealNotReason_5_TEXT == "attente" | ECSIdealNotReason_5_TEXT == "Aucun des modes de garde ne lui convenait pas a été obligé pour reprendre le travail" | ECSIdealNotReason_5_TEXT == "bébé sur liste d'attente" | ECSIdealNotReason_5_TEXT == "C'est ce que la mairie leur a donné." | ECSIdealNotReason_5_TEXT == "ça ne m'a pas plu" | ECSIdealNotReason_5_TEXT == "ça se passe tellement bien avec l'ass mat que ne veut pas changer" | str_detect(ECSIdealNotReason_5_TEXT, "sa structure privée (dans laquelle elle travaillait) qui ne lui convenait pas comme prise en charge pour son enfant, en gros il pouvait le résilier quand il voulait") | ECSIdealNotReason_5_TEXT == "Crèche seulement a la marche acquise"| ECSIdealNotReason_5_TEXT == "date limite de naissance des enfants acceptés pour la commission de septembre"|  ECSIdealNotReason_5_TEXT == "délai trop court"| ECSIdealNotReason_5_TEXT == "date limite de naissance des enfants acceptés pour la commission de septembre"|  ECSIdealNotReason_5_TEXT == "Devait reprendre le travail" | ECSIdealNotReason_5_TEXT == "Elle rentre en septembre 2023 parce qu'elle ne marche pas encore"| ECSIdealNotReason_5_TEXT == "en attente que place se libère"| ECSIdealNotReason_5_TEXT == "ESt de confession juive et n'a pas trouvé de crèche adaopté qui puisse recevoir son enfant"|  ECSIdealNotReason_5_TEXT == "est en liste d'attente"|  ECSIdealNotReason_5_TEXT == "Hésitait"|  ECSIdealNotReason_5_TEXT == "Il était trop petit pour être accepté en Halte Garderie"| ECSIdealNotReason_5_TEXT == "Il n'y en pas près du lieu de résidence de la maman " | ECSIdealNotReason_5_TEXT == "J'ai eu la place maiq que pour un de mes enfants, difficile d'avoir deux modes de garde différents pour mes deux enfants (Camille et un autre enfant de 2.5 ans )"| ECSIdealNotReason_5_TEXT == "J'ai eu une place mais trop loin"| ECSIdealNotReason_5_TEXT == "j'attends une réponse du mode de garde"| ECSIdealNotReason_5_TEXT == "Je l'ai, mais pas à temps plein"|  ECSIdealNotReason_5_TEXT == "Je préférais le garder auprès de moi au début" | ECSIdealNotReason_5_TEXT == "Je voulais seulement 1 jour mais on lui donnait obligatoirement 2 jours" | ECSIdealNotReason_5_TEXT == "L'assistante maternelle n'était dispo que pour qq mois"|  ECSIdealNotReason_5_TEXT == "La plupart des ASSmat qu'ils ont trouvé ne sont pas agrées"| ECSIdealNotReason_5_TEXT == "Liste d'attente"|  ECSIdealNotReason_5_TEXT == "Manque de puéricultrice. 2 refus" | ECSIdealNotReason_5_TEXT == "N'a pas 5 ans entre les deux enfants d'une même fratrie - A postulé dans même crèche municipale que son aîné"|  ECSIdealNotReason_5_TEXT == "N'avait pas prévu de reprendre le travail, a du trouver un mode de garde (voisine) en dernière minute" | ECSIdealNotReason_5_TEXT =="Pas beaucoup d'assmat agrées sur Pantin" | ECSIdealNotReason_5_TEXT =="PAS DE NOUVELLES"| ECSIdealNotReason_5_TEXT =="Pas de place"|  ECSIdealNotReason_5_TEXT =="Pas de réponse" |  ECSIdealNotReason_5_TEXT =="Pas de réponse encore" |  ECSIdealNotReason_5_TEXT == "pas trouvé proche du domicile"| ECSIdealNotReason_5_TEXT == "personne voulait pour 3j/sem" | ECSIdealNotReason_5_TEXT == "temporalité/fréquence des commissions durant période ou a besoin de un MdG ne correspondait pas à son besoin" ), # TRUE if the mother did not get the ECS she wanted because there were no spot for it
    ECSIdealNotReasonWorkingHours = str_detect(ECSIdealNotReason,"horaires de travail"),# TRUE if the mother did not get the ECS she wanted because it was incompatible with her working hours 
    ECSIdealNotReasonThoughtNotEligible = (str_detect(ECSIdealNotReason,"Je pensais que je n'étais pas éligible.") | ECSIdealNotReason_5_TEXT == "elle s'est renseignée à la mairie et ils ont dit qu'elle pas droit vu qu'elle ne travaille pas"|  ECSIdealNotReason_5_TEXT == "Ils ont dit à la mairie qu'elle n'est pas éligible vu qu'elle ne travaille pas"| ECSIdealNotReason_5_TEXT == "Impossible de trouver une place surtout au cours de l'annéé, n'a pas fait la demande" | 
           str_detect(ECSIdealNotReason_5_TEXT,"Je pensais que je n'étais pas éligible.")),# TRUE if the mother did not get the ECS she wanted because she tought she was not eligible for it
    ECSIdealNotReasonGaveUp = str_detect(ECSIdealNotReason,"Je me suis découragée"), # TRUE if the mother did not get the ECS she wanted because she gave up on it
    ECSIdealNotReasonTooLateAdministrativeBurden = (# TRUE if the mother did not get the ECS she wanted because of the administrative burden and/or/thus she applied to late because of it
            ECSIdealNotReason_5_TEXT == "Administrativement compliqué" |
              ECSIdealNotReason_5_TEXT =="délai trop court" |
            ECSIdealNotReason_5_TEXT == "dossier non actualisé pour septembre doit passer dans commission de novembre"|
            ECSIdealNotReason_5_TEXT == "Dossier non traité par la mairie" | 
            ECSIdealNotReason_5_TEXT == "Elle n'a pas encore fait les démarches." |
            ECSIdealNotReason_5_TEXT == "Elle s'est trompée"|
            ECSIdealNotReason_5_TEXT == "Elle vient de faire la demande n'a pas encore la réponse" |
            ECSIdealNotReason_5_TEXT == "inscriptions pour septembre était déjà terminée" |
            ECSIdealNotReason_5_TEXT == "je n'ai pas encore fait les démarches" |
            ECSIdealNotReason_5_TEXT == "je n'ai pas fait les inscriptions"|
            ECSIdealNotReason_5_TEXT == "je n'ai pas terminé mes recherches et compte sur Papa" |
           ECSIdealNotReason_5_TEXT == "je suis en attente pour pouvoir candidater, je suis à la PMI" |
           ECSIdealNotReason_5_TEXT == "Je viens de faire les démarches" |
           ECSIdealNotReason_5_TEXT == " La maman a fait la demande avec l'assistant social, mais n'a pas eu de réponse à ce jour, et n'a pas d'idée sur comment ça se passe"|
           ECSIdealNotReason_5_TEXT == "N'a pas candidaté." |
           ECSIdealNotReason_5_TEXT == "N'a pas encore fait les démarches. N'avait pas le temps de faire les réunions pour les inscriptions à la crèche municipale." |
           ECSIdealNotReason_5_TEXT == "On lui a dit que c'était trop tard de faire les inscriptions"|
           ECSIdealNotReason_5_TEXT == "Pas le temps pour se renseigner et difficulté à faire confiance"|
           ECSIdealNotReason_5_TEXT == "Problème d'inscription" |
           ECSIdealNotReason_5_TEXT == "Problèmes de communication, n'arrive pas à joindre les crèches" |            ECSIdealNotReason_5_TEXT == "rdv qui a été annulé" ), 
    ECSIdealNotReasonSatisfiedEnough = (
            ECSIdealNotReason_5_TEXT == "ça se passe tellement bien avec l'ass mat que ne veut pas changer" |
            ECSIdealNotReason_5_TEXT == "car a obtenu une place à la crèche beaucoup plus tôt le 27/01/2023"|
            ECSIdealNotReason_5_TEXT == "Commission trop tard, s'est tournée vers autre solution"|  ECSIdealNotReason_5_TEXT == "Elle a eu la place, mais qu'en septembre, mais ils étaient déjà chez une assmat, ils voulaient pas la perturber" |  ECSIdealNotReason_5_TEXT == "Pour la crèche privée, elle a eu la place en retard, elle était déjà en contrat avec l'assmat"  |  ECSIdealNotReason_5_TEXT == "Ont eu la place en retard, ils ont donc refusé et resté avec l'Ass mat"|  ECSIdealNotReason_5_TEXT == "Ont eu une place pour septembre donc ont eu besoin d'un mode de garde entre deux, puis finalement après l'adaptation à préférer rester dans la crèche hospitalière" | ECSIdealNotReason_5_TEXT == "j'avais d'autres plans (maman qui peut garder)" ),
    ECSIdealNotReasonNotEnoughInformation = (      # TRUE if the mother did not get the ECS she wanted because she didn't have enough information
      ECSIdealNotReason_5_TEXT == "je ne me suis pas renseignée" |  ECSIdealNotReason_5_TEXT == "je ne n'avais pas le temps de m'informer" | ECSIdealNotReason_5_TEXT == "N'avait pas connaissance de la crèche municipale"  |  ECSIdealNotReason_5_TEXT == "N'avait pas prévu de reprendre le travail, a du trouver un mode de garde (voisine) en dernière minute"| ECSIdealNotReason_5_TEXT == "Ne s'est pas renseignée" ), 
     ECSIdealNotReasonNoSpot = ifelse(str_detect(as.character(ECSIdealNotReason), "place") == TRUE, TRUE, as.logical(ECSIdealNotReasonNoSpot)),# for some reason this string create a bug if put inside the original chunk, we add it here 
    ECSIdealAmountNeedMoreHoursECSYes = ECSIdealAmount == "Oui, plus", # TRUE if the family has access to ECS but would need more hours of ECS
    ECSIdealAmountNeedLessHours = ECSIdealAmount == "Oui, moins", # TRUE if the family would need less hours of ECS
    ECSIdealAmountNeedYes = ECSIdealAmount == "Non, j'ai ce qu'il faut", # TRUE if the family has the amount of hours they need
    ECSIdealAmountNeedMoreHours = (ECSIdealAmount == "Oui, plus" | ECSNoECSApp == "Oui" | (ECSPlanToEndline == "oui" & ECSPlanToStartDate < date_ref)),  # TRUE if the family would need more hours of ECS in general 
    ECSBrosisUseYes = ECSBrosis == "Oui", # TRUE if the family accesses a slot for older siblings
    ECSBrosisTiming = ifelse(ECSBrosisTiming == "2026-09-01", NA, ECSBrosisTiming), # Timing of the ECS for the older siblings (2026 was the code for don't know)
    AffordCostDKEndline = (AffordCostEndline == "Je ne sais pas" | AffordCostEndline == "Je ne souhaite pas répondre"), # Don't know the cost of a full time place in daycare at endline
    AffordCostEndline = AffordCost_1_TEXT, 
    AffordCostCertainty = AffordCostCertainty_1, 
    AffordSubsidiesEndline = ifelse(AffordSubsidiesEndline == "Oui", "Yes", "No_NSP"), # Don't know that ECS is subsidized
    AffordSubsidiesLearntAtEndline = (AffordSubsidiesBaseline == "No_NSP" & AffordSubsidiesEndline == "Yes"), # Learnt that ECS is subsidized between baseline and endline
    AccessImpossibleEndline = ifelse(AccessEasyEndline == "impossible", 1, 0),  # Create a dummy for whether the mother saw have a place in crèche as impossible
    AccessHard = ifelse(AccessEasyEndline %in% c("quasiment impossible", "très difficile", "assez difficile"), 1, 0), # Create a dummy for whether the mother saw have a place in crèche as hard
    AccessHardtoImpossible = ifelse(AccessEasyEndline %in% c("quasiment impossible", "très difficile", "assez difficile", "impossible"), 1, 0),# Create a dummy for whether the mother saw have a place in crèche as impossible
    AccessEasy1or0 = ifelse(AccessEasyEndline %in% c("assez facile", "très facile"), 1, 0), # Create a dummy for whether the mother saw have a place in crèche as easy
    AccessEasyDK = ifelse(AccessEasyEndline == "je ne sais pas", 1, 0), # Create a dummy for whether the mother doesn't know if have a place in crèche is hard or not
    ControlECS = ControlECS_1, # Degree of control towards ECS access in general
    ControlCreche = ControlCreche_1, # Degree of control towards creche access 
    PsyStress = PsyStress_1, # Degree of stress caused by ECS application
    PsyComplicated = PsyComplicated_1, # Perceived burden of ECS application
    PsySatisfaction = PsySatisfaction_1, # Statisfaction towards current childcare solution
    AccessNotHours = ifelse(AccessHoursEndline == "Non", 1, 0),  # Create a dummy for whether the mother doesn't know if have a place in crèche is hard or not
    AccessNotInformalCareEndline = ifelse(AccessInformalCareEndline == "Non", 1, 0), 
    AccessInformalCareAMAPEndline = ifelse(AccessInformalCareEndline == "Oui, autant que nécessaire", 1, 0), 
    ECSNeedEndline=ifelse(as.character(ECSNeedEndline)=="Ne souhaite pas répondre","Ne sait pas encore",as.character(ECSNeedEndline)), # intensity of childcare needed
    ECSNeedEndline=factor(ECSNeedEndline, levels=c("A temps plein","De temps en temps","Jamais", "Ne sait pas encore")), # full-time, part-time, never, don't know yet
    ECSNeedFullTime = ECSNeedEndline == "A temps plein", # TRUE if the family needs full-time ECS
    ECSNeedPartTime = ECSNeedEndline == "De temps en temps", # TRUE if the family needs part-time ECS
    ECSNeedNever = ECSNeedEndline == "Jamais", # TRUE if the family never needs ECS
    ECSNeedDK = ECSNeedEndline == "Ne sait pas encore", # TRUE if the family doesn't know yet if they need ECS
    NormsFewECS = (NormsEndline == "Aucune" | NormsEndline == "Une minorité"), # TRUE if the few ppl around the family use ECS
    NormsOpposedDKEndline = (NormsEndline == "Ne sait pas"), # Don't know the opinion of the few ppl around the family on ECS
    NormsOpposedNEndline = NormsOpposed_1_TEXT, # TRUE if the few ppl around the family are opposed to ECS
    NormsOpposedAboveMedian = NormsOpposedNEndline > median(NormsOpposedNEndline, na.rm = TRUE), # TRUE if the few ppl around the family are opposed to ECS more than the median
    AffordNMCostWBNegativeEndline = AffordNMCostWBEndline == "Négatif", # TRUE if staying at home with child would have a negative impact on mother's well being
    AffordNMCostWBPositiveEndline = AffordNMCostWBEndline == "Positif", # TRUE if staying at home with child would have a positive impact on mother's well being
    AffordNMCostWBNeutralEndline = AffordNMCostWBEndline == "Pas d'impact", # TRUE if staying at home with child would have a neutral impact on mother's well being
    AffordNMCostWBDKEndline = AffordNMCostWBEndline == "Je ne sais pas", # TRUE if the mother doesn't know if staying at home with child would have an impact on her well being
    AffordNMCostCareerNegativeEndline = AffordNMCostCareerEndline == "Négatif", # TRUE if staying at home with child would have a negative impact on mother's career
    AffordNMCostCareerPositiveEndline = AffordNMCostCareerEndline == "Positif", # TRUE if staying at home with child would have a positive impact on mother's career
    AffordNMCostCareerNeutralEndline = AffordNMCostCareerEndline == "Pas d'impact", # TRUE if staying at home with child would have a neutral impact on mother's career
    AffordNMCostCareerDKEndline = AffordNMCostCareerEndline == "Je ne sais pas", # TRUE if the mother doesn't know if staying at home with child would have an impact on her career
    AffordOppCostNegativeEndline = AffordOppCostEndline == "Négatif", # TRUE if the mother thinks that the opportunity cost of staying at home with child would be negative
    AffordOppCostPositiveEndline = AffordOppCostEndline == "Positif", # TRUE if the mother thinks that the opportunity cost of staying at home with child would be positive
    AffordOppCostNeutralEndline = AffordOppCostEndline == "Pas d'impact", # TRUE if the mother thinks that the opportunity cost of staying at home with child would be neutral
    AffordOppCostDKEndline = AffordOppCostEndline == "Je ne sais pas", # TRUE if the mother doesn't know if the opportunity cost of staying at home with child would be positive
    LikertReturnHK1or0Endline = ifelse(LikertReturnHKEndline %in% c("Assez d’accord", "Très d’accord "), 1, 0), # 1 if the mother thinks that ECS is good for the child
    LikertAccessInfoEndline1or0Endline = ifelse(LikertAccessInfoEndline  %in% c("Assez d’accord", "Très d’accord "), 1, 0), # 1 if the mother thinks that it is feasible for to find information about childcare
    NormsWork = ifelse(NormsWork == "Je ne souhaite pas répondre", "Je ne sais pas", as.character(NormsWork)),
    NormsHouse = ifelse(NormsHouse == "Je ne souhaite pas répondre", "Je ne sais pas", as.character(NormsHouse)),
    NormsWork = factor(NormsWork, # Is it feasible to access information about childcare (Endline)
                          levels=c("En désaccord","Assez en désaccord","Je ne sais pas","Assez d’accord","D’accord"), ordered = TRUE), 
    NormsHouse = factor(NormsHouse, # Is it feasible to access information about childcare (Endline)
                          levels=c("En désaccord","Assez en désaccord","Je ne sais pas","Assez d’accord","D’accord"), ordered = TRUE),
    NormsWorkAgree = ifelse(NormsWork  %in% c("Assez d’accord", "Très d’accord "),TRUE, FALSE), # TRUE if the mother thinks that if a mother works to earn money, the children suffer
    NormsHouseAgree = ifelse(NormsHouse  %in% c("Assez d’accord", "Très d’accord "),TRUE, FALSE), # TRUE if the mother thinks that what mothers want is to stay at home with their children
    SecondGenerationMother = case_when((SecondGenCouple == "Non, un de mes deux parents n'est pas né en France" |       SecondGenSingle == "Non, un de mes deux parents n'est pas né en France") ~ 1, 
                                (SecondGenCouple == "Non, mes deux parents ne sont pas nés en France" | SecondGenSingle == "Non, mes deux parents ne sont pas nés en France") ~ 2,
                                (SecondGenCouple == "Oui" | SecondGenSingle == "Oui") ~ 0,
                                .default = 0), # 1 if the one of the parents of the mother was not born in France, 2 if  both parents are second generation  
    SecondGenerationFather = case_when(
      SecondGenCouple == "Non, un des parents de mon/ma partenaire n'est pas né en France" ~ 1,
      SecondGenCouple == "Non, les deux parents de ma partenaire ne sont pas nés en France" ~ 2,
      SecondGenCouple == "Oui" ~ 0,
      .default = 0), # 1 if the one of the parents of the mother was not born in France, 2 if  both parents are second generation
     BirthPlaceParentsMum = case_when(
       BirthPlaceParentsMum_11_TEXT == "La maman a du partir, je n'ai pas eu l'information" ~ NA,
       BirthPlaceParentsMum_11_TEXT == "Gambie" ~ "Afrique subsaharienne",
       BirthPlaceParentsMum_11_TEXT == "Haïtï" ~ "Afrique subsaharienne",
       BirthPlaceParentsMum_11_TEXT == "Comores" ~ "Afrique subsaharienne",
       BirthPlaceParentsMum_11_TEXT == "haiti" ~ "Afrique subsaharienne",
       BirthPlaceParentsMum_11_TEXT == "Haïti" ~ "Afrique subsaharienne",
       BirthPlaceParentsMum_11_TEXT == "Île-Maurice" ~ "Afrique subsaharienne",
       BirthPlaceParentsMum_11_TEXT == "Portugal" ~ "Europe/Amérique du Nord, Australie",
       BirthPlaceParentsMum_11_TEXT == "Suisse" ~ "Afrique subsaharienne,MENA (Maghreb +Arabie saoudite, etc.),Europe/Amérique du Nord, Australie",
       BirthPlaceParentsMum_11_TEXT == "Russie Sénégale pour la mère Sénégal et Togo pour les parents du partenaire" ~ "Afrique subsaharienne,Europe/Amérique du Nord, Australie",
       str_detect(BirthPlaceParentsMum_11_TEXT, "précisée") ~ "Europe/Amérique du Nord, Australie",
       BirthPlaceParentsMum_11_TEXT == "Maroc" ~ "MENA (Maghreb +Arabie saoudite, etc.)",
       .default = as.character(BirthPlaceParentsMum)), # Birth place of the mother's parents
      BirthPlaceParentsMumAfriqueSub = str_detect(BirthPlaceParentsMum, "subsaharienne"), # TRUE if at least one of the mother's parents are from sub-Saharan Africa
      BirthPlaceParentsMumMENA = str_detect(BirthPlaceParentsMum, "MENA"), # TRUE if at least one of the mother's parents are from the MENA region
      BirthPlaceParentsMumEurope = str_detect(BirthPlaceParentsMum, "Europe"), # TRUE if at least one of the mother's parents are from Europe
      BirthPlaceParentsMumAsia = str_detect(BirthPlaceParentsMum, "Asie"), # TRUE if at least one of the mother's parents are from Asia
      BirthPlaceParentsMumLatinAmerica = str_detect(BirthPlaceParentsMum, "Latine"), # TRUE if at least one of the mother's parents are from Latin America
      LevelComprehension =  factor(LevelComprehension, 
                                      levels = c("pas de doutes sur la compréhension des questions", 
                                                 "quelques doutes sur la compréhension des questions", 
                                                 "des sérieux doutes sur la compréhension des questions"), 
                                      labels = c("No doubts", "Some doubts", "Heavy doubts"), 
                                      ordered = TRUE), # Level of comprehension of the questions
     LevelExpression =  factor(LevelExpression, 
                                      levels = c("sans problème particulier", 
                                                 "quelques difficultés", 
                                                 "expression très difficile"), 
                                      labels = c("No problem", "Some problems", "Difficult"), 
                                      ordered = TRUE), # Level of expression
     SubjectiveInfoLevel = recode(SubjectiveInfoLevel, # Surveyor codded ex post the level of information about childcare of the participants
                                            "aucun ou très très bas" = "None",
                                            "basique : connait les bases (ex. les crèches, parle de quelque chose comme les nounous à domicile), mais pas le système (ex. pense que si pas de travail c'est impossible, n'a aucune idée des coûts et de comment ça fonctionne)" = "Basic",
                                            "plutôt bonne : semble connaître les subtilités (ex. connait aussi les assistantes maternelles, etc.), mais pas tout" = "Good",
                                            "excellente: connais la plupart des subtilités (ex. sait que les subventions dépendent du revenu, que les parents qui ont pas de travail peuvent être prioritaires, mentionne les commissions, etc.)" = "Excellent"),
   PartnerInvolvement = factor(PartnerInvolvement, 
                                      levels = c("N'était pas là", 
                                                 "A juste traduit les questions pour la mère", 
                                                 "A répondu au questionnaire, mais l'avis de la mère a été bien pris en compte", 
                                                 "A répondu au questionnaire, et l'avis de la mère n'a pas ou très peu été pris en compte"                                   ), 
                                      labels = c("None", "Just translated", "Took the mother into account", "Not took into account"), 
                                      ordered = TRUE), # Level of bias from the partner
   ECSYes = case_when(
     ECSNoECSAppAnswer == "Oui,  on été acceptés dans au moins 1 mais on a refusé (à cause d'un problème, etc.)" ~ 1,
ECSNoECSAppAnswer == "Oui, on été acceptés, mais on a déménagé" ~  1, 
TRUE ~ as.numeric(ECSUseYes)
) # TRUE if the family has access to ECS
    )
          

## Construct the WELL BEING score
# Define the variable names
variable_names <- c("PsyWellBeingStimu", "PsyWellBeingFresh", "PsyWellBeingVigou", "PsyWellBeingQuite", "PsyWellBeingHappy")

# Define the mapping of original values to scores
value_mapping <- c("Jamais" = 0, "Juste de temps en temps" = 1, "Moins de la moitié du temps" = 2,
                   "Plus de la moitié du temps" = 3, "La plupart du temps" = 4, "Tout le temps" = 5)

# Recode each variable and store them in a list
recode_variables <- list()
for (variable in variable_names) {
  recoded_variable <- RCT_tot[[variable]]
  recoded_variable <- as.numeric(factor(recoded_variable, levels = names(value_mapping)))
  recoded_variable <- value_mapping[recoded_variable]
  recode_variables[[variable]] <- recoded_variable
}

# Convert the list to a data frame
recode_df <- as.data.frame(recode_variables)

# Compute the sum of recoded variables for each participant
recode_df$WellBeingTotalScore <- rowSums(recode_df)

# Normalize the scores to be out of 100
recode_df$WellBeingTotalScore <- recode_df$WellBeingTotalScore  * 4

# Add the TotalScore to RCT_tot
RCT_tot$WellBeingTotalScore <- recode_df$WellBeingTotalScore



## Construct the deprivation score
# Define the variable names

RCT_tot$DeprivationHolidaysNum <- as.integer(factor(RCT_tot$Depriv_1, levels = c("Pas du tout", "Un peu", "Beaucoup"))) -1
RCT_tot$DeprivationHousingNum <- as.integer(factor(RCT_tot$Depriv_2, levels = c("Pas du tout", "Un peu", "Beaucoup")))-1 
RCT_tot$DeprivationScore = RCT_tot$DeprivationHolidaysNum + RCT_tot$DeprivationHousingNum # Deprivation score
RCT_tot$DeprivationScore = RCT_tot$DeprivationScore / 4 * 100 # Normalize the score to be out of 100


## AGE OF THE BABY
# We want to calculate the age of the baby but the NAs make it difficult
# So first filter the NA and then calculate the age 
RCT_tot_age_baby = RCT_tot %>% 
  filter(!is.na(BabyBirthDate)) %>% 
  mutate( BabyAgeEndline = age_calc(as.Date(BabyBirthDate), as.Date(date_ref), units = "months")) # tricky to do it here b/c of the NAs

# Then merge the two datasets
RCT_tot <- merge(RCT_tot, RCT_tot_age_baby[, c("ResponseId", "BabyAgeEndline")], by = "ResponseId", all.x = TRUE)

## HEALTH SCORE Baby
# Create a score btw 0 and 100: 100 = good health; 0 = poor health
# Define the variable names
RCT_tot <- RCT_tot %>% 
  mutate(BabyPrematuredYes = ifelse(is.na(BabyPrematuredYes), FALSE, BabyPrematuredYes), # Deal with NAs
         BabyNDaysMaternityMoreThanMedian = ifelse(is.na(BabyNDaysMaternityMoreThanMedian), FALSE, BabyNDaysMaternityMoreThanMedian), # Deal with NAs
         BabyChronicDiseaseYes = ifelse(is.na(BabyChronicDiseaseYes), FALSE, BabyChronicDiseaseYes), # Deal with NAs
         BabyNDaysHospMoreThanMedian = ifelse(is.na(BabyNDaysHospMoreThanMedian), FALSE, BabyNDaysHospMoreThanMedian), # Deal with NAs
         BabySujectiveHealthNotGood = ifelse(is.na(BabySujectiveHealthNotGood), FALSE, BabySujectiveHealthNotGood), # Deal with NAs
    BabyHealthScore = BabyPrematuredYes + # Sum all the variables to get a score
                              BabyLowBirthWeight +
                              BabyChronicDiseaseYes +
                              BabyNDaysMaternityMoreThanMedian +
                              BabyNDaysHospMoreThanMedian +
                              BabySujectiveHealthNotGood,
         BabyHealthIndex = (1 - (BabyHealthScore / 6)) * 100, # Score btw 0 and 100: 100 = good health; 0 = poor health
         BabyHealthIndexLessThanMedian = BabyHealthIndex < median(BabyHealthIndex, na.rm = TRUE)
         )



## HEALTH SCORE Mother
# Create a score btw 0 and 100: 100 = good health; 0 = poor health

RCT_tot <- RCT_tot %>% 
  mutate(WellBeingTotalScoreLessThanMedian = WellBeingTotalScore < median(WellBeingTotalScore, na.rm=TRUE),
         MotherNDaysMaternityMoreThanMedian = ifelse(is.na(MotherNDaysMaternityMoreThanMedian), FALSE, MotherNDaysMaternityMoreThanMedian), # Deal with NAs
         MotherNDaysHospMoreThanMedian = ifelse(is.na(MotherNDaysHospMoreThanMedian), FALSE, MotherNDaysHospMoreThanMedian), # Deal with NAs
        MotherHealthScoreWithWB = # do the score
                        MotherNDaysMaternityMoreThanMedian + 
                        MotherNDaysHospMoreThanMedian +
                        WellBeingTotalScoreLessThanMedian,
        MotherHealthScore = MotherNDaysMaternityMoreThanMedian + 
                        MotherNDaysHospMoreThanMedian ,
        MotherHealthIndexWithWB = (1 - (MotherHealthScoreWithWB / 3)) * 100,
        MotherHealthIndex = (1 - (MotherHealthScore / 2)) * 100, # Score btw 0 and 100: 100 = good health; 0 = poor health
        MotherHealthIndexWithWBLessThanMedian = MotherHealthIndexWithWB < median(MotherHealthIndexWithWB, na.rm = TRUE),
        MotherHealthIndexLessThanMedian = MotherHealthIndex < median(MotherHealthIndex, na.rm = TRUE)
        )

## Norms score
# Create a score btw 0 and 100: 100 = norms favorable to ECS; 0 = norms opposed
RCT_tot <- RCT_tot %>% 
  mutate(TradNormsScore =  (NormsWorkAgree + NormsHouseAgree)/2*100 , # Score btw 0 and 100: 100 = norms opposed to ECS; 0 = norms favorable to ECS
         NormsOpposedScore = (NormsWorkAgree + NormsHouseAgree + NormsOpposedAboveMedian + NormsFewECS)/4*100) # Score btw 0 and 100: 0 = norms favorable to ECS; 100 = norms opposed

# Remove all the participants that have to be excluded: remove dead babies and undocumented families
RCT = RCT_tot %>% 
    filter((Start == "Oui, je réponds maintenant" | Start == "Non, mais je veux bien répondre au questionnaire plus tard")  & BabyOk != "Bébé décédé" ) %>% 
  filter((CAFNoWhy != "Je n'ai pas de papier") %>% replace_na(TRUE))# we calculate the age of the bb here b/c of NA in RCT_tot

#%>% mutate( AgeBabyEndline = age_calc(as.Date(BabyBirthDate), date_ref, units = "months") tricky to do it here b/c of the NAs


# Import info on the compliers to administrative support admin data

# Import the admin database
admin_unique <- readr::read_csv(
  here("Data", "admin_unique.csv"))

  admin_unique$Numéro <- as.character(admin_unique$Numéro)

# Identify columns from admin_unique not present in RCT
columns_to_import <- setdiff(names(admin_unique), names(RCT_tot))

# Import only the columns from admin_unique that are not already present in RCT
RCT_tot <- RCT_tot %>%
  left_join(select(admin_unique, all_of(columns_to_import)), by = c("PhoneMotherEndline" = "Numéro")) %>%
  mutate(Suivi_administratif = ifelse(Suivi_administratif == "No" | is.na(Suivi_administratif), "No", "Yes"),
         Suivi_administratif = as.factor(Suivi_administratif), 
         Suivi_administratif1_0 = ifelse(Suivi_administratif == "No", 0, 1)) 
# Remove ECS_df from the workspace
rm(ECS_df)

# Export missing c
#d = RCT_tot %>% select(ResponseId, PhoneMotherBaseline,ECSAppTimingBeforeBirth)

# export it
#write.csv(d, file = "../Endline/Exported_missing_cols.csv", row.names = TRUE)

```


```{r spatialDB, include = FALSE}

## This is an old chunk only on RCT. We do in on RCT_tot below
### In this chunk we augment RCT with spatial data about the ECS coverage rate at endline, spatial coordinates, and the number of participants per city at Endline
#
#
#
##### STEP 1           #### 
##### Data preparation #### 
#
#
###### Get our db ready by loading some batabase that contains interesting variables
#
## ECS coverage rate
##### Source http://data.caf.fr/dataset/f6411f07-10bf-4f13-b4fb-8d30ba9328b5/resource/44cdd055-fbfa-444b-ae33-f4d47d8e8638/download/TAUXCOU2019.csv
##coverage <- read_csv2("../Data/Population-ECEC_coverage/TAUXCOU2019(1).csv") %>% filter(row_number()!=1) %>% 
##  mutate(across(c(TAUXCOUV_COM:TAUXCOUV_NAT),~as.numeric(gsub(",", ".", gsub("\\.", "",.x)))))
#
## Updated with 2021 data
#coverage <- read_csv2("../Endline/Data/Spatial data/Taux-de-couverture-global-2021.csv") 
#
#### Source : https://www.insee.fr/fr/statistiques/6011070?sommaire=6011075
#pop <- read_csv2("../Data/Population-ECEC_coverage/donnees_communes.csv") %>% mutate(NUMCOM=paste(CODDEP,CODCOM,sep=""))
#
#### Source : https://www.data.gouv.fr/en/datasets/base-officielle-des-codes-postaux/#resources
#post <- read_csv2("../Data/Population-ECEC_coverage/laposte_hexasmal(1).csv") %>% rename(NUMCOM=Code_commune_INSEE)
#
### Import cities latitude and longitude https://www.data.gouv.fr/en/datasets/villes-de-france/
#latlong <- read.csv("../Endline/Data/Spatial data/cities.csv", sep = ",") %>% rename(NUMCOM = insee_code) %>% select(NUMCOM, zip_code, latitude, longitude)
#
##### Put the database together
## The first ones
#Demographics <- left_join(pop,post) %>% select(NUMCOM,COM,CODDEP,CODREG,REG,PTOT,Code_postal) %>% left_join(.,coverage) %>% select(-c(NOMCOM:NOMDEP)) %>% 
#  filter(REG=="Île-de-France") %>% mutate(HighLowECEC=ifelse((as.numeric(tauxcouv_com)-as.numeric(tauxcouv_dep))>0,"High ECEC covering", "Low ECEC covering"))
#
## Add latitude and longitude
#Demographics <- left_join(Demographics, latlong, by = "NUMCOM")
#
#
#
## Put this info in the main dataframe
#RCT <-  RCT %>% left_join(.,Demographics ,by=c("ZipcodeEndline"="Code_postal"), suffix = c("Baseline", "Endline")) %>% 
#  filter(!duplicated(ResponseId))# the merging creates duplicates, to remove
#
## Record the number of participants living in the city where each participant live at endline
#RCT <- RCT %>% 
#  group_by(ZipcodeEndline) %>% 
#  mutate(nbr_city_endline = n()) %>% ungroup()
#
## Record the number of participants living in the city where each participant live at baseline
#RCT <- RCT %>% 
#  group_by(CodePostalBaseline) %>% 
#  mutate(nbr_city_baseline = n()) %>% ungroup()
#
#rm(pop, post, coverage, latlong)
#
```

``` {r subsets, include = FALSE}

## In this chunk, we deal with occupation data
#Codage de l'index PCS

library(occupar) # socioeconomic status (isco to isei function) 
library(psych)
library(dplyr)

ses_data <- select(RCT, OrderedEduc, OrderedEduc2, WorkMotherOccupation, WorkFatherOccupation,ResponseId)


#Partie 1 : codage de l'éducation

#No diploma - 0
#Certificate of primary education - 5
#Lower secondary education (middle school) - 9
#Upper professional secondary education - 11
#Upper general or technological secondary education - 12
#Two years of higher education - 14
#Bachelor’s degree - 15
#Four years of higher education - 16
#Master’s degree - 17
#Doctorate’s degree - 20

#Codage de l'educ de la mère

RCT$OrderedEduc <- as.character(RCT$OrderedEduc)

ses_data <- ses_data %>% 
  mutate(educ_mother = case_when(
    OrderedEduc == "No school" ~ 0,
    OrderedEduc == "9-11" ~ 5,
    OrderedEduc == "Brevet" ~ 9,
    OrderedEduc == "CAP" ~ 11,
    OrderedEduc == "Bac" ~ 12,
    OrderedEduc == "Bac +2" ~ 14,
    OrderedEduc == "Bac + 3" ~ 15,
    OrderedEduc == "Bac + 4/5" ~ 17,
    OrderedEduc == "+ Bac+5" ~ 20,
        TRUE ~ NA_integer_
  ))

#Codage de l'educ du père

RCT$OrderedEduc2 <- as.character(RCT$OrderedEduc2)

ses_data <- ses_data %>% 
  mutate(educ_father = case_when(
    OrderedEduc2 == "No school" ~ 0,
    OrderedEduc2 == "9-11" ~ 5,
    OrderedEduc2 == "Brevet" ~ 9,
    OrderedEduc2 == "CAP" ~ 11,
    OrderedEduc2 == "Bac" ~ 12,
    OrderedEduc2 == "Bac +2" ~ 14,
    OrderedEduc2 == "Bac + 3" ~ 15,
    OrderedEduc2 == "Bac + 4/5" ~ 17,
    OrderedEduc2 == "+ Bac+5" ~ 20,
        TRUE ~ NA_integer_
  ))


#Partie 2 : codage de l'occupation

#Codage de l'isco de la mère

RCT$WorkMotherOccupation <- as.character(RCT$WorkMotherOccupation)

ses_data <- ses_data %>% 
  mutate(isco_mother = case_when(
    WorkMotherOccupation == "agent territorial spécialisé dans les écoles maternelles (ATSEM)" ~ 5310,
    WorkMotherOccupation == "Enseignante maternelle (au Soudan pas en France)" ~ 2340,
    WorkMotherOccupation == "Communicante dans une boîte de com" ~ 4220,
    WorkMotherOccupation == "Etudiante élaboration de projet pro" ~ 9700,
    WorkMotherOccupation == "Serveuse dans un hôtel" ~ 5130,
    WorkMotherOccupation == "etudiante" ~ 9700,
    WorkMotherOccupation == "En formation" ~ 9700,
    WorkMotherOccupation == "Directrice adjointe en crèche" ~ 1340,
    WorkMotherOccupation == "Animatrice à la cantine" ~ 5310,
    WorkMotherOccupation == "Cheffe de projet entreprenariat" ~ 2430,
    WorkMotherOccupation == "contrôleuse des finances publiques" ~ 3350,
    WorkMotherOccupation == "Auxiliaire de puériculture dans une crèche" ~ 5310,
    WorkMotherOccupation == "Contrôleur de gestion" ~ 2420,
    WorkMotherOccupation == "Avocate" ~ 2610,
    WorkMotherOccupation == "Juge" ~ 2610,
    WorkMotherOccupation == "enseignante" ~ 2330,
    WorkMotherOccupation == "Puéricultrice en crèche" ~ 5310,
    WorkMotherOccupation == "Responsable, gestion du soin de 4 services à l'hôpital" ~ 1340,
    WorkMotherOccupation == "A une entreprise dans l'immobilier en indépendante" ~ 3330,
    WorkMotherOccupation == "Chargée de mission capitalisation (insertion pro)" ~ 4310,
    WorkMotherOccupation == "prestataire de service de nettoyage" ~ 9110,
    WorkMotherOccupation == "Orthophoniste" ~ 2260,
    WorkMotherOccupation == "Traductrice dans l'ambassade italienne" ~ 2640,
    WorkMotherOccupation == "Coordinatrice administrative" ~ 2420,
    WorkMotherOccupation == "Responsable des relations donateurs" ~ 2430,
    WorkMotherOccupation == "Gouvernante" ~ 5150,
    WorkMotherOccupation == "Géomathicienne (manipulation d'information géographique) dans la fonction publique" ~ 2160,
    WorkMotherOccupation == "Commerciale" ~ 2430,
    WorkMotherOccupation == "Graviste" ~ 2160,
    WorkMotherOccupation == "Consultante" ~ 2430,
    WorkMotherOccupation == "Cybersécurité" ~ 3510,
    WorkMotherOccupation == "Femme de ménage" ~ 9110,
    WorkMotherOccupation == "Secraitaire" ~ 4120,
    WorkMotherOccupation == "étudiante (n'a jamais travaillé )" ~ 9700,
    WorkMotherOccupation == "Cantinière, ménagère dans un lycée" ~ 5120,
    WorkMotherOccupation == "second de cuisine" ~ 5120,
    WorkMotherOccupation == "Coordinatrice prévention" ~ 3130,
    WorkMotherOccupation == "Gestionnaire de patrimoine" ~ 3310,
    WorkMotherOccupation == "Hôtesse d'accueil" ~ 4220,
    WorkMotherOccupation == "Technicien spécialisé en développement informatique" ~ 3510,
    WorkMotherOccupation == "Elle veut apprendre à lire et écrire le français puis trouver un emploi" ~ 9700,
    WorkMotherOccupation == "Vendeuse" ~ 5220,
    WorkMotherOccupation == "Cheffe de projet informatique" ~ 2520,
    WorkMotherOccupation == "Consultante en organisation" ~ 2420,
    WorkMotherOccupation == "marketing digital" ~ 2430,
    WorkMotherOccupation == "Agente en marketing" ~ 3330,
    WorkMotherOccupation == "Souhaite travailler dans une cantine scolaire" ~ 9700,
    WorkMotherOccupation == "professeur" ~ 2330,
    WorkMotherOccupation == "conseillère pôle-emploi" ~ 3410,
    WorkMotherOccupation == "Coordinatrice dans un cabinet médical" ~ 3340,
    WorkMotherOccupation == "Accompagnement des enfants en situation d'handicap à l'école" ~ 5310,
    WorkMotherOccupation == "Ingénieure" ~ 2140,
    WorkMotherOccupation == "hôtesse d'accueil" ~ 4220,
    WorkMotherOccupation == "comptable" ~ 4310,
    WorkMotherOccupation == "Secrétaire" ~ 4120,
    WorkMotherOccupation == "Créatrice de robes de mariées" ~ 7530,
    WorkMotherOccupation == "DRH" ~ 1210,
    WorkMotherOccupation == "Développeuse informatique" ~ 2520,
    WorkMotherOccupation == "cheffe de projet" ~ 2430,
    WorkMotherOccupation == "Chef de projet" ~ 2430,
    WorkMotherOccupation == "Responsable événementiel" ~ 2430,
    WorkMotherOccupation == "Secrétaire de production" ~ 3340,
    WorkMotherOccupation == "aide-soignante" ~ 5320,
    WorkMotherOccupation == "cantinière" ~ 5120,
    WorkMotherOccupation == "Psychologue" ~ 2630,
    WorkMotherOccupation == "coiffeuse" ~ 5140,
    WorkMotherOccupation == "service client" ~ 1220,
    WorkMotherOccupation == "étudiante" ~ 9700,
    WorkMotherOccupation == "Développement web" ~ 3510,
    WorkMotherOccupation == "Responsable RH" ~ 1210,
    WorkMotherOccupation == "Coiffeuse + femme de ménage" ~ 5140,
    WorkMotherOccupation == "Responsable commerciale chimie" ~ 1220,
    WorkMotherOccupation == "Responsable des études environnementales dans une entreprise" ~ 1220,
    WorkMotherOccupation == "Assistante exécutive OCDE" ~ 2420,
    WorkMotherOccupation == "responsable service RH" ~ 1210,
    WorkMotherOccupation == "Vendeuse prêt-à-porter" ~ 5220,
    WorkMotherOccupation == "gestionnaire copropriété dans un syndicat" ~ 3410,
    WorkMotherOccupation == "vendeuse" ~ 5220,
    WorkMotherOccupation == "Chargée de recrutement" ~ 2420,
    WorkMotherOccupation == "Coordinatrice caisse et accueil dans un magasin" ~ 3330,
    WorkMotherOccupation == "Commerciale" ~ 3330,
    WorkMotherOccupation == "Conseillère bancaire" ~ 3310,
    WorkMotherOccupation == "Ancienne profession : opticienne. En formation pour devenir dévelopeuse informatique." ~ 3250,
    WorkMotherOccupation == "Fleuriste" ~ 7310,
    WorkMotherOccupation == "infirmière - management de la santé" ~ 2220,
    WorkMotherOccupation == "agente de puériculture" ~ 5310,
    WorkMotherOccupation == "agent de nettoyage" ~ 9110,
    WorkMotherOccupation == "Responsable éditorial" ~ 1330,
    WorkMotherOccupation == "Juriste d'entreprise" ~ 2610,
    WorkMotherOccupation == "Styliste dans le prêt-à-porter" ~ 2160,
    WorkMotherOccupation == "Etudiante" ~ 9700,
    WorkMotherOccupation == "Conseillère banquaire" ~ 3310,
    WorkMotherOccupation == "Médecin" ~ 2210,
    WorkMotherOccupation == "data analyst" ~ 2520,
    WorkMotherOccupation == "Conseil en direction financière pour accompagner PME et start-up" ~ 2410,
    WorkMotherOccupation == "professeur d'anglais" ~ 2330,
    WorkMotherOccupation == "Avant garde d'enfant à domicile mais souhaite se reconvertir en aide soignante." ~ 5310,
    WorkMotherOccupation == "agent de cuisine" ~ 9410,
    WorkMotherOccupation == "Cheffe gérante dans la restauration collective" ~ 5120,
    WorkMotherOccupation == "Responsable commercial" ~ 1220,
    WorkMotherOccupation == "Cheffe de projet web" ~ 2510,
    WorkMotherOccupation == "Illustratrice à son compte" ~ 3430,
    WorkMotherOccupation == "Auxiliaire de puériculture en réanimation" ~ 5310,
    WorkMotherOccupation == "Clerc gestionnaire" ~ 3410,
    WorkMotherOccupation == "Manager dans une société américaine" ~ 1220,
    WorkMotherOccupation == "Référente inclusion à la mairie d'Arcueil" ~ 3410,
    WorkMotherOccupation == "Pas d'études, pas de métier" ~ 9700,
    WorkMotherOccupation == "contrôleuse financière" ~ 2410,
    WorkMotherOccupation == "Ingénieure en informatique" ~ 2150,
    WorkMotherOccupation == "avocate" ~ 2610,
    WorkMotherOccupation == "esthéticienne" ~ 5140,
    WorkMotherOccupation == "Visuel marchandizing" ~ 2430,
    WorkMotherOccupation == "Puéricultrice" ~ 5310,
    WorkMotherOccupation == "Conseillère de vente en parfumerie" ~ 5220,
    WorkMotherOccupation == "assistante de direction" ~ 3430,
    WorkMotherOccupation == "Médecin de formation" ~ 2210,
    WorkMotherOccupation == "Blanchisseuse" ~ 7530,
    WorkMotherOccupation == "Technicien de surface (nettoyage école maternelle)" ~ 9110,
    WorkMotherOccupation == "Educatrice" ~ 3410,
    WorkMotherOccupation == "professeur des écoles" ~ 2340,
    WorkMotherOccupation == "journaliste" ~ 2640,
    WorkMotherOccupation == "auxiliaire de puériculture" ~ 5310,
    WorkMotherOccupation == "Chercheuse" ~ 2310,
    WorkMotherOccupation == "Responsable de projet (plateau informatique)" ~ 2510,
    WorkMotherOccupation == "CAP Petite enfance" ~ 5310,
    WorkMotherOccupation == "Responsable service presse et relation com" ~ 2430,
    WorkMotherOccupation == "fonctionnaire de l'éducation nationale : gestionnaire en ressources humaines" ~ 4110,
    WorkMotherOccupation == "infirmière" ~ 3220,
    WorkMotherOccupation == "Conseillère en finance" ~ 2410,
    WorkMotherOccupation == "vendeuse caissière" ~ 5230,
    WorkMotherOccupation == "Chargée de communication" ~ 2430,
    WorkMotherOccupation == "Préparatrice en pharmacie" ~ 3210,
    WorkMotherOccupation == "Avocat" ~ 2610,
    WorkMotherOccupation == "Auditrice" ~ 2410,
    WorkMotherOccupation == "Auxiliaire de vie en maison de retraite" ~ 5320,
    WorkMotherOccupation == "Professeure d'anglais en lycée" ~ 2330,
    WorkMotherOccupation == "Chargée de recherche pour une entreprise pharmaceutique" ~ 2110,
    WorkMotherOccupation == "Agente administrative à la CAF" ~ 3350,
    WorkMotherOccupation == "Editrice" ~ 1330,
    WorkMotherOccupation == "Agent ratp" ~ 5110,
    WorkMotherOccupation == "Attachée de recherche clinique" ~ 3250,
    WorkMotherOccupation == "Lobbyist" ~ 2410,
    WorkMotherOccupation == "Chargée administrative" ~ 4110,
    WorkMotherOccupation == "Employée en magasin" ~ 5220,
    WorkMotherOccupation == "graphiste" ~ 2160,
    WorkMotherOccupation == "Assistante administrative" ~ 4110,
    WorkMotherOccupation == "Responsable du service juridique à la direction des ressources humaines des ministères sociaux" ~ 1110,
    WorkMotherOccupation == "Officier de l'engagement politique (dans une organisation internationale)" ~ 2610,
    WorkMotherOccupation == "Technicienne en biomédical" ~ 3210,
    WorkMotherOccupation == "agent de propreté" ~ 9110,
    WorkMotherOccupation == "Consultante en gestion de projet pour les assurances" ~ 2420,
    WorkMotherOccupation == "manager de technicien gaz passage en poste administratif à la reprise" ~ 1320,
    WorkMotherOccupation == "RRH" ~ 1210,
    WorkMotherOccupation == "Kiné" ~ 2240,
    WorkMotherOccupation == "Infirmière" ~ 3220,
    WorkMotherOccupation == "Esthéticienne" ~ 5140,
    WorkMotherOccupation == "Contrôleuse de gestion" ~ 2420,
    WorkMotherOccupation == "Conseillère en vente chez sephora" ~ 5220,
    WorkMotherOccupation == "Agent technique de la fonction publique" ~ 9110,
    WorkMotherOccupation == "responsable RH" ~ 1210,
    WorkMotherOccupation == "Aide Educatrice de jeunes enfants" ~ 5310,
    WorkMotherOccupation == "Banquière" ~ 3310,
    WorkMotherOccupation == "Juriste" ~ 2610,
    WorkMotherOccupation == "professeure des écoles" ~ 2340,
    WorkMotherOccupation == "Cuisinière mais aimerait bien changer car horaire pas forcément adaptés" ~ 5120,
    WorkMotherOccupation == "AES" ~ 5310,
    WorkMotherOccupation == "AESH" ~ 5310,
    WorkMotherOccupation == "Chargée de clientèle" ~ 4220,
    WorkMotherOccupation == "Assistante médicale" ~ 3250,
    WorkMotherOccupation == "Vendeuse à liddl" ~ 5220,
    WorkMotherOccupation == "Etudiante géographie" ~ 9700,
    WorkMotherOccupation == "Documentaliste (à l'étranger) et en france elle était en Formation" ~ 2620,
    WorkMotherOccupation == "Professeur des écoles" ~ 2340,
    WorkMotherOccupation == "Agent en informatique" ~ 2520,
    WorkMotherOccupation == "coordinatrice" ~ 4110,
    WorkMotherOccupation == "Manager d'équipe dans une société de prestation de santé à domicile" ~ 1340,
    WorkMotherOccupation == "Agente polyvalente en crèche" ~ 5310,
    WorkMotherOccupation == "Aide soignante" ~ 5320,
    WorkMotherOccupation == "assistante sociale" ~ 3410,
    WorkMotherOccupation == "Manager dans le Service après vente Saint Laurent" ~ 1220,
    WorkMotherOccupation == "Enseignante-chercheuse à l'université" ~ 2310,
    WorkMotherOccupation == "auxiliaire de vie" ~ 5320,
    WorkMotherOccupation == "Contrôleuse de gestion dans une entreprise de BTP" ~ 4310,
    WorkMotherOccupation == "Consultante marketing" ~ 2430,
    WorkMotherOccupation == "conseillère à la sécurité sociale" ~ 3410,
    WorkMotherOccupation == "factrice" ~ 4410,
    WorkMotherOccupation == "Architecte" ~ 2160,
    WorkMotherOccupation == "Fonctionnaire chargée de projet pour le ministère des armées" ~ 2420,
    WorkMotherOccupation == "FP&A manager" ~ 2410,
    WorkMotherOccupation == "technicienne de laboratoire" ~ 3210,
    WorkMotherOccupation == "Directrice de résidence sociale" ~ 3410,
    WorkMotherOccupation == "concierge" ~ 5150,
    WorkMotherOccupation == "Aide à domicile" ~ 5320,
    WorkMotherOccupation == "Etudiante responsable RH et administrative, souhaite reprendre en janvier idéalement" ~ 9700,
    WorkMotherOccupation == "Manipulatrice radio" ~ 3210,
    WorkMotherOccupation == "cheffe de projet marketing" ~ 2430,
    WorkMotherOccupation == "Aide soignante" ~ 5320,
    WorkMotherOccupation == "Graphiste" ~ 2160,
    WorkMotherOccupation == "Gestion de projet informatique" ~ 2520,
    WorkMotherOccupation == "responsable marketing" ~ 1220,
    WorkMotherOccupation == "Ingénieur informatique" ~ 2150,
    WorkMotherOccupation == "paysagiste" ~ 2160,
    WorkMotherOccupation == "chargée de clientèle" ~ 4220,
    WorkMotherOccupation == "Aide médico-psychologique Polyhandicaptés" ~ 5320,
    WorkMotherOccupation == "Garde d'enfant" ~ 5310,
    WorkMotherOccupation == "auxiliaire de vie" ~ 5320,
    WorkMotherOccupation == "Formation comptabilité gestion" ~ 9700,
    WorkMotherOccupation == "secrétaire" ~ 4120,
    WorkMotherOccupation == "Confection de sacs en cuire / Artisan" ~ 7530,
    WorkMotherOccupation == "Aide- Soignante" ~ 5320,
    WorkMotherOccupation == "Monteuse vidéo" ~ 3430,
    WorkMotherOccupation == "Assistante de direction dans le domaine de la sécurité privée" ~ 3340,
    WorkMotherOccupation == "Directrice de centre de loisirs --> Conseillère en insertion" ~ 3410,
    WorkMotherOccupation == "Gestionnaire comptable" ~ 4310,
    WorkMotherOccupation == "Polyvalente restauration rapide" ~ 5240,
    WorkMotherOccupation == "agent d'accueil" ~ 4220,
    WorkMotherOccupation == "Stratégiste en agence de pub" ~ 2430,
    WorkMotherOccupation == "Agent de réservation dans une agence de voyage" ~ 4220,
    WorkMotherOccupation == "Manager en parfumerie" ~ 5220,
    WorkMotherOccupation == "Hotesse d'accueil" ~ 4220,
    WorkMotherOccupation == "étudiante (avant était alternante)" ~ 9700,
    WorkMotherOccupation == "Enseignante" ~ 2330,
    WorkMotherOccupation == "Agent d'accueil dans les centre d'hebergement" ~ 4220,
    WorkMotherOccupation == "femme de ménage" ~ 9110,
    WorkMotherOccupation == "Caissière" ~ 5230,
    WorkMotherOccupation == "éducatrice spécialisée" ~ 3410,
    WorkMotherOccupation == "assistante sociale aux urgences" ~ 3410,
    WorkMotherOccupation == "Vendeuse en bijouterie" ~ 5220,
    WorkMotherOccupation == "Assistante maternelle" ~ 5310,
    WorkMotherOccupation == "Auxiliaire puéricultrice" ~ 5310,
    WorkMotherOccupation == "Technicienne de surface" ~ 9110,
    WorkMotherOccupation == "Hôtesse de caisse" ~ 5230,
    WorkMotherOccupation == "Garde d'enfants" ~ 5310,
    WorkMotherOccupation == "Aide-soignante" ~ 5320,
    WorkMotherOccupation == "Pharmacologiste" ~ 2260,
    WorkMotherOccupation == "BTS en commerce international. A travaillé beaucoup en boulangerie." ~ 9700,
    WorkMotherOccupation == "coordinatrice clinique" ~ 3340,
    WorkMotherOccupation == "animatrice dans la petite enfance" ~ 5310,
    WorkMotherOccupation == "intermittente du spectacle, comédienne" ~ 2650,
    WorkMotherOccupation == "assistante adv" ~ 4320,
    WorkMotherOccupation == "Assistante marketing" ~ 3330,
    WorkMotherOccupation == "Cadre de santé" ~ 1340,
    WorkMotherOccupation == "Manipulatrice en radiologie" ~ 3210,
    WorkMotherOccupation == "Coiffeuse" ~ 5140,
    WorkMotherOccupation == "élève infirmière" ~ 9700,
    WorkMotherOccupation == "juriste" ~ 2610,
    WorkMotherOccupation == "Aide soignante de nuit" ~ 5320,
    WorkMotherOccupation == "Monitrice éducatrice" ~ 3410,
    WorkMotherOccupation == "Assistante dentaire" ~ 3250,
    WorkMotherOccupation == "Consultante en informatique" ~ 2520,
    WorkMotherOccupation == "Vendeuse en prêt-à-porter" ~ 5220,
    WorkMotherOccupation == "chef de projet" ~ 2430,
    WorkMotherOccupation == "Médecin rhumatologue" ~ 2210,
    WorkMotherOccupation == "Infirmière en réanimation pédiatrique" ~ 3220,
    WorkMotherOccupation == "accompagnement éducatif et social" ~ 5310,
    WorkMotherOccupation == "vendeuse dans prêt-à-porter" ~ 5220,
    WorkMotherOccupation == "Enseignante salariée et graphiste auto-entrepreneur" ~ 2160,
    WorkMotherOccupation == "Acheteur" ~ 3320,
    WorkMotherOccupation == "Musicienne" ~ 2650,
    WorkMotherOccupation == "Administratrice des ventes mais j'aimerais reprendre en tant que professeur des écoles" ~ 2430,
    WorkMotherOccupation == "Infirmière en bloc opératoire" ~ 3220,
    WorkMotherOccupation == "Militaire : ressources humaines" ~ 0310,
    WorkMotherOccupation == "Infirmière libérale" ~ 3220,
    WorkMotherOccupation == "Conseillère en gestion patrimoine" ~ 3310,
    WorkMotherOccupation == "sans activité professionnelle" ~ 9700,
    WorkMotherOccupation == "Travailleuse sociale" ~ 3410,
    WorkMotherOccupation == "Anciennement animatrice mais souhaite changer de secteur pour travailler comme animatrice dans une maison de retraite." ~ 5310,
    WorkMotherOccupation == "Rédactrice" ~ 2640,
    WorkMotherOccupation == "Responsable de données ministère" ~ 2520,
    WorkMotherOccupation == "Responsable administrative et financière" ~ 1210,
    WorkMotherOccupation == "Garde d'enfant mais va se réorienter en informatique" ~ 5310,
    WorkMotherOccupation == "Senior consultante transformation industrielle" ~ 2410,
    WorkMotherOccupation == "Manager Hôtelierie" ~ 1410,
    WorkMotherOccupation == "technicienne dessinatrice dans un bureau d'études" ~ 3110,
    WorkMotherOccupation == "gestionnaire administrative" ~ 3340,
    WorkMotherOccupation == "Agent pour les personnalités publiques" ~ 3430,
    WorkMotherOccupation == "commerciale" ~ 3330,
    WorkMotherOccupation == "ingénieur génie civil" ~ 2140,
    WorkMotherOccupation == "Professeure en sciences politiques" ~ 2330,
    WorkMotherOccupation == "Professeur au collège" ~ 2330,
    WorkMotherOccupation == "Agent d'accueil et de surveillance dans un musée" ~ 4220,
    WorkMotherOccupation == "Informatique" ~ 2520,
    WorkMotherOccupation == "Enseignante" ~ 2330,
    WorkMotherOccupation == "Professeur" ~ 2330,
    WorkMotherOccupation == "ingénieure informatique" ~ 2150,
    WorkMotherOccupation == "auxiliaire du puériculture en crèche" ~ 5310,
    WorkMotherOccupation == "Travaille à la poste (ne donne pas de détails)" ~ 9620,
    WorkMotherOccupation == "Ingénieure en affaires clinique" ~ 2130,
    WorkMotherOccupation == "Maîtresse d'école" ~ 2340,
    WorkMotherOccupation == "Aide auxiliaire dans une crèche" ~ 5310,
    WorkMotherOccupation == "dessinatrice-peintre" ~ 2650,
    WorkMotherOccupation == "Professeur d'arts plastiques" ~ 2350,
    WorkMotherOccupation == "Assistante des ventes" ~ 5220,
    WorkMotherOccupation == "Cuisinière" ~ 5120,
    WorkMotherOccupation == "Animatrice" ~ 5310,
    WorkMotherOccupation == "Educatrice pour jeunes enfants" ~ 2340,
    WorkMotherOccupation == "Designer" ~ 2160,
    WorkMotherOccupation == "Professeur de mathématiques" ~ 2330,
    WorkMotherOccupation == "vendeuse boulangerie" ~ 5220,
    WorkMotherOccupation == "Diététicienne" ~ 2260,
    WorkMotherOccupation == "Infirmière en chirurgie digestive" ~ 3220,
    WorkMotherOccupation == "Directrice de cinéma" ~ 1430,
    WorkMotherOccupation == "Secrétaire administratif" ~ 3340,
    WorkMotherOccupation == "Technicienne en laboratoire" ~ 3110,
    WorkMotherOccupation == "Professeur de musique" ~ 2350,
    WorkMotherOccupation == "Data analyst" ~ 2520,
    WorkMotherOccupation == "Auxiliaire de vie" ~ 5320,
    WorkMotherOccupation == "Auxiliaire de Vie Scolaire" ~ 5310,
    WorkMotherOccupation == "médecin" ~ 2210,
    WorkMotherOccupation == "Assistante Administrative" ~ 4110,
    WorkMotherOccupation == "secrétaire médicale" ~ 3340,
    WorkMotherOccupation == "Secrétaire médicale" ~ 3340,
    WorkMotherOccupation == "Journaliste" ~ 2640,
    WorkMotherOccupation == "Animatrice périscolaire" ~ 5310,
    WorkMotherOccupation == "Animatrice en crèche" ~ 5310,
    WorkMotherOccupation == "Caissière (agent polyvalent)" ~ 5230,
    WorkMotherOccupation == "Personnel navigant commercial (hôtesse de l'air)" ~ 5110,
    WorkMotherOccupation == "Etudiante aide soignante" ~ 9700,
    WorkMotherOccupation == "Agent d'entretien" ~ 9110,
    WorkMotherOccupation == "Contrôleuse à la CAF" ~ 3350,
    WorkMotherOccupation == "Auxiliaire de crèche" ~ 5310,
    WorkMotherOccupation == "Auxiliaire petite enfance" ~ 5310,
    WorkMotherOccupation == "Chargé d'attribution dans le logement social" ~ 3410,
    WorkMotherOccupation == "Opticienne" ~ 3250,
    WorkMotherOccupation == "Historienne de l'art en thèse" ~ 2630,
    WorkMotherOccupation == "N'a pas travailler avant" ~ 9700,
    WorkMotherOccupation == "Assistante d'éducation" ~ 5310,
    WorkMotherOccupation == "Nounou à domicile" ~ 5310,
    WorkMotherOccupation == "responsable plaidoyer" ~ 1220,
    WorkMotherOccupation == "auxiliaire de crèche" ~ 5310,
    WorkMotherOccupation == "cuisinière" ~ 5120,
    WorkMotherOccupation == "Maîtresse D'Ecole" ~ 2340,
    WorkMotherOccupation == "Agent d'escale à l'aéroport" ~ 5110,
    WorkMotherOccupation == "Secrétaire dans un cabinet dentaire" ~ 3340,
    WorkMotherOccupation == "service de restauration" ~ 5130,
    WorkMotherOccupation == "Enseignante en formation pour être enseignante spécialisée avec enfants porteurs de handicap (pendant 1 an). Mi-temps en formation et mi-temps en classe." ~ 9700,
    WorkMotherOccupation == "Service et cuisine" ~ 9410,
    WorkMotherOccupation == "Student" ~ 9700,
    WorkMotherOccupation == "Ni étudiante, ni métier." ~ 9700,
    WorkMotherOccupation == "Chef de projet informatique" ~ 2520,
    WorkMotherOccupation == "travaille dans la publicité ( ne donne pas de détails)" ~ 2430,
    WorkMotherOccupation == "éducatrice" ~ 5310,
    WorkMotherOccupation == "Formation de chauffeur de bus" ~ 9700,
    WorkMotherOccupation == "aide éducatrice de jeunes enfants en crèche" ~ 5310,
    WorkMotherOccupation == "Medecin généraliste" ~ 2210,
    WorkMotherOccupation == "Etudiante journalisme" ~ 9700,
    WorkMotherOccupation == "Professeure des école" ~ 2340,
    WorkMotherOccupation == "Auxiliaire de puériculture" ~ 5310,
    WorkMotherOccupation == "dentiste" ~ 2260,
    WorkMotherOccupation == "Dentiste" ~ 2260,
    WorkMotherOccupation == "directrice de crèche" ~ 1340,
    WorkMotherOccupation == "Agente d'entretien" ~ 9110,
    WorkMotherOccupation == "Médecin Généraliste" ~ 2210,
    WorkMotherOccupation == "Ostéopathe" ~ 2260,
    WorkMotherOccupation == "Assistante juridique" ~ 2610,
    WorkMotherOccupation == "Comédienne" ~ 2650,
    WorkMotherOccupation == "Salon de beauté" ~ 5140,
    WorkMotherOccupation == "Eboueur" ~ 9610,
    WorkMotherOccupation == "juriste en marché public" ~ 2610,
    WorkMotherOccupation == "pédiatre" ~ 2210,
    WorkMotherOccupation == "Auxiliaire puériculture" ~ 5310,
    WorkMotherOccupation == "Intermittente du spectacle" ~ 2650,
    WorkMotherOccupation == "aide soignante" ~ 5320,
    WorkMotherOccupation == "chauffeur livreur" ~ 9620,
    WorkMotherOccupation == "Ménages" ~ 9110,
    WorkMotherOccupation == "Gardienne d'immeuble" ~ 5150,
    WorkMotherOccupation == "Chirugien gynécologique" ~ 2210,
    WorkMotherOccupation == "Professeure de danse" ~ 2350,
    WorkMotherOccupation == "Cheffe de cuisine" ~ 3430,
    WorkMotherOccupation == "Agent d'escale" ~ 5110,
    WorkMotherOccupation == "Médecin hospitalier" ~ 2210,
    WorkMotherOccupation == "Infermière" ~ 3220,
    WorkMotherOccupation == "Asistante médicale" ~ 3250,
    WorkMotherOccupation == "Educatrice spécialisée dans la protection de l'enfance" ~ 2340,
    WorkMotherOccupation == "Surveillante pénitentiaire" ~ 5410,
    WorkMotherOccupation == "préparatrice en pharmacie" ~ 3210,
    WorkMotherOccupation == "Enseignante de français au collège" ~ 2330,
    WorkMotherOccupation == "AVS et AESH" ~ 5310,
    WorkMotherOccupation == "Aide soignante en EPHAD" ~ 5320,
    WorkMotherOccupation == "serveuse" ~ 5130,
    WorkMotherOccupation == "Vendeuse dans un magasin de prêt à porter" ~ 5220,
    WorkMotherOccupation == "caissière" ~ 5230,
    WorkMotherOccupation == "educatrice spécialisée" ~ 2340,
    WorkMotherOccupation == "assistante ressources humaines" ~ 2420,
    WorkMotherOccupation == "Cantinière, Restauration" ~ 5120,
    WorkMotherOccupation == "directrice des affaires culturelles" ~ 1340,
    WorkMotherOccupation == "Préparatrice de commande en pharmacie" ~ 3210,
    WorkMotherOccupation == "Pharmacienne" ~ 2260,
    WorkMotherOccupation == "Agent d'accueil" ~ 4220,
    WorkMotherOccupation == "aide-auxiliaire en crèche" ~ 5310,
    WorkMotherOccupation == "Cuisine dans un restaurant" ~ 5230,
    WorkMotherOccupation == "agent de sécurité" ~ 5410,
    WorkMotherOccupation == "Responsable ressources humaines" ~ 1210,
    WorkMotherOccupation == "Diététicienne hôpital" ~ 2260,
    WorkMotherOccupation == "Pharmacien" ~ 2260,
    WorkMotherOccupation == "Pharmacienne (inspectrice de pharmacie )" ~ 2260,
    WorkMotherOccupation == "ASH" ~ 5320,
    WorkMotherOccupation == "RH" ~ 1210,
    WorkMotherOccupation == "maître de conférences" ~ 2310,
    WorkMotherOccupation == "Master en finance" ~ 9700,
    WorkMotherOccupation == "conseillère clientèle" ~ 4220,
    WorkMotherOccupation == "Enseignante remplaçante" ~ 2340,
    WorkMotherOccupation == "agent polyvalent en restauration" ~ 5240,
    WorkMotherOccupation == "Educatrice spécialisée" ~ 2340,
    WorkMotherOccupation == "Infirmière de nuit" ~ 3220,
    WorkMotherOccupation == "Chargé de mission RH" ~ 2420,
    WorkMotherOccupation == "Vendeuse chez Picard" ~ 5220,
    WorkMotherOccupation == "Vendeuse en magasin" ~ 5220,
    WorkMotherOccupation == "serveuse en salle dans la restauration" ~ 5130,
    WorkMotherOccupation == "Accompagnatrice d'enfant à l'école" ~ 5310,
    WorkMotherOccupation == "Secrétaire administrative" ~ 3340,
    WorkMotherOccupation == "Directrice commercial" ~ 1220,
    WorkMotherOccupation == "directrice commerciale" ~ 1220,
    WorkMotherOccupation == "opticienne" ~ 3250,
    WorkMotherOccupation == "Auxiliaire de puériculture / Cantinière" ~ 5310,
    WorkMotherOccupation == "Styliste" ~ 2160,
    WorkMotherOccupation == "agent d'entretien" ~ 9110,
    WorkMotherOccupation == "Animatrice pour les enfants" ~ 5310,
    WorkMotherOccupation == "AIde soignante" ~ 5320,
    WorkMotherOccupation == "Conseillère pole emploi" ~ 3410,
    WorkMotherOccupation == "Responsable service administratif" ~ 1210,
    WorkMotherOccupation == "assistante maternelle" ~ 5310,
    WorkMotherOccupation == "cuisnière" ~ 5120,
    WorkMotherOccupation == "Diététicienne nutritionniste en pédiatrie" ~ 2260,
    WorkMotherOccupation == "A été licenciée (architecte), maintenant monte sa boite d'architecture" ~ 2160,
    WorkMotherOccupation == "Conseillère de vente" ~ 5220,
    WorkMotherOccupation == "Travaille dans un supermarché" ~ 9330,
    WorkMotherOccupation == "Agent d'entretien en crèche" ~ 9110,
    WorkMotherOccupation == "agent d'entretien" ~ 9110,
    WorkMotherOccupation == "Etudiante pour Agent d'accueil" ~ 9700,
    WorkMotherOccupation == "agent d'accueil secrétaire" ~ 4120,
    WorkMotherOccupation == "Garde d'enfants et femme de ménage" ~ 5310,
    WorkMotherOccupation == "Réceptionniste" ~ 4220,
    WorkMotherOccupation == "Chargée ressources humaines" ~ 2420,
    WorkMotherOccupation == "Conservatrice de bibliothèque" ~ 2620,
    WorkMotherOccupation == "ingénieure de recherche" ~ 2140,
    WorkMotherOccupation == "ingénieure en informatique" ~ 2150,
    WorkMotherOccupation == "directrice générale adjointe" ~ 1120,
    WorkMotherOccupation == "Enseignante à l'éducation nationale" ~ 2330,
    WorkMotherOccupation == "Etudiante (va reprendre une nouvelle formation CAP, l'année prochaine)" ~ 9700,
    WorkMotherOccupation == "Approvisionneuse" ~ 4320,
    WorkMotherOccupation == "Chirurgienne de justice" ~ 2210,
    WorkMotherOccupation == "Employé polyvalent en crèche" ~ 5310,
    WorkMotherOccupation == "agent de voyage" ~ 4220,
    WorkMotherOccupation == "architecte" ~ 2160,
    WorkMotherOccupation == "Restauratrice en cantine" ~ 5120,
    WorkMotherOccupation == "Secrétaire médicale en neurologie" ~ 3340,
    WorkMotherOccupation == "Auxiliaire crèche" ~ 5310,
    WorkMotherOccupation == "Gendarme" ~ 3350,
    WorkMotherOccupation == "Nettoyeuse" ~ 9110,
    WorkMotherOccupation == "Pédicure Podologue" ~ 2240,
    WorkMotherOccupation == "Étudiante économie" ~ 9700,
    WorkMotherOccupation == "Photographe" ~ 3430,
    WorkMotherOccupation == "Conseillère principale d'éducation" ~ 1340,
    WorkMotherOccupation == "vendeuse polyvalente" ~ 5220,
    WorkMotherOccupation == "Professeur de langue anglaise" ~ 2330,
    WorkMotherOccupation == "Secrétaire médicale dans un laboratoire" ~ 3340,
    WorkMotherOccupation == "Patissière" ~ 7510,
    WorkMotherOccupation == "AESH (Aide aux enfants en situation d'handicap) à l'école" ~ 5310,
    WorkMotherOccupation == "Serveuse en restauration" ~ 5130,
    WorkMotherOccupation == "animatrice scolaire" ~ 5310,
    WorkMotherOccupation == "femme au foyer" ~ 9700,
    WorkMotherOccupation == "archiviste" ~ 2620,
    WorkMotherOccupation == "Aide à la personne" ~ 5320,
    WorkMotherOccupation == "Serveuse" ~ 5130,
    WorkMotherOccupation == "Attachée d'enseignement à l'université (ATER)" ~ 2310,
    WorkMotherOccupation == "ressources humaines" ~ 2420,
    WorkMotherOccupation == "Femme de chambre" ~ 9110,
    WorkMotherOccupation == "Vendeuse en boulangerie" ~ 5220,
    WorkMotherOccupation == "Garde enfant et ménages" ~ 5310,
    WorkMotherOccupation == "garde d'enfant à domicile" ~ 5310,
    WorkMotherOccupation == "Agent de crèche" ~ 5310,
    WorkMotherOccupation == "Enseignante lycée" ~ 2330,
    WorkMotherOccupation == "Femme au foyer" ~ 9700,
    WorkMotherOccupation == "Freelance journaliste" ~ 2640,
    WorkMotherOccupation == "Agent d'entretien à l'aéroport" ~ 9110,
    WorkMotherOccupation == "auxiliaire puériculture" ~ 5310,
    WorkMotherOccupation == "Ressources humaines" ~ 2420,
    WorkMotherOccupation == "Audioprothésiste" ~ 3250,
    WorkMotherOccupation == "Psychologue clinicienne" ~ 2630,
    WorkMotherOccupation == "coiffeuse et maquilleuse" ~ 5140,
    WorkMotherOccupation == "auxiliaire de puériculture en halte-garderie" ~ 5310,
    WorkMotherOccupation == "Secretaire cabinet dentaire" ~ 3340,
    WorkMotherOccupation == "Vendeuse dans le prêt-à-porter" ~ 5220,
    WorkMotherOccupation == "éducatrice de jeunes enfants en crèche collective" ~ 2340,
    WorkMotherOccupation == "Médecin pédiatre" ~ 2210,
    WorkMotherOccupation == "Bouchère" ~ 7510,
    WorkMotherOccupation == "professeure au collège" ~ 2330,
    WorkMotherOccupation == "Infirmière Coordinatrice service de cancérologie" ~ 3220,
    WorkMotherOccupation == "Agente d'entretien dans un lycée" ~ 9110,
    WorkMotherOccupation == "directrice de centre de loisirs" ~ 1340,
    WorkMotherOccupation == "Pâtissière" ~ 7510,
    WorkMotherOccupation == "Vétérinaire" ~ 2250,
    WorkMotherOccupation == "Consultante RH" ~ 2420,
    WorkMotherOccupation == "Infirmière puéricultrice (direction de crèche)" ~ 1340,
    WorkMotherOccupation == "Surveillante pénitencier" ~ 5410,
    WorkMotherOccupation == "Ingénieur" ~ 2140,
    WorkMotherOccupation == "Dame de cantine" ~ 9410,
    WorkMotherOccupation == "vendeuse en boulangerie" ~ 5220,
    WorkMotherOccupation == "couturière" ~ 7530,
    WorkMotherOccupation == "garde d'enfants" ~ 5310,
    WorkMotherOccupation == "Conservateur de bibliothèque" ~ 2610,
    WorkMotherOccupation == "chirurgien dentiste" ~ 2260,
    WorkMotherOccupation == "Etudiante infirmière" ~ 9700,
    WorkMotherOccupation == "Auxiliaire de la petite enfance dans les crèches" ~ 5310,
    WorkMotherOccupation == "Mise en rayon au Monoprix rayon boulangerie" ~ 9330,
    WorkMotherOccupation == "Estéticienne" ~ 5140,
    WorkMotherOccupation == "entraîneuse de gymnastique" ~ 3420,
    WorkMotherOccupation == "aide à domicile" ~ 5320,
    WorkMotherOccupation == "employée de pharmacie" ~ 3210,
    WorkMotherOccupation == "architecte d'intérieur" ~ 3430,
    WorkMotherOccupation == "Agent d'entretien dans un collège" ~ 9110,
    WorkMotherOccupation == "Agent de puériculture" ~ 5310,
    WorkMotherOccupation == "vendeuse en magasin" ~ 5220,
    WorkMotherOccupation == "éboueuse" ~ 9610,
    WorkMotherOccupation == "Employée libre service dans le commerce" ~ 9330,
    WorkMotherOccupation == "ATSEM" ~ 5310,
    WorkMotherOccupation == "étudiante (à distance)" ~ 9700,
    WorkMotherOccupation == "Serveuse restaurant" ~ 5130,
    WorkMotherOccupation == "aide à domicile" ~ 5320,
    WorkMotherOccupation == "Audios portesiste" ~ 3250,
    WorkMotherOccupation == "Auxiliaire de vie domicile" ~ 5320,
    WorkMotherOccupation == "Gardienne" ~ 5150,
    WorkMotherOccupation == "Ergothérapeute" ~ 2240,
    WorkMotherOccupation == "Ecrivaine" ~ 2640,
    WorkMotherOccupation == "agent de nettoyage et garde d'enfant" ~ 5310,
    WorkMotherOccupation == "Réceptionniste en hôtellerie" ~ 4220,
    WorkMotherOccupation == "Aide éducatrice en crèche" ~ 5310,
    WorkMotherOccupation == "pharmacienne" ~ 2260,
    WorkMotherOccupation == "Traductrice" ~ 2640,
    WorkMotherOccupation == "patissière" ~ 7510,
    WorkMotherOccupation == "Juriste CAF" ~ 2610,
    WorkMotherOccupation == "auxiliaire puéricultrice" ~ 5310,
    WorkMotherOccupation == "Juriste en assurance" ~ 2610,
    WorkMotherOccupation == "Professeure des écoles" ~ 2340,
    WorkMotherOccupation == "styliste photo" ~ 2160,
    WorkMotherOccupation == "Consultante juridique" ~ 2610,
    WorkMotherOccupation == "aide manipulatrice en radiologie" ~ 3210,
    WorkMotherOccupation == "Responsable d'un magasin Yves Rocher" ~ 5220,
    WorkMotherOccupation == "Vendeuse en animalerie / Animatrice" ~ 5220,
    WorkMotherOccupation == "intermittente du spectacle" ~ 2650,
    WorkMotherOccupation == "Consultante en recrutement" ~ 2420,
    WorkMotherOccupation == "Banque de France, surveillance des infrastructures de marché" ~ 2410,
    WorkMotherOccupation == "Gouvernante générale" ~ 5150,
    WorkMotherOccupation == "Opératrice vidéo" ~ 3520,
    WorkMotherOccupation == "chef de projet finance" ~ 2410,
    WorkMotherOccupation == "designer" ~ 2160,
    WorkMotherOccupation == "Psychothérapeute" ~ 2630,
    WorkMotherOccupation == "Chargée des publics et de la communication dans un musée" ~ 2430,
    WorkMotherOccupation == "Auxiliaire de jeunes enfants" ~ 5310,
    WorkMotherOccupation == "Manucuriste" ~ 5140,
    WorkMotherOccupation == "Pharmacie" ~ 3210,
    WorkMotherOccupation == "ménage / restauration collective" ~ 9110,
    WorkMotherOccupation == "Inspectrice des Finances Publiques" ~ 1110,
    WorkMotherOccupation == "Je suis designer graphique en freelance. Donc j'ai travaillé temps en temps par projet. Mais le plus part de temps j'occupe mon bébé." ~ 2160,
    WorkMotherOccupation == "Rédactrice en chef" ~ 2640,
    WorkMotherOccupation == "Analyste financière" ~ 2410,
    WorkMotherOccupation == "Gouvernante en hôtellerie" ~ 5150,
    WorkMotherOccupation == "Assistante ressource humaine" ~ 3330,
    WorkMotherOccupation == "Professeure de Yoga" ~ 3420,
    WorkMotherOccupation == "Assistante sociale" ~ 3410,
    WorkMotherOccupation == "Artiste peintre" ~ 2650,
    WorkMotherOccupation == "Responsable adjointe de crèche pour la ville de Paris" ~ 1340,
    WorkMotherOccupation == "gérante d'une boutique de prêt à porter" ~ 5220,
    WorkMotherOccupation == "chargée de recrutement" ~ 3330,
    WorkMotherOccupation == "Assistante de vie" ~ 5320,
    WorkMotherOccupation == "chef de projet dans les assurances" ~ 1340,
    WorkMotherOccupation == "Auxiliaire de puéricultrice en crèche" ~ 5310,
    WorkMotherOccupation == "Ingénieur en Informatique" ~ 2150,
    WorkMotherOccupation == "Technicienne de laboratoire" ~ 3210,
    WorkMotherOccupation == "contrôleuse de gestion" ~ 2420,
    WorkMotherOccupation == "Travaillait au restaurant : serveuse et cuisinière" ~ 9410,
    WorkMotherOccupation == "Protesiste ongulaires" ~ 5140,
    WorkMotherOccupation == "Directrice des Opérations - Immobilier - Cadre" ~ 1210,
    WorkMotherOccupation == "Assistante à la petite enfance en crèche" ~ 5310,
    WorkMotherOccupation == "Machiniste" ~ 7230,
    WorkMotherOccupation == "Enseignante en maternelle" ~ 2340,
    WorkMotherOccupation == "Gestionnaire RH" ~ 3330,
    WorkMotherOccupation == "Gestionnaire de paye" ~ 3330,
    WorkMotherOccupation == "Auxiliaire de périculture" ~ 5310,
    WorkMotherOccupation == "researcher" ~ 2310,
    WorkMotherOccupation == "technicien dans les assurances" ~ 3320,
    WorkMotherOccupation == "Agent administratif à la CPAM de Paris" ~ 3350,
    WorkMotherOccupation == "Technicienne de laboratoire en hôpital" ~ 3210,
    WorkMotherOccupation == "Contrôleur de gestion sociale" ~ 2420,
    WorkMotherOccupation == "gardienne d'immeuble" ~ 5150,
    WorkMotherOccupation == "Auxiliaire de vie ; aide soignant" ~ 5320,
    WorkMotherOccupation == "Responsable commerciale dans la finance" ~ 2430,
    WorkMotherOccupation == "Factrice" ~ 9620,
    WorkMotherOccupation == "Consultante en urbanisme" ~ 2160,
    WorkMotherOccupation == "Serveuse Restauration" ~ 5130,
    WorkMotherOccupation == "Ingénieure-agronome" ~ 2130,
    WorkMotherOccupation == "Monteuse vidéo dans l'audiovisuel" ~ 3520,
    WorkMotherOccupation == "Maitre de conférence" ~ 2310,
    WorkMotherOccupation == "Conductrice de bus" ~ 8330,
    WorkMotherOccupation == "Accompagnante d'élèves en situation de handicap" ~ 5310,
    WorkMotherOccupation == "Agent Spécialisé de Ecoles Maternelles" ~ 5310,
    WorkMotherOccupation == "Vendeuse à la caisse" ~ 5230,
    WorkMotherOccupation == "Annimatrice à l'école" ~ 5310,
    WorkMotherOccupation == "Cheffe Monteuse de vidéo" ~ 3520,
    WorkMotherOccupation == "Gestionnaire bancaire" ~ 3310,
    WorkMotherOccupation == "employée de poste" ~ 9620,
    WorkMotherOccupation == "secrétaire administrative RH" ~ 3330,
    WorkMotherOccupation == "Notaire" ~ 3410,
    WorkMotherOccupation == "Assistante audioprothésiste" ~ 3250,
    WorkMotherOccupation == "Médecin généraliste" ~ 2210,
    WorkMotherOccupation == "Auxiliaire de vie, aide à la personne handicapée" ~ 5320,
    WorkMotherOccupation == "Médecin-biologiste" ~ 2210,
    WorkMotherOccupation == "Chef de projet RH" ~ 2420,
    WorkMotherOccupation == "Agent petite enfance" ~ 5310,
    WorkMotherOccupation == "greffière" ~ 3410,
    WorkMotherOccupation == "travailleuse social" ~ 3410,
    WorkMotherOccupation == "Architecte d'intérieur" ~ 3430,
    WorkMotherOccupation == "Agent de laboratoire" ~ 3210,
    WorkMotherOccupation == "responsable boutique" ~ 5220,
    WorkMotherOccupation == "Directrice d'un centre médical" ~ 1340,
    WorkMotherOccupation == "traductrice" ~ 2640,
    WorkMotherOccupation == "pâtissière" ~ 7510,
    WorkMotherOccupation == "Monitrice éducatrice auprès d'enfants TSA" ~ 5310,
    WorkMotherOccupation == "Médecin ophtalmologue" ~ 2210,
    WorkMotherOccupation == "aide laboratoire" ~ 3210,
    WorkMotherOccupation == "Lingère auprès de personnes handicapées" ~ 5320,
    WorkMotherOccupation == "gérante d'un restaurant" ~ 1410,
    WorkMotherOccupation == "Directrice d'étude marketing" ~ 1220,
    WorkMotherOccupation == "Profession : agent polyvalent avec les personnes handicapées dans une MAS. Voudrait se reconvertir peut-être en assistante maternelle ou comptabilité." ~ 5320,
    WorkMotherOccupation == "service restauration cantine" ~ 9410,
    WorkMotherOccupation == "directrice artistique" ~ 2650,
    WorkMotherOccupation == "Webdesigner" ~ 2510,
    WorkMotherOccupation == "S4occupait des personnes âgées (manger, courses) mais là veut faire formation pour assistante maternelle ou autre chose" ~ 5320,
    WorkMotherOccupation == "Psychomotricienne" ~ 3250,
    WorkMotherOccupation == "gestionnaire clientèle dans une banque" ~ 3310,
    WorkMotherOccupation == "Cheffe d'entreprise (conseil et audit)" ~ 1120,
    WorkMotherOccupation == "Assistant de direction" ~ 3340,
    WorkMotherOccupation == "Agent de la voie publique" ~ 9310,
    WorkMotherOccupation == "Conseillère de vente ( ne va pas reprendre le travail, mais plutôt une formation)" ~ 5220,
    WorkMotherOccupation == "directrice stratégie dans une entreprise dans le domaine de la musique" ~ 1220,
    WorkMotherOccupation == "Etudiante en bio-informatique" ~ 9700,
    WorkMotherOccupation == "Conseillère relation clientèle" ~ 2430,
    WorkMotherOccupation == "Etudiante linguistique" ~ 9700,
    WorkMotherOccupation == "Ingénieure qualité dans l'agro alimentaire" ~ 2140,
    WorkMotherOccupation == "Employée dans un magasin" ~ 5220,
    WorkMotherOccupation == "hôtesse de caisse" ~ 5230,
    WorkMotherOccupation == "Chef de produit dans le marketing" ~ 2430,
    WorkMotherOccupation == "Intérimaire, agent d'accueil social" ~ 4220,
    WorkMotherOccupation == "Gestionnaire en assurance" ~ 3320,
    WorkMotherOccupation == "Responsable service restauration" ~ 5130,
    WorkMotherOccupation == "Technicienne de prestation à la CPAM" ~ 3350,
    WorkMotherOccupation == "Animatrice en centre de loisirs" ~ 5310,
    WorkMotherOccupation == "Assistante commerciale" ~ 3330,
    WorkMotherOccupation == "Animatrice d'ateliers culturelles périscolaire (auto entrepreneuse)" ~ 5310,
    WorkMotherOccupation == "secrétaire de production dans le cinéma" ~ 3340,
    WorkMotherOccupation == "Comptable" ~ 4310,
    WorkMotherOccupation == "comptable" ~ 4310,
    WorkMotherOccupation == "Community manager" ~ 4220,
    WorkMotherOccupation == "Assistante comptable" ~ 4310,
    WorkMotherOccupation == "Agent technique dans les collèges" ~ 9110,
    WorkMotherOccupation == "Directrice du développement immobilier" ~ 1340,
    WorkMotherOccupation == "Chargé d'investissement dans l'immobilier" ~ 3320,
    WorkMotherOccupation == "Cadre administratif" ~ 1210,
    WorkMotherOccupation == "Assistante Ressources Humaines" ~ 3330,
    WorkMotherOccupation == "Manager en recrutement" ~ 3330,
    WorkMotherOccupation == "Secrétaire comptable" ~ 3340,
    WorkMotherOccupation == "Assistante éducatrice pour enfant TSA" ~ 5310,
    WorkMotherOccupation == "agent de restauration" ~ 5120,
    WorkMotherOccupation == "médiation de conflit" ~ 2630,
    WorkMotherOccupation == "Chef de produit marketing dans l'alimentaire" ~ 2430,
    WorkMotherOccupation == "Archiviste à l'hôpital" ~ 4410,
    WorkMotherOccupation == "Ingénieure bâtiment" ~ 2140,
    WorkMotherOccupation == "Business developper international" ~ 1210,
    WorkMotherOccupation == "Documentaliste audiovisuelle" ~ 2620,
    WorkMotherOccupation == "Ingénieur contrôle qualité" ~ 2140,
    WorkMotherOccupation == "Agent de restauration (Intérimaire)" ~ 5120,
    WorkMotherOccupation == "Vacataire à la ville de Paris, accueil, gardienne" ~ 4220,
    WorkMotherOccupation == "cheffe de produit" ~ 2430,
    WorkMotherOccupation == "Régisseur d'oeuvre (monter des expositions)" ~ 2650,
    WorkMotherOccupation == "Grande distribution ( ne donne pas de détails)" ~ 9330,
    WorkMotherOccupation == "Responsable marketing abonnement dans un groupe de presse écrite" ~ 2430,
    WorkMotherOccupation == "Chef caisse" ~ 5230,
    WorkMotherOccupation == "Agent territorial des écoles" ~ 9110,
    WorkMotherOccupation == "Livreuse ubereat" ~ 9620,
    WorkMotherOccupation == "Informaticienne" ~ 2150,
    WorkMotherOccupation == "Cadre dans le domaine de la banque" ~ 1340,
    WorkMotherOccupation == "équipière en restauration" ~ 9410,
    WorkMotherOccupation == "Responsable de boutique" ~ 5220,
    WorkMotherOccupation == "Gestionnaire de paie" ~ 4310,
    WorkMotherOccupation == "Alternante / Éducateur sportif" ~ 3420,
    WorkMotherOccupation == "cadre financier" ~ 1210,
    WorkMotherOccupation == "Agent administratif" ~ 4110,
    WorkMotherOccupation == "Gérante d'entreprise" ~ 1120,
    WorkMotherOccupation == "employée de restauration" ~ 9410,
    WorkMotherOccupation == "Clair de notaire" ~ 3410,
    WorkMotherOccupation == "Responsable relation client" ~ 2430,
    WorkMotherOccupation == "Cadre de santé, à la base infirmière" ~ 2220,
    WorkMotherOccupation == "Traductrice (en algérie)" ~ 2640,
    WorkMotherOccupation == "Directrice générale d'un hôtel" ~ 1410,
    WorkMotherOccupation == "Agent commercial (contrôleur) à la SNCF" ~ 3330,
    WorkMotherOccupation == "responsable communication" ~ 2430,
    WorkMotherOccupation == "Cadre manageuse dans l'industrie pharmaceutique" ~ 1340,
    WorkMotherOccupation == "service de bureau à la banque" ~ 4110,
    WorkMotherOccupation == "agent municipal" ~ 9110,
    WorkMotherOccupation == "Conseillère de beauté" ~ 5140,
    WorkMotherOccupation == "Cheffe d'entreprise directrice artistique d'une marque de vêtement" ~ 2160,
    WorkMotherOccupation == "Directrice de clientèle en agence de publicité" ~ 1220,
    WorkMotherOccupation == "Chargé de recrutement" ~ 3330,
    WorkMotherOccupation == "Responsable de recherche clinique" ~ 2130,
    WorkMotherOccupation == "responsable administrative" ~ 3340,
    WorkMotherOccupation == "Assistante en laboratoire dentaire" ~ 3250,
    WorkMotherOccupation == "Directrice financière" ~ 1210,
    WorkMotherOccupation == "Chargé de relations banquaires" ~ 2410,
    WorkMotherOccupation == "Agent à la CAF" ~ 3350,
    WorkMotherOccupation == "Responsable en marketing numérique" ~ 2430,
    WorkMotherOccupation == "Educatrice chien d'aveugle" ~ 5160,
    WorkMotherOccupation == "Equipière polyvalente Liddl" ~ 9330,
    WorkMotherOccupation == "Responsable social media et influence" ~ 2430,
    WorkMotherOccupation == "CPE collège" ~ 1340,
    WorkMotherOccupation == "Régulatrice aérienne" ~ 3150,
    WorkMotherOccupation == "Gestionnaire administrative" ~ 4110,
    WorkMotherOccupation == "ATSEM" ~ 5310,
    WorkMotherOccupation == "directrice de casting" ~ 2650,
    WorkMotherOccupation == "Cheffe d'entreprise" ~ 1120,
    WorkMotherOccupation == "Gestionnaire de risques dans une compagnie d'assurance" ~ 3320,
    WorkMotherOccupation == "Travailler au commissariat" ~ 5410,
    WorkMotherOccupation == "Caissière principale auchant" ~ 5230,
    WorkMotherOccupation == "chef de projet dans le  ferroviaire" ~ 2160,
    WorkMotherOccupation == "agent de sécurité incendie" ~ 5410,
    WorkMotherOccupation == "cheffe de projet innovation" ~ 2430,
    WorkMotherOccupation == "Accueil événementiel" ~ 4220,
    WorkMotherOccupation == "Support dans les hôtels" ~ 9110,
    WorkMotherOccupation == "gestionnaire qualité" ~ 2140,
    WorkMotherOccupation == "Téléconseillère" ~ 4220,
    WorkMotherOccupation == "responsable marketing et digital" ~ 2430,
    WorkMotherOccupation == "Commerciale avant vente dans la tech" ~ 2430,
    WorkMotherOccupation == "Auto-entrepreneur : ingénieure pédagogique" ~ 2510,
    WorkMotherOccupation == "Traductrice / Hôtelière (en Crète) mais du coup ne s'occupe plus trop de cette activité" ~ 2640,
    WorkMotherOccupation == "Inspectrice des finances publiques" ~ 3350,
    WorkMotherOccupation == "Adjointe dans un département de médiation (Ministère des armées)" ~ 2620,
    WorkMotherOccupation == "Responsable de projet à la RATP" ~ 2160,
    WorkMotherOccupation == "opératrice colis" ~ 9620,
    WorkMotherOccupation == "gestionnaire de flotte" ~ 4320,
    WorkMotherOccupation == "Account manager" ~ 3320,
    WorkMotherOccupation == "Assistante de gestion en interim" ~ 4110,
    WorkMotherOccupation == "agent administrative" ~ 4110,
    WorkMotherOccupation == "Agente administratif" ~ 4110,
    WorkMotherOccupation == "Cheffe de projet en recherche" ~ 3210,
    WorkMotherOccupation == "Analyste pour le ministère des armées" ~ 2420,
    WorkMotherOccupation == "attachée commerciale" ~ 3320,
    WorkMotherOccupation == "Gestionnaire d'importation" ~ 2430,
    WorkMotherOccupation == "Testeur logiciel informatique" ~ 3510,
    WorkMotherOccupation == "Service après-vente dans un centre commercial" ~ 4220,
    WorkMotherOccupation == "Agent d'accueil immobilier" ~ 4220,
    WorkMotherOccupation == "préparatrice de commande" ~ 9620,
    WorkMotherOccupation == "Chargée de mission clause sociale (dans une collectivité territoriale)" ~ 2420,
    WorkMotherOccupation == "Conseillère commerciale" ~ 3320,
    WorkMotherOccupation == "Régulation de bus" ~ 5110,
    WorkMotherOccupation == "Conseillère de vente puis Préparatrice de commande" ~ 5220,
    WorkMotherOccupation == "Agent d'animation (à la mairie )" ~ 5310,
    WorkMotherOccupation == "Agent de créatif freelance" ~ 2420,
    WorkMotherOccupation == "Organisatrice de congrès médicaux" ~ 3330,
    WorkMotherOccupation == "Coordinatrice de soin dans un centre dentaire" ~ 3340,
    WorkMotherOccupation == "Ell était en formation de ménage" ~ 9700,
    WorkMotherOccupation == "aimerait formation esthétique dès que possible" ~ 9700,
    WorkMotherOccupation == "Ras" ~ 9700,
    WorkMotherOccupation == "CAP hôtellerie-restauration : serveuse / A travaillé aussi dans la manutention" ~ 9700,
    WorkMotherOccupation == "pas de travail" ~ 9700,
    WorkMotherOccupation == "Etudiante en marketing au Mali a dû interrompre ses études" ~ 9700,
    WorkMotherOccupation == "Formation petite enfance (n'a pas travaillé avant)" ~ 9700,
    WorkMotherOccupation == "Master 2 management ressources humaines" ~ 9700,
    WorkMotherOccupation == "Etudiante à domicile dans le social" ~ 9700,
    WorkMotherOccupation == "En formation d'auxiliaire de puériculture" ~ 9700,
    WorkMotherOccupation == "Etudiante : aimerait faire formation auxiliaire puéricultrice." ~ 9700,
    WorkMotherOccupation == "Ancienne profession : secrétaire médicale. Va faire une formation de trois mois pour travailler dans le transport de marchandise." ~ 3340,
    WorkMotherOccupation == "Auxiliaire puéricultrice en formation" ~ 9700,
    WorkMotherOccupation == "Etudiante économie gestion" ~ 9700,
    WorkMotherOccupation == "Ingénieure informatique en formation pour devenir cheffe de projet." ~ 9700,
    WorkMotherOccupation == "pas de travail avant la grossesse" ~ 9700,
    WorkMotherOccupation == "Précédemment hôtesse de caisse mais compte devenir animatrice scolaire lors de sa reprise" ~ 5230,
    WorkMotherOccupation == "Ancienne responsable marketing dans le digitale. Attend de trouver une alternance pour commencer au plus vite une formation master en marketing" ~ 9700,
    WorkMotherOccupation == "Assistante commerciale quand était en Algérie / a aussi travaillé comme vendeuse" ~ 5220,
    WorkMotherOccupation == "Etudiante formation Assistante maternelle" ~ 9700,
    WorkMotherOccupation == "Reprendre une formation en janvier : formation création d'entreprise en cycle doctoral. Il lui reste deux ans.  Avant congé maternité : était étudiante." ~ 9700,
    WorkMotherOccupation == "n'a jamais travaillé ni étudié" ~ 9700,
    WorkMotherOccupation == "Etudiante ressources humaines et finances" ~ 9700,
    WorkMotherOccupation == "Etait boulangère. En formation pour devenir enseignante de langue arabe." ~ 7510,
    WorkMotherOccupation == "sans activité professionelle" ~ 9700,
    WorkMotherOccupation == "Ni études, ni emploi" ~ 9700,
    WorkMotherOccupation == "Etudiante en finance comptabilité" ~ 9700,
    WorkMotherOccupation == "apprenti aide-soignante" ~ 9700,
    WorkMotherOccupation == "Sans activité" ~ 9700,
    WorkMotherOccupation == "Tout ce qu'on peut lui proposer" ~ 9700,
    WorkMotherOccupation == "Travaillait en tant que chargée de clientèle au téléphone chez un fournisseur opticien. Veut se reconvertir dans le massage à domicile." ~ 4220,
    WorkMotherOccupation == "N'a encore jamais travaillé (veut faire une formation dans la petite enfance avant)" ~ 9700,
    WorkMotherOccupation == "Etudiante alternante analyste risque crédit" ~ 9700,
    WorkMotherOccupation == "formation d'intégration" ~ 9700,
    WorkMotherOccupation == "Serbie : professeur de géographie. Doit traduire ses diplômes. Et a travaillé en faisant des ménages." ~ 9110,
    WorkMotherOccupation == "Eudiante" ~ 9700,
    WorkMotherOccupation == "Souhaite se former comme aide soignante" ~ 9700,
    WorkMotherOccupation == "cadre informatique" ~ 1330,
    WorkMotherOccupation == "Responsable assistante 3250" ~ 4220,
    WorkMotherOccupation == "directrice adjointe boutique" ~ 5220,
    WorkMotherOccupation == "N'a jamais travaillé" ~ 9700,
    WorkMotherOccupation == "Jamais travaillé" ~ 9700,
    WorkMotherOccupation == "Cheffe de projet logistique" ~ 2420,
    WorkMotherOccupation == "Assistante copropriété ( immobilier)" ~ 5150,
    WorkMotherOccupation == "Fonctionnaire administrative dans une ville" ~ 4110,
    WorkMotherOccupation == "Responsable assistante dentaire" ~ 3250,
    WorkMotherOccupation == "Chef d'équipe en restauration" ~ 5130,
    WorkMotherOccupation == "Cheffe de produit dans le textile" ~ 2160,
    WorkMotherOccupation == "Secrétaire en service après vente" ~ 4220,
    WorkMotherOccupation == "Assistante de direction" ~ 3340,
    WorkMotherOccupation == "confection - contrôle fabrication objet" ~ 3130,
    WorkMotherOccupation == "Assistante administrative et comptable" ~ 3340,
    WorkMotherOccupation == "technico-commerciale" ~ 3320,
    WorkMotherOccupation == "Chargée de recouvrement" ~ 3350,
    WorkMotherOccupation == "restauration" ~ 5130,
    WorkMotherOccupation == "Chargée de mission dans une association" ~ 3410,
    WorkMotherOccupation == "gestionnaire dans mutuelle" ~ 3320,
    WorkMotherOccupation == "Ingénieur de recherche dans la finance de la recherche" ~ 2310,
    WorkMotherOccupation == "Chargée de référentiel en finance" ~ 3310,
    WorkMotherOccupation == "commerciale territoriale" ~ 3320,
    WorkMotherOccupation == "chef de projet en informatique" ~ 2510,
    WorkMotherOccupation == "Assistante de vie aux familles" ~ 5320,
    WorkMotherOccupation == "Shop manager" ~ 5220,
    WorkMotherOccupation == "Préparatrice de commande" ~ 9620,
    WorkMotherOccupation == "Caissière (de nuit)" ~ 5230,
    WorkMotherOccupation == "Chargé de mission de l'aménagement de lieux d'accueil associatif" ~ 3410,
    WorkMotherOccupation == "Réalisatrice des émissions de radio" ~ 2650,
    WorkMotherOccupation == "Secrétaire administratif à la PHP" ~ 3340,
    WorkMotherOccupation == "Directrice de travaux dans le BTP" ~ 2140,
    WorkMotherOccupation == "Agent SNCF" ~ 5110,
    WorkMotherOccupation == "Agent d'entretien dans une école" ~ 9110,
    WorkMotherOccupation == "Manager marketing" ~ 1220,
    WorkMotherOccupation == "Agente service hospitalier" ~ 9110,
    WorkMotherOccupation == "Chef de clinique en pédiatrie" ~ 2210,
    WorkMotherOccupation == "responsable adjointe en vente" ~ 5220,
    WorkMotherOccupation == "opératrice de saisie" ~ 4130,
    WorkMotherOccupation == "Administrateur de bien dans l'immobilier" ~ 3330,
    WorkMotherOccupation == "Employée polyvalente commande et sav" ~ 4220,
    WorkMotherOccupation == "Responsable boulangerie" ~ 1410,
    WorkMotherOccupation == "Directrice en banque" ~ 1340,
    WorkMotherOccupation == "Assistante responsable de rayon" ~ 5220,
    WorkMotherOccupation == "Comptable (à l'étranger)" ~ 4310,
    WorkMotherOccupation == "Chargée de gestion locative" ~ 3330,
    WorkMotherOccupation == "chargée de mission dans les relations internationales" ~ 2610,
    WorkMotherOccupation == "Assistante dans un service social" ~ 3410,
    WorkMotherOccupation == "banque (en Tunisie)" ~ 3310,
    WorkMotherOccupation == "agent comptable" ~ 4310,
    WorkMotherOccupation == "vendeuse en prêt-à-porter" ~ 5220,
    WorkMotherOccupation == "Fonctionnaire territoriale - référente administrative pour les crèches de Vitry-sur-Seine" ~ 2630,
    WorkMotherOccupation == "surveillante à l'école" ~ 5310,
    WorkMotherOccupation == "Agent RATP" ~ 5110,
    WorkMotherOccupation == "cadre supérieure dans la fonction publique / économie et finances" ~ 1110,
    WorkMotherOccupation == "Agent de production SNCF" ~ 9330,
    WorkMotherOccupation == "Technicienne de surface (ménage)" ~ 9110,
    WorkMotherOccupation == "Agent de sécurité incendie" ~ 5410,
    WorkMotherOccupation == "Développeuse de jeux vidéo, informatique" ~ 2510,
    WorkMotherOccupation == "Accompagnement éducatif de personnes en difficulté sociale" ~ 5310,
    WorkMotherOccupation == "Agent textile" ~ 7310,
    WorkMotherOccupation == "Acheteuse dans la grande distribution" ~ 3320,
    WorkMotherOccupation == "Conseillère clientèle à la banque" ~ 3310,
    WorkMotherOccupation == "chef de gare - RATP" ~ 5110,
    WorkMotherOccupation == "infirmière responsable adjointe d'une crèche" ~ 1340,
    WorkMotherOccupation == "Clerc de notaire" ~ 3410,
    WorkMotherOccupation == "Conseillère de vente pour le luxe" ~ 5220,
    WorkMotherOccupation == "Commerciale chez orange" ~ 5220,
    WorkMotherOccupation == "Conseillère en management" ~ 2420,
    WorkMotherOccupation == "Assistante médico-administrative en psychiatrie" ~ 3340,
    WorkMotherOccupation == "responsable boutique dans la restauration" ~ 5220,
    WorkMotherOccupation == "Conseillère informatique" ~ 2520,
    WorkMotherOccupation == "Préparatrice de commandes" ~ 9620,
    WorkMotherOccupation == "cadre de santé" ~ 1340,
    WorkMotherOccupation == "Conseillère financière" ~ 3310,
    WorkMotherOccupation == "conseillère service client" ~ 3310,
    WorkMotherOccupation == "cheffe de produit digital" ~ 2430,
    WorkMotherOccupation == "Rédaction web" ~ 2640,
    WorkMotherOccupation == "conseillère en image" ~ 2430,
    WorkMotherOccupation == "Responsable grands comptes" ~ 2410,
    WorkMotherOccupation == "Auto-entrepreneuse conception dans le textile, sac à main et bijoux" ~ 2160,
    WorkMotherOccupation == "Assistante particulière au ministère des affaires étrangères" ~ 3340,
    WorkMotherOccupation == "Rédactrice web" ~ 2640,
    WorkMotherOccupation == "Assistante Logistique" ~ 4320,
    WorkMotherOccupation == "gestionnaire" ~ 4310,
    WorkMotherOccupation == "Responsable d'opérations en centre de formations" ~ 2420,
    WorkMotherOccupation == "Référente des parcours professionnel spécifique des personnes placées sous main de justice" ~ 2610,
    WorkMotherOccupation == "Conseillère référente auprès de l'assurance Maladie" ~ 3350,
    WorkMotherOccupation == "Médiatrice sociale dans RER" ~ 5110,
    WorkMotherOccupation == "Gestionnaire back-office" ~ 3310,
    WorkMotherOccupation == "Assistante de gestion" ~ 4310,
    WorkMotherOccupation == "Commerciale dans la mode" ~ 3320,
    WorkMotherOccupation == "Chargée de formation dans le secteur public" ~ 2420,
    WorkMotherOccupation == "Chef de produit" ~ 2430,
    WorkMotherOccupation == "Acheteuse dans le bâtiment" ~ 3320,
    WorkMotherOccupation == "Gestionnaire sinistre automobile" ~ 3320,
    WorkMotherOccupation == "Agent GTB (gestion technique des bâtiments)" ~ 7120,
    WorkMotherOccupation == "Responsable de promotion" ~ 3330,
    WorkMotherOccupation == "Agent d'administration" ~ 4110,
    WorkMotherOccupation == "Assistante, gestionnaire administrative dans le bâtiment" ~ 4310,
    WorkMotherOccupation == "Assistante qualité en restauration collective" ~ 3130,
    WorkMotherOccupation == "agent commercial dans les assurances" ~ 3320,
    WorkMotherOccupation == "Coordinatrice de l'administration des ventes" ~ 3320,
    WorkMotherOccupation == "Gestionnaire administrative automobile" ~ 4110,
    WorkMotherOccupation == "Animateur agent-mobile" ~ 5110,
    WorkMotherOccupation == "Chargée d'accueil" ~ 4220,
    WorkMotherOccupation == "Agent administratif dans un hôpital" ~ 4110,
    WorkMotherOccupation == "Responsable commercial dans les énergies renouvelables" ~ 3320,
    WorkMotherOccupation == "Assistante administrative et technique" ~ 4110,
    WorkMotherOccupation == "Gestionnaire évenementiel" ~ 3330,
    WorkMotherOccupation == "Chargée de formation (va devenir formatrice indépendante)" ~ 2420,
    WorkMotherOccupation == "Responsable marketing" ~ 1220,
    WorkMotherOccupation == "Secrétaire dans le BTP" ~ 4120,
    WorkMotherOccupation == "Responsable de plaidoyer pour une association" ~ 2610,
    WorkMotherOccupation == "Directrice de création digital dans un groupe médias" ~ 2430,
    WorkMotherOccupation == "Senior manager dans un cabinet de conseil" ~ 2410,
    WorkMotherOccupation == "Acheteuse en mode mais monte sa société (depot vente pour enfant) actuellement" ~ 3320,
    WorkMotherOccupation == "Adjointe administrative, gestionnaire budgétaire et logistique" ~ 4110,
    WorkMotherOccupation == "Secrétaire dans une société d'impression" ~ 4120,
    WorkMotherOccupation == "Agente administrative" ~ 4110,
    WorkMotherOccupation == "Directrice adjointe restauration" ~ 1440,
    WorkMotherOccupation == "Commerçante" ~ 5220,
    WorkMotherOccupation == "Chargée de mission en événementiel" ~ 3330,
    WorkMotherOccupation == "Conseillère commerciale dans le bâtiment" ~ 3320,
    WorkMotherOccupation == "Relation investisseur dans une boîte d'investissement en biotechnologie" ~ 2430,
    WorkMotherOccupation == "chef de secteur dans une entreprise d'entretien" ~ 9110,
    WorkMotherOccupation == "Modératrice réseau social" ~ 2430,
    WorkMotherOccupation == "Assistante de mandataire judiciaire pour les majeurs" ~ 3410,
    WorkMotherOccupation == "a déjà travailler en crèche (ne dit pas exactement)" ~ 5310,
    WorkMotherOccupation == "commerciale dans évènementiel (traiteur)" ~ 3320,
    WorkMotherOccupation == "Responsable installation" ~ 4110,
    WorkMotherOccupation == "travaillais dans les textiles" ~ 7310,
    WorkMotherOccupation == "Worked in customer services" ~ 4220,
    WorkMotherOccupation == "Salariée dans la restauration" ~ 5130,
    WorkMotherOccupation == "gestionnaire conseil" ~ 4310,
    WorkMotherOccupation == "chargée de production audiovisuelle" ~ 2640,
    WorkMotherOccupation == "coordinatrice pour une association" ~ 3410,
    WorkMotherOccupation == "Salariée dans l'hotellerie" ~ 4220,
    WorkMotherOccupation == "patronne dans la restauration" ~ 1410,
    WorkMotherOccupation == "Administratif système et réseau informatique" ~ 2520,
    WorkMotherOccupation == "Agent de restauration" ~ 5120,
    WorkMotherOccupation == "Déléguée pharmaceutique" ~ 3210,
    WorkMotherOccupation == "Déléguée à la protection des données" ~ 2520,
    WorkMotherOccupation == "gestionnaire de projet" ~ 3340,
    WorkMotherOccupation == "Marketing et vente" ~ 2430,
    WorkMotherOccupation == "Cheffe de projet digitale" ~ 2510,
    WorkMotherOccupation == "Assistante technique dans un centre de formation" ~ 4110,
    WorkMotherOccupation == "cheffe de mission dans un cabinet d'expertise comptable" ~ 2410,
    WorkMotherOccupation == "L'audite ?" ~ 2410,
    WorkMotherOccupation == "salariée dans un commerce" ~ 5220,
    WorkMotherOccupation == "Manager" ~ 3340,
    WorkMotherOccupation == "Responsable de salle en restauration" ~ 5130,
    WorkMotherOccupation == "Assistant manager dans la vente" ~ 3340,
    WorkMotherOccupation == "Agent hospitalier" ~ 5320,
    WorkMotherOccupation == "chargée de développement" ~ 2430,
    WorkMotherOccupation == "Gestionnaire de back office en banque" ~ 3310,
    WorkMotherOccupation == "assistante / accueil administratif" ~ 4220,
    WorkMotherOccupation == "Cheffe de produit" ~ 2430,
    WorkMotherOccupation == "Aide-soignante à domicile" ~ 5320,
    WorkMotherOccupation == "Coordinatrice au SAMU social de Paris" ~ 3340,
    WorkMotherOccupation == "gouvernante générale en hôtellerie" ~ 5150,
    WorkMotherOccupation == "Cheffe de projet" ~ 2420,
    WorkMotherOccupation == "Cheffe de projet dans le milieu associatif" ~ 2420,
    WorkMotherOccupation == "Responsable d'un département éthique et audit interne" ~ 2420,
    WorkMotherOccupation == "Agent magasin" ~ 5220,
    WorkMotherOccupation == "Directrice de boutique chez Orange" ~ 5220,
    WorkMotherOccupation == "Commerciale dans le BTP" ~ 3320,
    WorkMotherOccupation == "Manager dans un cabinet de recrutement" ~ 3340,
    WorkMotherOccupation == "Monitrice en ESAT (association pour insertion des personnes handicapés)" ~ 5320,
    WorkMotherOccupation == "Contrôleur interne" ~ 2410,
    WorkMotherOccupation == "Consultante en développement durable" ~ 2130,
    WorkMotherOccupation == "Responsable d'une équipe / cheffe de projet" ~ 2420,
    WorkMotherOccupation == "Restauratrice du patrimoine" ~ 2620,
    WorkMotherOccupation == "Ingénieure (pas en france)" ~ 2140,
    WorkMotherOccupation == "Assistante manager" ~ 3340,
    WorkMotherOccupation == "employée en hôtellerie" ~ 4220,
    WorkMotherOccupation == "Animatrice + accompagnante des enfants porteurs d'handicap" ~ 5320,
    WorkMotherOccupation == "Gestionnaire paie et administration du personnel" ~ 3330,
    WorkMotherOccupation == "auto-entrepreneur société de nettoyage" ~ 5150,
    WorkMotherOccupation == "Consultante en management / gestion de projet" ~ 2420,
    WorkMotherOccupation == "agent administratif" ~ 4110,
    WorkMotherOccupation == "Contrôleur budgétaire" ~ 4310,
    WorkMotherOccupation == "assistante manager en restauration" ~ 3340,
    WorkMotherOccupation == "Agent restauration (en Espagne pas en France)" ~ 9410,
    WorkMotherOccupation == "Social manager (indépendante)" ~ 2430,
    WorkMotherOccupation == "Ingénieure commercial" ~ 2430,
    WorkMotherOccupation == "Directrice éditoriale d'une entreprise dans le digital" ~ 2430,
    WorkMotherOccupation == "Consultante en cyber sécurité" ~ 2520,
    WorkMotherOccupation == "Technicienne des risques professionnels à la sécurité sociale" ~ 3330,
    WorkMotherOccupation == "Gestionnaire pac office dans une banque" ~ 3310,
    WorkMotherOccupation == "Acheteuse d'espace publicitaire" ~ 3320,
    WorkMotherOccupation == "Chargée de mission développement durable et handicap CNAM" ~ 2420,
    WorkMotherOccupation == "Agente hospitalière" ~ 5320,
    WorkMotherOccupation == "Responsable de projet" ~ 2420,
    WorkMotherOccupation == "Responsable administrative" ~ 2420,
    WorkMotherOccupation == "Référente métier dans une agence Pôle Emploi" ~ 3410,
    WorkMotherOccupation == "Responsable des prévisions de ventes pour Hérmes" ~ 2430,
    WorkMotherOccupation == "responsable éducative ville à la ville de Paris  / Directrice de centre de loisir (périscolaire)" ~ 1340,
    WorkMotherOccupation == "Responsable sécurité dans l'aéronautique" ~ 3150,
    WorkMotherOccupation == "Employé polyvalente dans un pressing" ~ 9120,
    WorkMotherOccupation == "Adjointe gouvernante générale dans l'hôtellerie de luxe" ~ 5150,
    WorkMotherOccupation == "Aide soignante militaire ( actuellement en vacances jusqu'à la fin du contrat puis va passer le concours des infermières)" ~ 5320,
    WorkMotherOccupation == "Gestionnaire du contentieux contraventionnel" ~ 3340,
    WorkMotherOccupation == "chef d'entreprise" ~ 1430,
    WorkMotherOccupation == "Agent service généraux" ~ 9110,
    WorkMotherOccupation == "Agent logistique" ~ 9620,
    WorkMotherOccupation == "Office manager" ~ 3340,
    WorkMotherOccupation == "chargée d'affaire entreprises" ~ 2420,
    WorkMotherOccupation == "Directrice adjointe dans le logement" ~ 1340,
    WorkMotherOccupation == "Agent commercial" ~ 3320,
    WorkMotherOccupation == "Gestionnaire d'activité" ~ 3340,
    WorkMotherOccupation == "Chargée d'exploitation" ~ 4320,
    WorkMotherOccupation == "Responsable distribution" ~ 4320,
    WorkMotherOccupation == "Assistante de gestion locative" ~ 3330,
    WorkMotherOccupation == "Assistante chef de projet dans la recherche clinique" ~ 3340,
    WorkMotherOccupation == "attachée commercial en banque" ~ 3310,
    WorkMotherOccupation == "responsable animation commerciale" ~ 3330,
    WorkMotherOccupation == "Responsable exploitation dans le logement social (statut cadre)" ~ 2420,
    WorkMotherOccupation == "Gestionnaire à la sécurité sociale" ~ 3410,
    WorkMotherOccupation == "assistante systèmes d'informations fonction publique" ~ 3510,
    WorkMotherOccupation == "Cheffe d'équipe de réservation" ~ 3340,
    WorkMotherOccupation == "key account manager" ~ 1220,
    WorkMotherOccupation == "Chargée de formation" ~ 2420,
    WorkMotherOccupation == "Téléopératrice" ~ 4220,
    WorkMotherOccupation == "Référente opérationnelle à l'aéroport Charles-de-Gaulle" ~ 4320,
    WorkMotherOccupation == "Commerciale indépendante" ~ 3320,
    WorkMotherOccupation == "Compte clef ?" ~ 1220,
    WorkMotherOccupation == "Modeliste" ~ 2160,
    WorkMotherOccupation == "Productonome d'outils digitaux" ~ 2430,
    WorkMotherOccupation == "Consultante dans le digital" ~ 2430,
    WorkMotherOccupation == "Chargée de mission en Santé" ~ 2430,
    TRUE ~ NA_integer_
  ))

#ses_data$isco_mother <- formatC(ses_data$isco_mother, width = 4, flag = "0") #J'ai mis cette ligne de code pour garder le premier 0 des codes de la catégorie "Professions militaires" mais j'ai l'impression que ça marche sans


#Codage de l'isco du père

RCT$WorkFatherOccupation <- as.character(RCT$WorkFatherOccupation)

ses_data <- ses_data %>% 
  mutate(isco_father = case_when(
    WorkFatherOccupation == "agent de sécurité" ~ 5410,
    WorkFatherOccupation == "Technicien électricité" ~ 3110,
    WorkFatherOccupation == "Conducteur de poids lourd" ~ 8330,
    WorkFatherOccupation == "Plonge" ~ 9410,
    WorkFatherOccupation == "Agent d'entretien dans un hôtel" ~ 9110,
    WorkFatherOccupation == "sécurité" ~ 5410,
    WorkFatherOccupation == "Technicien dans un société de recyclage" ~ 3110,
    WorkFatherOccupation == "Ingénieur aéronautique" ~ 2140,
    WorkFatherOccupation == "Agent d'entretien" ~ 9110,
    WorkFatherOccupation == "Coiffeur" ~ 5140,
    WorkFatherOccupation == "chef de projet" ~ 2430,
    WorkFatherOccupation == "Ingénieur informatique" ~ 2150,
    WorkFatherOccupation == "Ingénieur" ~ 2140,
    WorkFatherOccupation == "Agent SNCF" ~ 5110,
    WorkFatherOccupation == "gérant d'entreprise dans la sonorisation" ~ 1420,
    WorkFatherOccupation == "Gendarme à la sécurité intérieure de l'Elysée" ~ 3350,
    WorkFatherOccupation == "Directeur commercial France chez Décathlon département glisse" ~ 1220,
    WorkFatherOccupation == "Réalisateur de film" ~ 2650,
    WorkFatherOccupation == "Informaticien" ~ 2520,
    WorkFatherOccupation == "Chauffeur VTC" ~ 8320,
    WorkFatherOccupation == "Responsable d'agence de location de voiture" ~ 1430,
    WorkFatherOccupation == "Responsable technique" ~ 3130,
    WorkFatherOccupation == "Enseignant" ~ 2330,
    WorkFatherOccupation == "Commerciale" ~ 2430,
    WorkFatherOccupation == "économiste" ~ 2630,
    WorkFatherOccupation == "Responsable adjoint d'un magasin de jouets pour enfants" ~ 1420,
    WorkFatherOccupation == "Agent administratif de mairie" ~ 4110,
    WorkFatherOccupation == "Gérant dans le domaine de la restauration" ~ 1410,
    WorkFatherOccupation == "Agent sécurité" ~ 5410,
    WorkFatherOccupation == "Professeur d'EPS au collège" ~ 2330,
    WorkFatherOccupation == "Garagiste" ~ 7230,
    WorkFatherOccupation == "Chef de chantier" ~ 3120,
    WorkFatherOccupation == "BTP" ~ 9310,
    WorkFatherOccupation == "Boulanger" ~ 7510,
    WorkFatherOccupation == "Electricien" ~ 7410,
    WorkFatherOccupation == "Chauffagiste" ~ 7120,
    WorkFatherOccupation == "ingénieur en informatique" ~ 2150,
    WorkFatherOccupation == "Directeur de vente dans la cosmétique pour la France" ~ 1220,
    WorkFatherOccupation == "Chef d'équipe Fedex" ~ 9620,
    WorkFatherOccupation == "Chercheur" ~ 2310,
    WorkFatherOccupation == "chargé de clientèle à la poste" ~ 4220,
    WorkFatherOccupation == "comptable" ~ 4310,
    WorkFatherOccupation == "Gérant de société" ~ 1430,
    WorkFatherOccupation == "Chargé de projet à la sncf" ~ 2140,
    WorkFatherOccupation == "Consultant" ~ 2430,
    WorkFatherOccupation == "Manager de développeur informatique" ~ 1330,
    WorkFatherOccupation == "consultant en informatique" ~ 2520,
    WorkFatherOccupation == "Chef de projet dans la banque" ~ 1340,
    WorkFatherOccupation == "Manager commercial" ~ 1220,
    WorkFatherOccupation == "Régisseur dans le cinéma" ~ 3430,
    WorkFatherOccupation == "infirmier" ~ 3220,
    WorkFatherOccupation == "intérimaire-réceptionniste" ~ 4220,
    WorkFatherOccupation == "Directeur de mission" ~ 2420,
    WorkFatherOccupation == "Peintre en bâtiment" ~ 7130,
    WorkFatherOccupation == "ingénieur informatique" ~ 2150,
    WorkFatherOccupation == "Livreur" ~ 9620,
    WorkFatherOccupation == "Commis dans un restaurant" ~ 9410,
    WorkFatherOccupation == "Cadre dirigeant société de consulting" ~ 1210,
    WorkFatherOccupation == "Responsable juridique et financier dans le cinéma" ~ 2610,
    WorkFatherOccupation == "Chef d'entreprise dans la production d'instruments de musique anciens" ~ 1120,
    WorkFatherOccupation == "informaticien" ~ 2520,
    WorkFatherOccupation == "Cuisinier restaurant Molitor" ~ 5120,
    WorkFatherOccupation == "gestionnaire patrimoine dans une banque" ~ 3310,
    WorkFatherOccupation == "agent d'escale" ~ 5110,
    WorkFatherOccupation == "Agent de sécurité incendie" ~ 5410,
    WorkFatherOccupation == "Agent d'exploitation" ~ 4320,
    WorkFatherOccupation == "Manager dans la sécurité" ~ 4410,
    WorkFatherOccupation == "Gestionnaire de logistique" ~ 4320,
    WorkFatherOccupation == "En cap" ~ 9700,
    WorkFatherOccupation == "directeur de centre de loisirs" ~ 1340,
    WorkFatherOccupation == "Cadre fianancier" ~ 1210,
    WorkFatherOccupation == "gestionnaire sinistre en assurance" ~ 3320,
    WorkFatherOccupation == "Géomètre expert" ~ 2160,
    WorkFatherOccupation == "CRS" ~ 5410,
    WorkFatherOccupation == "Technicien telecom" ~ 3520,
    WorkFatherOccupation == "Voiturier-bagagiste en hôtellerie" ~ 9620,
    WorkFatherOccupation == "Avocat" ~ 2610,
    WorkFatherOccupation == "Pâtissier" ~ 7510,
    WorkFatherOccupation == "Agent polyvalent dans la fonction publique (travaux et logistique)" ~ 9110,
    WorkFatherOccupation == "Veilleur de nuit" ~ 4220,
    WorkFatherOccupation == "Responsable logistique" ~ 4320,
    WorkFatherOccupation == "Equipier de vente" ~ 5220,
    WorkFatherOccupation == "gérant de fonds financiers" ~ 2410,
    WorkFatherOccupation == "Ingénieur en informatique" ~ 2150,
    WorkFatherOccupation == "avocat" ~ 2610,
    WorkFatherOccupation == "plombier" ~ 7120,
    WorkFatherOccupation == "Responsable logistique" ~ 4320,
    WorkFatherOccupation == "Auxiliaire ambulancier" ~ 3250,
    WorkFatherOccupation == "banquier privé" ~ 2410,
    WorkFatherOccupation == "Responsable technique (ingénieur en BTP)" ~ 2140,
    WorkFatherOccupation == "Faiseur de suchis" ~ 5120,
    WorkFatherOccupation == "restaurateur" ~ 5120,
    WorkFatherOccupation == "Comptable" ~ 4310,
    WorkFatherOccupation == "graphiste" ~ 2160,
    WorkFatherOccupation == "ingénieur des systèmes embarqués" ~ 2150,
    WorkFatherOccupation == "chargé de communication" ~ 2430,
    WorkFatherOccupation == "Travaux publics" ~ 9310,
    WorkFatherOccupation == "Journaliste" ~ 2640,
    WorkFatherOccupation == "intermitent du spectacle" ~ 2650,
    WorkFatherOccupation == "Chargé de communication et design des sites web" ~ 2430,
    WorkFatherOccupation == "Gérant de la vie associative d'une école de commerce" ~ 2430,
    WorkFatherOccupation == "Technicien à la SCNF" ~ 9310,
    WorkFatherOccupation == "Cuisinier" ~ 5120,
    WorkFatherOccupation == "Directeur Produit" ~ 1220,
    WorkFatherOccupation == "Urbaniste" ~ 2160,
    WorkFatherOccupation == "Employer en libre service en supermarché" ~ 9330,
    WorkFatherOccupation == "Interprète de conférences" ~ 2640,
    WorkFatherOccupation == "Facteur" ~ 4410,
    WorkFatherOccupation == "Ambulancier" ~ 3250,
    WorkFatherOccupation == "Officier au sein de la brigade des sapeurs pompiers de Paris" ~ 0110,
    WorkFatherOccupation == "Courtier prêt immobilier" ~ 3310,
    WorkFatherOccupation == "Agent immobilier" ~ 3330,
    WorkFatherOccupation == "conseiller environnemental dans l'immobilier" ~ 2130,
    WorkFatherOccupation == "Enseignant dans le secondaire en histoire-géo" ~ 2330,
    WorkFatherOccupation == "Serveur" ~ 5130,
    WorkFatherOccupation == "Peinture de bâtiment" ~ 7130,
    WorkFatherOccupation == "employé dans blanchisserie" ~ 7530,
    WorkFatherOccupation == "Consultant en informatique" ~ 2520,
    WorkFatherOccupation == "Architecte informatique" ~ 2510,
    WorkFatherOccupation == "maitre d'hotel dans la restauration" ~ 5130,
    WorkFatherOccupation == "Chef d'entreprise informatique" ~ 1330,
    WorkFatherOccupation == "Responsable comptable" ~ 2410,
    WorkFatherOccupation == "Chargé d'étude en telecom" ~ 3520,
    WorkFatherOccupation == "responsable marketing digital" ~ 2430,
    WorkFatherOccupation == "Technicien de maintenance industrielle à l'aéroport CDG Paris" ~ 7230,
    WorkFatherOccupation == "Responsable qualité" ~ 3130,
    WorkFatherOccupation == "Plombier"~ 7120,
    WorkFatherOccupation == "professeur d'anglais" ~ 2330,
    WorkFatherOccupation == "Cuisinier dans une crèche en intérim" ~ 5120,
    WorkFatherOccupation == "Géographe" ~ 2160,
    WorkFatherOccupation == "Chauffeur de bus" ~ 8330,
    WorkFatherOccupation == "Militaire : officier de l'armée de terre" ~ 0110,
    WorkFatherOccupation == "couvreur" ~ 7120,
    WorkFatherOccupation == "architecte d'intérieur" ~ 2160,
    WorkFatherOccupation == "Prothésiste dentaire" ~ 3210,
    WorkFatherOccupation == "Gardien d'une résidence" ~ 5150,
    WorkFatherOccupation == "Ingénieur commercial" ~ 2430,
    WorkFatherOccupation == "chef d'entreprise" ~ 1120,
    WorkFatherOccupation == "Chercheur en sciences politiques" ~ 2310,
    WorkFatherOccupation == "Auto-entrepreneur : chauffeur privé et réparateur de téléphone" ~ 8320,
    WorkFatherOccupation == "Médecin" ~ 2210,
    WorkFatherOccupation == "data scientist" ~ 2520,
    WorkFatherOccupation == "ingénieur" ~ 2140,
    WorkFatherOccupation == "Dirigeant d'une société" ~ 1120,
    WorkFatherOccupation == "Technicien fibre optique" ~ 3510,
    WorkFatherOccupation == "Banquier" ~ 2410,
    WorkFatherOccupation == "architecte" ~ 2160,
    WorkFatherOccupation == "Chef de la data" ~ 2520,
    WorkFatherOccupation == "Etudiant en théologie" ~ 9700,
    WorkFatherOccupation == "Informaticien en freelance" ~ 2520,
    WorkFatherOccupation == "Vendeur dans une boutique de vente au détail" ~ 5220,
    WorkFatherOccupation == "Auxiliaire de puériculture" ~ 5310,
    WorkFatherOccupation == "Intermittent du spectacle" ~ 2650,
    WorkFatherOccupation == "Pédiatrice" ~ 2210,
    WorkFatherOccupation == "Artiste dessinateur" ~ 2650,
    WorkFatherOccupation == "Inspecteur URSSAF" ~ 1110,
    WorkFatherOccupation == "Chef-pâtissier" ~ 7510,
    WorkFatherOccupation == "Cadre à la RATP" ~ 1110,
    WorkFatherOccupation == "Assistant au parlementaire" ~ 1110,
    WorkFatherOccupation == "Professeur" ~ 2330,
    WorkFatherOccupation == "éboueur" ~ 9610,
    WorkFatherOccupation == "interprète" ~ 2640,
    WorkFatherOccupation == "Contrôleur d'aviation" ~ 3150,
    WorkFatherOccupation == "Pompier" ~ 5410,
    WorkFatherOccupation == "Militaire" ~ 0110,
    WorkFatherOccupation == "Intermittent du spectacle : ingénieur du son" ~ 2650,
    WorkFatherOccupation == "éducateur" ~ 3410,
    WorkFatherOccupation == "Informatique" ~ 2520,
    WorkFatherOccupation == "Auto-entrepreneur : numérique" ~ 2520,
    WorkFatherOccupation == "Responsable de programmes" ~ 1320,
    WorkFatherOccupation == "Fonctionnaire : auditeur à la ville de Paris" ~ 1110,
    WorkFatherOccupation == "Cuisinier en centrale municipale" ~ 2330,
    WorkFatherOccupation == "Chef de projet en informatique" ~ 2520,
    WorkFatherOccupation == "Opérateur logistique" ~ 3130,
    WorkFatherOccupation == "Assistant marketing" ~ 3330,
    WorkFatherOccupation == "Intermittent du spectacle" ~ 2650,
    WorkFatherOccupation == "Gérant de fonds d'investissement" ~ 2410,
    WorkFatherOccupation == "Chef d'entreprise" ~ 1120,
    WorkFatherOccupation == "architecte" ~ 2160,
    WorkFatherOccupation == "Fonctionnaire de police" ~ 5410,
    WorkFatherOccupation == "Responsable maintenance" ~ 7230,
    WorkFatherOccupation == "designer" ~ 2160,
    WorkFatherOccupation == "ingénieur" ~ 2140,
    WorkFatherOccupation == "Pharmacien" ~ 2260,
    WorkFatherOccupation == "Biologiste médical (dirige un laboratoire d'analyses médicales)" ~ 2130,
    WorkFatherOccupation == "juriste" ~ 2610,
    WorkFatherOccupation == "chef d'entreprise dans l'ingénieurie de l'énergie renouvelable" ~ 1120,
    WorkFatherOccupation == "Chargé de mission (lobbying)" ~ 2410,
    WorkFatherOccupation == "Responsable qualité à Rugis" ~ 2140,
    WorkFatherOccupation == "ébeniste" ~ 7520,
    WorkFatherOccupation == "responsable marketing" ~ 1220,
    WorkFatherOccupation == "producteur de films" ~ 2650,
    WorkFatherOccupation == "Manipulateur en radiologie" ~ 3210,
    WorkFatherOccupation == "Gérant d'entreprise" ~ 1120,
    WorkFatherOccupation == "Chercheur (à Pasteur)" ~ 2310,
    WorkFatherOccupation == "Assistant en ressources humaines" ~ 3330,
    WorkFatherOccupation == "Etudiant Préparateur de commande" ~ 9700,
    WorkFatherOccupation == "Directeur des programmes immobiliers" ~ 1320,
    WorkFatherOccupation == "Fusion acquisition en finance dans le conseil" ~ 2410,
    WorkFatherOccupation == "Artisan" ~ 7310,
    WorkFatherOccupation == "Aide-soignant" ~ 5320,
    WorkFatherOccupation == "Dans l'informatique (ne sait pas dire quoi exactement)" ~ 2520,
    WorkFatherOccupation == "Chauffeur bus" ~ 8330,
    WorkFatherOccupation == "Brancardier" ~ 3250,
    WorkFatherOccupation == "Machiniste receveur (chauffeur de bus)" ~ 8330,
    WorkFatherOccupation == "Agent de sécurité" ~ 5410,
    WorkFatherOccupation == "photographe" ~ 3430,
    WorkFatherOccupation == "agent de nettoyage" ~ 9110,
    WorkFatherOccupation == "Aide domicile" ~ 5320,
    WorkFatherOccupation == "Conducteur de train" ~ 3250,
    WorkFatherOccupation == "agent d'accueil" ~ 4220,
    WorkFatherOccupation == "Chef de rang restaurant" ~ 5130,
    WorkFatherOccupation == "jardinier à la mairie" ~ 6110,
    WorkFatherOccupation == "Ingénieur informaticien" ~ 2150,
    WorkFatherOccupation == "Patissier" ~ 7510,
    WorkFatherOccupation == "intermittent du spectacle" ~ 2650,
    WorkFatherOccupation == "Agent de maintenance dans une grande entreprise" ~ 9110,
    WorkFatherOccupation == "mécanicien" ~ 7230,
    WorkFatherOccupation == "Chauffeur livreur" ~ 9620,
    WorkFatherOccupation == "Préparateur de commande" ~ 9620,
    WorkFatherOccupation == "Préparateur de Commande" ~ 9620,
    WorkFatherOccupation == "Responsable de secteur dans le nettoyage" ~ 5150,
    WorkFatherOccupation == "chef cuisinier" ~ 3430,
    WorkFatherOccupation == "Moniteur d'auto-école" ~ 5160,
    WorkFatherOccupation == "Machiniste receveur" ~ 8330,
    WorkFatherOccupation == "Chauffeur de taxi" ~ 8320,
    WorkFatherOccupation == "Bar-man" ~ 5130,
    WorkFatherOccupation == "analyste financier" ~ 2410,
    WorkFatherOccupation == "Responsable de caisse dans la restauration" ~ 5230,
    WorkFatherOccupation == "cuisinier" ~ 5120,
    WorkFatherOccupation == "Cariste" ~ 8340,
    WorkFatherOccupation == "Vendeur" ~ 5220,
    WorkFatherOccupation == "Animateur sportif dans les écoles" ~ 3420,
    WorkFatherOccupation == "Chauffeur taxi" ~ 8320,
    WorkFatherOccupation == "Comptabilité" ~ 4310,
    WorkFatherOccupation == "agent de pilotage" ~ 3150,
    WorkFatherOccupation == "VTC" ~ 8320,
    WorkFatherOccupation == "Responsable de contrôle qualité" ~ 3130,
    WorkFatherOccupation == "Gendarme" ~ 3350,
    WorkFatherOccupation == "Joueur de foot" ~ 3420,
    WorkFatherOccupation == "Ingénieur BTP" ~ 2140,
    WorkFatherOccupation == "Chauffeur uber" ~ 8320,
    WorkFatherOccupation == "géomètre" ~ 2160,
    WorkFatherOccupation == "Designer" ~ 2160,
    WorkFatherOccupation == "Garagiste entrepreneur" ~ 7230,
    WorkFatherOccupation == "Médecin anesthésiste" ~ 2210,
    WorkFatherOccupation == "maçon" ~ 7110,
    WorkFatherOccupation == "Commerçant" ~ 5220,
    WorkFatherOccupation == "Professeur de musique" ~ 2350,
    WorkFatherOccupation == "ambulancier" ~ 3250,
    WorkFatherOccupation == "Sans activité pro" ~ 9700,
    WorkFatherOccupation == "médecin" ~ 2210,
    WorkFatherOccupation == "Eboueur" ~ 9610,
    WorkFatherOccupation == "Surveillant en crèche" ~ 5310,
    WorkFatherOccupation == "préparateur de commande" ~ 9620,
    WorkFatherOccupation == "technicien électricien" ~ 7410,
    WorkFatherOccupation == "Responsable financier" ~ 1210,
    WorkFatherOccupation == "Mécanicien climatisation + technicien de surface (cumule les 2 emplois, 7h/j en tant que mécanicien, 1h30/j en tant que technicien))" ~ 7120,
    WorkFatherOccupation == "Gardien pénitencier" ~ 5410,
    WorkFatherOccupation == "consultant informatique" ~ 2520,
    WorkFatherOccupation == "Gardien d'immeuble" ~ 5150,
    WorkFatherOccupation == "chauffeur poids lourds" ~ 8330,
    WorkFatherOccupation == "Esthéticienne" ~ 5140,
    WorkFatherOccupation == "Intermittent du spectacle : chef opérateur dans l'audiovisuel" ~ 2650,
    WorkFatherOccupation == "Gérant d'immeuble" ~ 3330,
    WorkFatherOccupation == "Conducteur de travaux" ~ 2140,
    WorkFatherOccupation == "Police scientifique" ~ 3110,
    WorkFatherOccupation == "Attaché d'administration" ~ 4110,
    WorkFatherOccupation == "Cadre dans agence de voyage" ~ 4220,
    WorkFatherOccupation == "Gestionnaire" ~ 4310,
    WorkFatherOccupation == "Travaille dans les ressources humaines" ~ 3330,
    WorkFatherOccupation == "Analyste des finances publiques" ~ 3350,
    WorkFatherOccupation == "Directeur du crédit dans une banque" ~ 1340,
    WorkFatherOccupation == "Ouvrier dans un chantier" ~ 9310,
    WorkFatherOccupation == "Entrepreneur dans la communication" ~ 2430,
    WorkFatherOccupation == "Service dans la restauration" ~ 5130,
    WorkFatherOccupation == "Géographe au sein de l'armée de l'air" ~ 0310,
    WorkFatherOccupation == "Agent de restauration" ~ 9410,
    WorkFatherOccupation == "Chargé de risque dans les assurances" ~ 3320,
    WorkFatherOccupation == "Analyste financier" ~ 2410,
    WorkFatherOccupation == "Ingénieur Télécom" ~ 2150,
    WorkFatherOccupation == "technicien d'ascenseur" ~ 7230,
    WorkFatherOccupation == "Policier" ~ 5410,
    WorkFatherOccupation == "employé magasin / magasinier" ~ 5220,
    WorkFatherOccupation == "Déménageur" ~ 9330,
    WorkFatherOccupation == "Agent restauration école" ~ 9410,
    WorkFatherOccupation == "manager chez Monoprix" ~ 5220,
    WorkFatherOccupation == "Chef cuisinier" ~ 3430,
    WorkFatherOccupation == "Premier surveillant pénitentiaire" ~ 5410,
    WorkFatherOccupation == "Conseiller patrimonial" ~ 3310,
    WorkFatherOccupation == "Pizzayolo" ~ 5120,
    WorkFatherOccupation == "Employé de magasin" ~ 5220,
    WorkFatherOccupation == "Chauffeur-livreur" ~ 9620,
    WorkFatherOccupation == "chauffeur livreur" ~ 9620,
    WorkFatherOccupation == "Pêcheur" ~ 6220,
    WorkFatherOccupation == "dans un centre social il y a 6 mois ; rédige sa thèse en ce moment" ~ 9700,
    WorkFatherOccupation == "Coach sportif" ~ 3420,
    WorkFatherOccupation == "Chirurgien vasculaire" ~ 2210,
    WorkFatherOccupation == "Agent magasinier" ~ 5220,
    WorkFatherOccupation == "Manager" ~ 5220,
    WorkFatherOccupation == "Professeur au lycée" ~ 2330,
    WorkFatherOccupation == "gestionnaire de finance et patrimoine" ~ 3310,
    WorkFatherOccupation == "Ascensoriste" ~ 7230,
    WorkFatherOccupation == "Coach de sport" ~ 3420,
    WorkFatherOccupation == "Enseignant en informatique dans le privé" ~ 2330,
    WorkFatherOccupation == "Vendeur dans enseigne boulanger" ~ 5220,
    WorkFatherOccupation == "vendeur" ~ 5220,
    WorkFatherOccupation == "Optométriste" ~ 2260,
    WorkFatherOccupation == "Chirurgien libéral" ~ 2210,
    WorkFatherOccupation == "ingénieur génie civil" ~ 2140,
    WorkFatherOccupation == "Enseignant à l'université" ~ 2310,
    WorkFatherOccupation == "Au chômage mais formation en bâtiment" ~ 9700,
    WorkFatherOccupation == "Rumatologue" ~ 2210,
    WorkFatherOccupation == "Ni étudiant, n'a jamais travaillé" ~ 9700,
    WorkFatherOccupation == "Dentiste" ~ 2260,
    WorkFatherOccupation == "Opticien audioprothésiste" ~ 3250,
    WorkFatherOccupation == "Conseiller bancaire" ~ 3310,
    WorkFatherOccupation == "Cariste dans l'entrepôt" ~ 8340,
    WorkFatherOccupation == "Militaire dans les forces spéciales" ~ 0110,
    WorkFatherOccupation == "Conducteur de Bus" ~ 8330,
    WorkFatherOccupation == "Géomètre" ~ 2160,
    WorkFatherOccupation == "chef de rayon fruits et légumes" ~ 5220,
    WorkFatherOccupation == "Animateur de centre de loisir" ~ 5310,
    WorkFatherOccupation == "agent immobilier" ~ 3330,
    WorkFatherOccupation == "coiffeur" ~ 5140,
    WorkFatherOccupation == "Ouvrier dans le bâtiment" ~ 9310,
    WorkFatherOccupation == "pharmacien" ~ 2262,
    WorkFatherOccupation == "ouvrier" ~ 9310,
    WorkFatherOccupation == "Chauffeur privé (VTC)" ~ 8320,
    WorkFatherOccupation == "Policie officer" ~ 5410,
    WorkFatherOccupation == "Etudiant" ~ 9700,
    WorkFatherOccupation == "agent d'acceuil" ~ 4220,
    WorkFatherOccupation == "sans diplôme (vendeur en Afrique)" ~ 9700,
    WorkFatherOccupation == "Opticien" ~ 3250,
    WorkFatherOccupation == "Chauffeur poids lourds" ~ 8330,
    WorkFatherOccupation == "marbreur" ~ 7130,
    WorkFatherOccupation == "Bâtiment : marbrier" ~ 7130,
    WorkFatherOccupation == "Éboueur" ~ 9610,
    WorkFatherOccupation == "Coiffeur barbeur" ~ 5140,
    WorkFatherOccupation == "secrétaire général d'une ville" ~ 3340,
    WorkFatherOccupation == "Géomaticien" ~ 2160,
    WorkFatherOccupation == "surveillant" ~ 5310,
    WorkFatherOccupation == "Directeur financier" ~ 1210,
    WorkFatherOccupation == "Consultant en finances" ~ 2410,
    WorkFatherOccupation == "Agent territorial" ~ 9700,
    WorkFatherOccupation == "Responsable financier" ~ 1210,
    WorkFatherOccupation == "Chef cuisinier" ~ 3430,
    WorkFatherOccupation == "Ingénieur informaticien dans une banque" ~ 2510,
    WorkFatherOccupation == "Salarié gestion de restauration" ~ 1410,
    WorkFatherOccupation == "Responsable prévision de ventes et optimisation commerciale" ~ 1210,
    WorkFatherOccupation == "couvreur" ~ 7120,
    WorkFatherOccupation == "Apporteur d'affaire" ~ 3320,
    WorkFatherOccupation == "Dépanneur (société de dépannage)" ~ 7230,
    WorkFatherOccupation == "préparateur de commande dans l'alimentaire" ~ 9330,
    WorkFatherOccupation == "Banquier" ~ 2410,
    WorkFatherOccupation == "Responsable d'investissement" ~ 2410,
    TRUE ~ NA_integer_
  ))

#ses_data$isco_father <- formatC(ses_data$isco_father, width = 4, flag = "0") #J'ai mis cette ligne de code pour garder le premier 0 des codes de la catégorie "Professions militaires" mais j'ai l'impression que ça marche sans

#Transform isco-08 to isei_08
ses_data$isei_mother <- isco08toISEI08(ses_data$isco_mother, display.nas = FALSE)
ses_data$isei_father <- isco08toISEI08(ses_data$isco_father, display.nas = FALSE)

#Replace fake isco code 9700 by isei value 17
ses_data = ses_data %>% mutate(isei_mother = case_when(isco_mother == 9700 ~ 17, TRUE ~ isei_mother))
ses_data = ses_data %>% mutate(isei_father = case_when(isco_father == 9700 ~ 17, TRUE ~ isei_father))

#Select the highest value between both parents 
ses_data$high_educ <- pmax(ses_data$educ_mother, ses_data$educ_father, na.rm = TRUE)
ses_data$high_isei <- pmax(ses_data$isei_mother, ses_data$isei_father, na.rm = TRUE)


#Principal components analysis (PCA) approach 
#Step 1: standardization
ses_data <- ses_data %>% mutate_at(c('high_educ', 'high_isei'), ~(scale(.) %>% as.vector))
#Step 2: run the PCA
matrix_pca_ses <- cor(select(ses_data, c(high_educ, high_isei)), use = "pairwise.complete.obs")
nobs_ses <- (nrow(ses_data))
pca_ses <- pca(matrix_pca_ses, nfactors = 2, rotate = "none", n.obs = nobs_ses)
summary(pca_ses, fit.measures = TRUE)
pca_ses 
#check the relevance of the method: eigenvalue, proportion of variance explained by the PC1 and factor loadings


#Compute the ses_index scores
ses_data$ses_pca = predict(pca_ses, select(ses_data, c(high_educ, high_isei)), missing = TRUE)
ses_data$ses_pca <- round(ses_data$ses_pca, digits = 3)
ses_data$ses_pca <- na_if(ses_data$ses_pca, 0.000)

#but...
#plot(ses_pca ~ outcome, data = ses_data)
#why ? 
#length(ses_data$outcome)
#length(ses_data$ses_pca)
#explanation
#View(ses_data$ses_pca)

#For the next analysis, we need to extract PC1 as a simple variable because here ses_pca is composed of 2 factors

#Extract only PC1 to create a new simple variable 
ses_index <- ses_data$ses_pca
ses_index <- ses_index[ , c("PC1")] 
ses_data <- cbind(ses_data, ses_index)
ses_data$ses_index <- round(ses_data$ses_index, digits = 3)

#the problem is solved 
#plot(ses_index ~ outcome, data = ses_data)

##Descriptive statistics of the index
summary(ses_data$ses_index)
hist <- hist(ses_data$ses_index, xlim=c(-4,2), ylim=c(0,20))
text(hist$mids,hist$counts,labels=hist$counts, adj=c(0.5, -0.5))

## Merge with the RCT_tot database


RCT_tot <-  RCT_tot %>% left_join(.,ses_data ,by= "ResponseId") %>% 
  filter(!duplicated(ResponseId)) 

RCT_tot <-  RCT_tot %>% mutate(
  ISEIMotherMedian            = median(isei_mother, na.rm = TRUE),
  ISEIFatherMedian            = median(isei_father, na.rm = TRUE),
  EducMotherMedian            = median(educ_mother, na.rm = TRUE),
  EducFatherMedian            = median(educ_father, na.rm = TRUE),
  HigherEducMedian            = median(high_educ, na.rm = TRUE),
  HigherISEIMedian            = median(high_isei, na.rm = TRUE),
  SESIndexMedian              = median(ses_index, na.rm = TRUE),
  HigherThanMeadianISEIMother = ifelse(isei_mother > ISEIMotherMedian, 1, 0),
  HigherThanMeadianISEIFather = ifelse(isei_father > ISEIFatherMedian, 1, 0),
  HigherThanMeadianEducMother = ifelse(educ_mother > EducMotherMedian, 1, 0),
  HigherThanMeadianEducFather = ifelse(educ_father > EducFatherMedian, 1, 0),
  HigherThanMeadianHigherEduc = ifelse(high_educ > HigherEducMedian, 1, 0),
  HigherThanMeadianHigherISEI = ifelse(high_isei > HigherISEIMedian, 1, 0),
  HigherThanMeadianSESIndex = ifelse(ses_index > SESIndexMedian, 1, 0)
  
)

```


```{r cleanDB, include = FALSE}
#PremiersPasWithoutIDs <- RCT %>% select(ResponseId:Intention, 
#               AffordNMCostWBOrdered:StartDateEndline, # bith
#               SurveyorName, 
#               PsyWellBeingHappy:ComplianceNonWhy, # allthe the treatment are else
#               ECSTwins, 
#               ECSIntensity,
#               ECS2, 
#               ECSAppTiming, 
#               ECSAppTimingDK, 
#               ECSAppDateWanted_1_TEXT, # ?
#               ECSAppCalled:ECSPlanToEndline, # ApplicationCalled and WentOnSiteYes déjà
#               ECSRensWhen, 
#               OtherBabyLessThan3, 
#               ECSBroSisApp,
#               AffordCostEndline, 
#                AffordSubsidiesEndline, 
#               AccessEasyEndline, 
#               AccessHoursEndline,
#               ECSNeedEndline,
#               AccessInformalCareEndline,
#               ECSIdealAgeEntryEndline, 
#               NormsEndline, 
#               AffordNMCostWBEndline:NormsHouse, 
#               LevelComprehension:PartnerInvolvement,
#               StartDate_T:AppNbTypeECSBrosis, 
#               AppNCrecheHops:AppNTotALL, 
#               MotherAgeEndline,
#               TwinsYes:NormsOpposedScore,
#               sheet_name, 
#               Fini, 
#               Count_minutes,
#               Suivi_administratif,
#               Raison_refus, 
#               Treatment_intensity, 
#               Suivi_administratif1_0, 
#               ECSStartDate, 
#                   ECSBrosisTiming, 
#                   ECSPlanToStartDate, 
#                   WorkMotherWhen, 
#               ECSYes) %>% 
#  select(-BirthDate, 
#         -StartDateEndline, 
#         -BabyBirthDate, 
#         -StillBreastfeedingLength, 
#         -StillBreastfeeding2Length, 
#         -BreastfeedingWeeks)
#
# write.csv(PremiersPasWithoutIDs, file = "PremiersPasWithoutIds.csv")
# 
# 
# ## Creation of the full and clean databse with the non respondents at Endline
#
#
##%>% mutate( AgeBabyEndline = age_calc(as.Date(BabyBirthDate), date_ref, units = "months") tricky to do it here b/c of the NAs
#
#
# RCT_tot$PhoneMotherBaseline = as.character(RCT_tot$PhoneMotherBaseline)
#
## Identify columns from admin_unique not present in RCT
#columns_to_import <- setdiff(names(admin_unique), names(RCT_tot))
#
## Import only the columns from admin_unique that are not already present in RCT
#RCT_tot <- RCT_tot %>%
#  left_join(select(admin_unique, all_of(columns_to_import)), by = c("PhoneMotherBaseline" = "Numéro")) %>%
#  mutate(Suivi_administratif = ifelse(Suivi_administratif == "No" | is.na(Suivi_administratif), "No", "Yes"),
#         Suivi_administratif = as.factor(Suivi_administratif), 
#         Suivi_administratif1_0 = ifelse(Suivi_administratif == "No", 0, 1)) 
#
### In this chunk we augment RCT with spatial data about the ECS coverage rate at endline, spatial coordinates, and the number of participants per city at Endline
#


#### STEP 1           #### 
#### Data preparation #### 


##### Get our db ready by loading some batabase that contains interesting variables

# ECS coverage rate
#### Source http://data.caf.fr/dataset/f6411f07-10bf-4f13-b4fb-8d30ba9328b5/resource/44cdd055-fbfa-444b-ae33-f4d47d8e8638/download/TAUXCOU2019.csv
#coverage <- read_csv2("../Data/Population-ECEC_coverage/TAUXCOU2019(1).csv") %>% filter(row_number()!=1) %>% 
#  mutate(across(c(TAUXCOUV_COM:TAUXCOUV_NAT),~as.numeric(gsub(",", ".", gsub("\\.", "",.x)))))



## VERSION NUEVA

# Updated with 2021 data. Source: https://data.caf.fr/explore/dataset/txcouv_pe_com/export/?disjunctive.annee&refine.annee=2021
coverage <- readr::read_csv2(
  here("Data/Spatial Data", "txcouv_pe_com.csv"),
  locale    = locale(encoding = "UTF-8"),
  col_types = cols(.default = col_character())   # 1) read raw text
) %>%
  # clean headers (BOM/ZWSP/NBSP)
  rename_with(~ str_replace_all(.x, "[\\uFEFF\\u200B\\u00A0]", "")) %>%
  transmute(
    NUMCOM = `Numéro commune`,
    # 2) parse numbers with FR locale + NBSP grouping, drop any %
    tauxcouv_com = parse_number(
      str_replace_all(`Taux de couv global`, "%", ""),
      locale = locale(decimal_mark = ",", grouping_mark = "\u00A0")
    )
  )

### Source : https://www.insee.fr/fr/statistiques/6011070?sommaire=6011075
pop <- readr::read_delim(
  here("Data/Spatial Data", "donnees_communes.csv"),
  delim = ";",
  locale = locale(encoding = "UTF-8"),
  col_types = cols(.default = col_character())
) %>%
  mutate(NUMCOM = str_c(CODDEP, CODCOM, sep = ""))


path <- here("Data/Spatial Data", "019HexaSmal.csv")

post <- readr::read_csv2(
  file = path,
  locale = locale(encoding = "Windows-1252"),   # <- key change
  col_types = cols(.default = col_character())
) %>%
  # normalize headers to UTF-8 and clean them up
  rename_with(~ iconv(.x, from = "Windows-1252", to = "UTF-8", sub = "")) %>%
  rename_with(~ str_remove(.x, "^#")) %>%
  rename(NUMCOM = Code_commune_INSEE)


## Import cities latitude and longitude https://www.data.gouv.fr/en/datasets/villes-de-france/
latlong <- readr::read_csv(
  here("Data/Spatial Data", "cities.csv")
) %>% rename(NUMCOM = insee_code) %>% select(NUMCOM, zip_code, latitude, longitude)


#### Put the database together

Demographics <- pop %>%
  dplyr::left_join(post,     by = "NUMCOM") %>%
  dplyr::left_join(coverage, by = "NUMCOM") %>%
  dplyr::select(NUMCOM, COM, CODDEP, CODREG, REG, PTOT, Code_postal, tauxcouv_com) %>%
  dplyr::mutate(PTOT = suppressWarnings(as.numeric(PTOT))) %>%
  dplyr::group_by(CODDEP) %>%
  dplyr::mutate(
    tauxcouv_dep = if (all(is.na(tauxcouv_com))) NA_real_
                   else stats::weighted.mean(tauxcouv_com, w = PTOT, na.rm = TRUE),
    HighLowECEC  = dplyr::if_else(tauxcouv_com > tauxcouv_dep,
                                  "High ECEC covering", "Low ECEC covering",
                                  missing = NA_character_)
  ) %>%
  dplyr::ungroup() %>%
  dplyr::filter(REG == "Île-de-France")



# Add latitude and longitude
Demographics <- Demographics %>%
  left_join(latlong, by = "NUMCOM") %>%
  filter(!duplicated(NUMCOM))# the merging creates duplicates, to remove


# Put this info in the main dataframe: we join with endlien because in theory we already have the baseline info
RCT_tot <-  RCT_tot %>% left_join(.,Demographics ,by=c("ZipcodeEndline"="Code_postal"), suffix = c("Baseline", "Endline")) %>% 
  filter(!duplicated(ResponseId))# the merging creates duplicates, to remove


# Record the number of participants living in the city where each participant live at endline
RCT_tot <- RCT_tot %>% 
  group_by(ZipcodeEndline) %>% 
  mutate(nbr_city_endline = n()) %>% ungroup()


# Record the number of participants living in the city where each participant live at baseline
RCT_tot <- RCT_tot %>% 
  group_by(CodePostalBaseline) %>% 
  mutate(nbr_city_baseline = n()) %>% ungroup()


## Now we wanna import 2021 data, which came out in 2024. We also have the daycare data and the private childminders one in this database

path <- here("Data/Spatial Data", "txcouv_pe_com_EAJE_assmat.csv")

txcouv_pe_com_EAJE_assmat <- readr::read_csv2(
  file   = path,                        # ";" separator handled
  locale = locale(encoding = "UTF-8"),
  col_types = cols(.default = col_character())
) %>%
  # normalize header bytes just in case
  rename_with(~ str_replace_all(.x, "[\\uFEFF\\u200B\\u00A0]", "")) %>%
  # filter on the accented column (use backticks)
  filter(`Date référence` == "2021")  

txcouv_pe_com_EAJE_assmat <- txcouv_pe_com_EAJE_assmat %>%
  rename(
    `Taux.de.couv.EAJE.PSU`                    = `Taux de couv EAJE PSU`,
    `Taux.de.couv.hors.EAJE.PSU`               = `Taux de couv hors EAJE PSU`,
    `Taux.de.couv.EAJE.ensemble`               = `Taux de couv EAJE - ensemble`,
    `Taux.de.couv.préscolarisation`            = `Taux de couv préscolarisation`,
    `Taux.de.couv.assistantes.maternelles`     = `Taux de couv assistantes maternelles`,
    `Taux.de.couv.salarié.à.domicile`          = `Taux de couv salarié à domicile`,
    `Taux.de.couv.accueil.individuel.ensemble` = `Taux de couv accueil individuel - ensemble`,
    `Taux.de.couv.global`                      = `Taux de couv global`
  )



# Put this info in the main dataframe: we join with endlien because in theory we already have the baseline info
RCT_tot <-  RCT_tot %>% mutate(NUMCOMBaseline= as.character(NUMCOMBaseline)) %>% left_join(.,txcouv_pe_com_EAJE_assmat ,by=c("NUMCOMBaseline"="Numéro commune")) %>% 
  filter(!duplicated(ResponseId)) # the merging creates duplicates, to remove


PremiersPasWithNonRespondents <- RCT_tot %>% select(ResponseId:Intention, 
               AffordNMCostWBOrdered:StartDateEndline, # bith
               SurveyorName, 
               PsyWellBeingHappy:ComplianceNonWhy, # allthe the treatment are else
               ECSTwins, 
               ECSIntensity,
               ECS2, 
               ECSAppTiming, 
               ECSAppTimingLabel, 
               ECSAppDateWanted_1_TEXT, # ?
               ECSAppCalled:ECSPlanToEndline ,
               ECSRensWhen, 
               OtherBabyLessThan3, 
               ECSBroSisApp,
               AffordCostEndline, 
                AffordSubsidiesEndline, 
               AccessEasyEndline, 
               AccessHoursEndline,
               ECSNeedEndline,
               AccessInformalCareEndline,
               ECSIdealAgeEntryEndline, 
               NormsEndline, 
               AffordNMCostWBEndline:NormsHouse, 
               LevelComprehension:PartnerInvolvement,
               StartDate_T:AppNbTypeECSBrosis, 
               AppNCrecheHops:AppNTotALL, 
               MotherAgeEndline,
               TwinsYes:NormsOpposedScore,
               sheet_name, 
               Fini, 
               Count_minutes,
               Suivi_administratif,
               Raison_refus, 
               Treatment_intensity, 
               Suivi_administratif1_0, 
               ECSStartDate, 
                   ECSBrosisTiming, 
                   ECSPlanToStartDate, 
                   WorkMotherWhen, 
               ECSYes,
               NUMCOMBaseline, CodePostalBaseline, latitude, longitude, HighLowECECBaseline, HighLowECECEndline, TAUXCOUV_COM, tauxcouv_com, nbr_city_endline, nbr_city_baseline, NUMCOMEndline, 
                ZipcodeEndline, 
                `Taux.de.couv.EAJE.PSU`,
                `Taux.de.couv.hors.EAJE.PSU`,
                `Taux.de.couv.EAJE.ensemble`,
                `Taux.de.couv.préscolarisation`,
                `Taux.de.couv.assistantes.maternelles`,
                `Taux.de.couv.salarié.à.domicile`,
                `Taux.de.couv.accueil.individuel.ensemble`,
                `Taux.de.couv.global`,                
                ISEIMotherMedian,           
                 ISEIFatherMedian,           
                 EducMotherMedian,           
                 EducFatherMedian ,          
                 HigherEducMedian,         
                 HigherISEIMedian,        
                 SESIndexMedian,       
                 HigherThanMeadianISEIMother,
                 HigherThanMeadianISEIFather,
                 HigherThanMeadianEducMother,
                 HigherThanMeadianEducFather,
                 HigherThanMeadianHigherEduc,
                 HigherThanMeadianHigherISEI,
                 HigherThanMeadianSESIndex,
               isei_mother,
               isei_father,
               educ_mother,
               educ_father,
               high_educ,
               high_isei,
               ses_index, # ApplicationCalled and WentOnSiteYes déjà
               ECSNoChildcareType,
               ECSNoChildcareType_5_TEXT,
               ECSIntensity_1_TEXT,
               ECS2Type,
               ECS2Type_12_TEXT
               ) %>% 
  select(-BirthDate, 
         -StartDateEndline)


# COSAS QUE TUVE QUE RECODEAR POR DIFERENCIAS ENTRE MAINDATABASEWithoutIDS Y PREMIERSPAS, Y QUE SE TRABABA EN LOADALLDATA

# Variable "NumberofChildren3"
PremiersPasWithNonRespondents <- PremiersPasWithNonRespondents %>%
  mutate(
    # make sure it's numeric (e.g., " 2 " → 2)
    NumberChildren_num = suppressWarnings(as.numeric(str_trim(as.character(NumberChildren)))),

   NumberOfChildren3 = case_when(
      is.na(NumberChildren_num)      ~ NA_character_,
      NumberChildren_num == 0        ~ "0",
      NumberChildren_num == 1        ~ "1",
      NumberChildren_num >= 2        ~ "2 or more",
      TRUE                           ~ NA_character_   # unexpected values
    ),
    NumberOfChildren3 = factor(NumberOfChildren3, levels = c("0","1","2 or more"))
  )

# Variable "NormsOpposedYes" 

PremiersPasWithNonRespondents <- PremiersPasWithNonRespondents %>%
  mutate(
    NormsOpposedYes = case_when(
      is.na(NormsOpposedN) ~ "No",
      NormsOpposedN >= 1   ~ "Yes",
      NormsOpposedN == 0   ~ "No"
    ),
    NormsOpposedYes = factor(NormsOpposedYes, levels = c("No","Yes"))
  )

# Variable "DescriptiveNorms" 

PremiersPasWithNonRespondents <- PremiersPasWithNonRespondents %>%
  mutate(
    DescriptiveNorms = ifelse((NormsBaseline == "Toutes" | NormsBaseline == "La plupart"),  
                              "Yes", 
                              "No"
    )
)


# Variable "Responded" (je l'ai trouvée dans le Rapport CNAF)
PremiersPasWithNonRespondents <- PremiersPasWithNonRespondents %>%
  mutate(
    ECSApp = na_if(str_trim(ECSApp), ""),
    Responded  = if_else(is.na(ECSApp), 0L, 1L),
    Respondent = factor(if_else(Responded == 1L, "Respondent", "NonRespondent"),
                        levels = c("NonRespondent","Respondent"))
  )


write_csv(PremiersPasWithNonRespondents, here("Data","PremiersPasWithNonRespondents112024_final.csv"))

rm(pop, post, coverage, latlong)




```{r addresses}

#Merging des bases de données des chèques cadeaux

library(readxl)

#On charge les trois bases de données des adresses pour les chèques cadeaux
cheque_1 <- read_excel("C:/Users/elise/Documents/ENS/Stage PPP/endline_ppp/Fichier_de_commande_cadhoc_1.xlsx")
cheque_2 <- read_excel("C:/Users/elise/Documents/ENS/Stage PPP/endline_ppp/Fichier_de_commande_cadhoc_2.xlsx")
cheque_3 <- read_excel("C:/Users/elise/Documents/ENS/Stage PPP/endline_ppp/Fichier_de_commande_cadhoc_3.xlsx")

#On passe les var de la df chèque2 en character (je ne sais pas pourquoi elles étaient en numeric)
cheque_2 <- cheque_2 %>% mutate(`Téléphone du contact livraison` = as.character(`Téléphone du contact livraison`), `Code postal` = as.character(`Code postal`))

#On fusionne les trois bases
df_cheque <- bind_rows(cheque_1, cheque_2, cheque_3)

df_cheque <- df_cheque %>%
  rename(PhoneMother = `Téléphone du contact livraison`)

#On merge la nouvelle base df_cheque avec la Endline à partir des numéros de téléphone
RCT_tot <- left_join(RCT_tot, select(df_cheque, PhoneMother, Adresse, "Code postal", Ville), by = c("PhoneMotherEndline" = "PhoneMother"))

#Il y a 1666 observations contre 1582 auparavant.

#Je regarde combien il y a d'observations dupliquées
#A noter que, avant le merging avec df_cheque, R m'indique qu'il y a déjà 6 duplications : les lignes 517, 570, 1310, 1331, 1373 et 1660 sont des duplications. Je vais donc les suppr dans la suite 
correspondances_multiples <- RCT_tot %>%
  group_by(PhoneMotherEndline) %>%
  filter(n() >= 2) %>%
  summarise(nombre_correspondances = n())
#Il y a 88 lignes dupliquées mais 1666-1582 = 84
#On va travailler sur les duplications afin de ne supprimer que les observations qui ont été dupliquée suite au merging

#Je crée une base qui regroupe les observations dupliquées à partir de la variable PhoneMother (clé de fusion) et de l'identifiant de l'Endline
veritables_duplications <- RCT_tot[duplicated(RCT_tot$PhoneMotherEndline) & duplicated(RCT_tot$ResponseId), ]

#On peut aussi procéder par une fonction, mais ça ne m'a pas permis de détecter toutes les duplications
#Dans ce cas, je définirais une fonction qui vérifie si les valeurs de toutes les observations sont identiques, à partir de la correspondance en PhoneMother
#toutes_valeurs_identiques <- function(x) {
#  length(unique(x)) == 1
#}

#J'identifierais alors au sein des correspondances en PhoneMother les véritables duplications
#veritables_duplications2 <- veritables_duplications %>%
#  group_by(PhoneMotherEndline) %>%
#  filter(all(across(everything(), toutes_valeurs_identiques)))

#Je crée un index des observations à exclure
index_duplications <- as.numeric(rownames(veritables_duplications))

#Je supprime les observations de 'veritables_duplications' de la base Endline_data
RCT_tot <- RCT_tot[-index_duplications, ]

#Je déplace les variables 
RCT_tot <- RCT_tot %>% relocate(Adresse, `Code postal`, Ville, .after = AddressOther)


```



```{r vouchers}
## There is a problem with the first name in the qualtrics database
# this is a problem to send the sheet to the voucher company

# We create an augmented database with the Baseline first names and the email address
Augmenteddb <- Baseline_augmented %>%  
  mutate(PhoneMother = as.character(PhoneMother)) %>% 
  select(PhoneMother, Mail, Prenom) %>% 
  left_join(Prenoms_3, by = "PhoneMother")

Augmenteddb <- Augmenteddb %>% 
  filter(is.na(`Votre adresse`) == FALSE)


library(stringr)

# Create new columns for Address, Zipcode, and City
Augmenteddb$Address_t <- str_extract(Augmenteddb$`Votre adresse`,  "^.+(?=\\b\\d{5}\\b)")
Augmenteddb$Zipcode   <- str_extract(Augmenteddb$`Votre adresse`, "\\b\\d{5}\\b")
Augmenteddb$City      <- str_extract(Augmenteddb$`Votre adresse`,  "(?<=\\b\\d{5}\\s).+")
  
# Write the Excel file for the current name
# writexl::write_xlsx(Augmenteddb, "prenoms_cheques_3.xlsx", col_names = TRUE)

#prenoms_cheques_2 <- read_excel("Data/prenoms_cheques_2.xlsx")


# Remove the original address column if needed
# your_data <- your_data[, -which(names(your_data) == "address")]

# Display the resulting data frame
#writexl::write_xlsx(prenoms_cheques_2, "prenoms_cheques_2.xlsx", col_names = TRUE)

```




This chunk is more dangerous than useful for slow laptops
```{r cran_packages, include=FALSE,eval=TRUE}
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%##
##### load or install libraries %%%%%%%%%%%##
#####%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%##

rm(list=ls())



#Create a vector of the package you need
list.of.packages <- c("writexl",
                      "tidyverse", 'data.table', "summarytools", 
                      "lubridate", # to work with dates
                      "readxl",
                      "modelsummary",#to make nice tables and also plots
                      'interactions', "usethis",
                      "ggExtra","ggthemes","cowplot", "corrplot", "naniar", "rpart", 
                      'lfe',"fixest",
                      "flextable",
                    "eeptools", "estimatr"        # to compute ages
                    )

##Create a vector of the package you need
#list.of.packages <- c("devtools", "writexl",
#                      "formatR", "latex2exp",#to knit documents with R and LaTeX (or #Markdown), formatR makes code nice in outputs
#                      "tidyverse",'data.table', "summarytools", #many important package #for RCT manipulation
#                      "lubridate", # to work with dates
#                      "readr","readxl",'haven', #to import and read RCT from R, Excel, #CSV, STATA, SAS, SPSS
#                      "doParallel", 'parallel', # for parallel computing
#                      "modelsummary","ggh4x", #to make nice tables and also plots
#                      'interactions', "usethis",
#                      "ggplot2","ggExtra","ggthemes","cowplot", "corrplot", "naniar", #"rpart", "rpart.plot",  "gridGraphics",
#                       "viridis","RColorBrewer", ## for plots, with nice colors and themes
#                      "DeclareDesign",'randomizr','jtools','lfe',"fixest", "ivdesc","qte", #"grf", #Package for estimation and other research design
#                    #  "ggmap","googleway", # for maps
#                      "hdm","did","DRDID", # for dif in dif and lasso
#                      "magick", "pdftools", #for tikz
#                      "equatiomatic", "flextable", "officer","htmltools",
#                                            "multcomp" ,           # for joint hypothesis #testing
#                    "eeptools", "DiagrammeR", "webshot",  "estimatr"        # to compute #ages
#                      )

#Check if they are all installed on your computer
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
#If they are not installed, then I'll download them from CRAN and install them.
if(length(new.packages)) install.packages(new.packages, repos = "http://cran.us.r-project.org")

#Install them
invisible(lapply(list.of.packages, library, character.only = TRUE))

#devtools::install_github("kupietz/kableExtra")


#Some package have conflicting commands sometimes so I make sure I have the one I want
select <- dplyr::select
summarize <- dplyr::summarize

# I choose to use colorblind friendly colors, I encourage you to do so .
# The palette with grey:
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

# The palette with black:
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

#GGplot default them : black and white.
    theme_set(theme_bw())


    
```
